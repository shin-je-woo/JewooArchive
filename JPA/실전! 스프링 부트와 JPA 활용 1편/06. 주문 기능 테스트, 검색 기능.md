# ğŸ’¡ ì£¼ë¬¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
* ìƒí’ˆ ì£¼ë¬¸ì´ ì„±ê³µí•´ì•¼ í•œë‹¤.
* ìƒí’ˆì„ ì£¼ë¬¸í•  ë•Œ ì¬ê³  ìˆ˜ëŸ‰ì„ ì´ˆê³¼í•˜ë©´ ì•ˆ ëœë‹¤.
* ì£¼ë¬¸ ì·¨ì†Œê°€ ì„±ê³µí•´ì•¼ í•œë‹¤.
```java
@RunWith(SpringRunner.class)
@SpringBootTest
@Transactional
class OrderServiceTest {

    @PersistenceContext
    EntityManager em;
    
    @Autowired OrderService orderService;
    @Autowired OrderRepository orderRepository;

    //ìƒí’ˆ ì£¼ë¬¸
    @Test
    void ìƒí’ˆì£¼ë¬¸() throws Exception {
        //given
        Member member = createMember();

        Book book = createBook("JPAì±…", 10000, 10);

        int orderCount = 2;
        //when
        Long orderId = orderService.order(member.getId(), book.getId(), orderCount);

        //then
        Order getOrder = orderRepository.findOne(orderId);

        assertThat(OrderStatus.ORDER).isEqualTo(getOrder.getStatus()); //ìƒí’ˆ ì£¼ë¬¸ì‹œ ìƒíƒœëŠ” ORDER
        assertThat(getOrder.getOrderItems().size()).isEqualTo(1); //ì£¼ë¬¸í•œ ìƒí’ˆ ì¢…ë¥˜ ìˆ˜ê°€ ì •í™•í•´ì•¼ í•œë‹¤.
        assertThat(getOrder.getTotalPrice()).isEqualTo(10000 * orderCount); //ì£¼ë¬¸ ê°€ê²©ì€ ê°€ê²© * ìˆ˜ëŸ‰ì´ë‹¤.
        assertThat(book.getStockQuantity()).isEqualTo(8); //ì£¼ë¬¸ ìˆ˜ëŸ‰ë§Œí¼ ì¬ê³ ê°€ ì¤„ì–´ì•¼ í•œë‹¤.
    }

    @Test
    void ìƒí’ˆì£¼ë¬¸_ì¬ê³ ìˆ˜ëŸ‰ì´ˆê³¼() throws Exception {
        //given
        Member member = createMember();
        Item item = createBook("JPAì±…", 10000, 10);

        int orderCount = 11;

        //when
        //then
        assertThatThrownBy(() -> orderService.order(member.getId(), item.getId(), orderCount)).isInstanceOf(NotEnoughStockException.class);
    }

    @Test
    void ì£¼ë¬¸ì·¨ì†Œ() throws Exception {
        //given
        Member member = createMember();
        Item item = createBook("JPAì±…", 10000, 10);

        int orderCount = 2;
        Long orderId = orderService.order(member.getId(), item.getId(), orderCount);

        //when
        orderService.cancelOrder(orderId);

        //then
        Order getOrder = orderRepository.findOne(orderId);
        assertThat(getOrder.getStatus()).isEqualTo(OrderStatus.CANCEL); //ì£¼ë¬¸ ì·¨ì†Œì‹œ ìƒíƒœëŠ” CANCEL
        assertThat(item.getStockQuantity()).isEqualTo(10); //ì£¼ë¬¸ì´ ì·¨ì†Œëœ ìƒí’ˆì€ ì¬ê³ ê°€ ì›ë³µë˜ì–´ì•¼ í•œë‹¤.
    }

    private Member createMember() {
        Member member =  new Member();
        member.setName("íšŒì›1");
        member.setAddress(new Address("ì„œìš¸", "ê°•ê°€", "123-123"));
        em.persist(member);
        return member;
    }

    private Book createBook(String name, int price, int stockQuantity) {
        Book book = new Book();
        book.setName(name);
        book.setPrice(price);
        book.setStockQuantity(stockQuantity);
        em.persist(book);
        return book;
    }
}
```

# ğŸ’¡ ì£¼ë¬¸ ê²€ìƒ‰ ê¸°ëŠ¥ ê°œë°œ
### â“ JPAì—ì„œ ë™ì  ì¿¼ë¦¬ë¥¼ ì–´ë–»ê²Œ í•´ê²°í•´ì•¼ í•˜ëŠ”ê°€?
JPAë¡œ ë™ì ì¿¼ë¦¬ë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•ì€ í¬ê²Œ ì„¸ê°€ì§€ê°€ ìˆë‹¤.
1. JPQL ë¬¸ìì—´ ì¡°í•© â†’ ì¡°ê±´ì— ë”°ë¼ ë¬¸ìì—´ì„ ê²°í•©í•˜ë©´ì„œ queryë¬¸ì„ ë§Œë“¤ê³  parameterë¥¼ ì„¸íŒ…í•´ì£¼ëŠ” ë°©ë²•
2. JPA Criteria â†’ JPA í‘œì¤€ ìŠ¤í™ì—ì„œ ì œê³µí•˜ëŠ” ê¸°ëŠ¥. 
3. queryDSL â†’ ì˜¤í”ˆì†ŒìŠ¤ë¥¼ í†µí•´ ì œê³µë˜ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ ì¿¼ë¦¬êµ¬í˜„ì„ methodë¡œ í•œë‹¤.

* 1, 2ë²ˆì€ ì»´íŒŒì¼íƒ€ì„ì— ì˜¤ë¥˜ë¥¼ ì¡ê¸° ì–´ë µê³ , êµ¬í˜„ë°©ë²•ë„ ê¹Œë‹¤ë¡­ë‹¤.
* ë™ì  ì¿¼ë¦¬ ê¸°ëŠ¥ì€ QueryDSLì´ ë©‹ì§€ê²Œ í•´ê²°í•˜ì˜€ìœ¼ë‹ˆ QueryDSLì„ ì‚¬ìš©í•˜ì—¬ ë™ì  ì¿¼ë¦¬ ë¬¸ì œë¥¼ í•´ê²°í•˜ì!
