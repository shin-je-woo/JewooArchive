# ğŸ’¡ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•œ ë¡œê·¸ì¸ ì²˜ë¦¬
ì„œë²„ì—ì„œ ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì¿ í‚¤ë¥¼ ë‹´ì•„ ë¸Œë¼ìš°ì €ì— ì „ë‹¬í•˜ë©´ ë¸Œë¼ìš°ì €ëŠ” í•´ë‹¹ ì¿ í‚¤ë¥¼ ì €ì¥í•´ë‘ê³    
í•´ë‹¹ ì‚¬ì´íŠ¸ì— ì ‘ì†í•  ë•Œë§ˆë‹¤ ì§€ì†í•´ì„œ í•´ë‹¹í•˜ëŠ” ì¿ í‚¤ë¥¼ ë³´ë‚´ì¤€ë‹¤.
![image](https://user-images.githubusercontent.com/39439576/228249569-83449600-c8bf-45a6-a1d3-5695f6a12ad1.png)

### ì¿ í‚¤ì˜ ì¢…ë¥˜
* ì˜ì† ì¿ í‚¤: ë§Œë£Œ ë‚ ì§œë¥¼ ì…ë ¥í•˜ë©´ í•´ë‹¹ ë‚ ì§œê¹Œì§€ ìœ ì§€
* ì„¸ì…˜ ì¿ í‚¤: ë§Œë£Œ ë‚ ì§œë¥¼ ìƒëµí•˜ë©´ ë¸Œë¼ìš°ì € ì¢…ë£Œì‹œ ê¹Œì§€ë§Œ ìœ ì§€

> ì„œë²„ì—ì„œ ì¿ í‚¤ ìƒì„±í•˜ê¸°
```java
@PostMapping("login")
public String login(@Valid @ModelAttribute LoginForm form, BindingResult bindingResult, HttpServletResponse response) {
    if (bindingResult.hasErrors()) {
        return "login/loginForm";
    }

    Member loginMember = loginService.login(form.getLoginId(), form.getPassword());
    if (loginMember == null) {
        bindingResult.reject("loginFail", "ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        return "login/loginForm";
    }

    //ì¿ í‚¤ì— ì‹œê°„ ì •ë³´ë¥¼ ì£¼ì§€ ì•Šìœ¼ë©´ ì„¸ì…˜ ì¿ í‚¤ê°€ ëœë‹¤. (ë¸Œë¼ìš°ì € ì¢…ë£Œì‹œ ëª¨ë‘ ì¢…ë£Œ)
    Cookie idCookie = new Cookie("memberId", String.valueOf(loginMember.getId()));
    response.addCookie(idCookie);

    return "redirect:/";
}
```
> ì„œë²„ì—ì„œ ì¿ í‚¤ ì¡°íšŒí•˜ê¸°
```java
@GetMapping("/")
public String homeLogin(@CookieValue(name = "memberId", required = false) Long memberId, Model model) {
    if (memberId == null) {
        return "home";
    }

    Member loginMember = memberRepository.findById(memberId);
    if (loginMember == null) {
        return "home";
    }

    model.addAttribute("member", loginMember);
    return "loginHome";
}
```

> ì„œë²„ì—ì„œ ì¿ í‚¤ ì—†ì• ê¸°(ë¡œê·¸ì•„ì›ƒ)  
> ë¡œê·¸ì¸ì„ í–ˆìœ¼ë©´ ë¡œê·¸ì•„ì›ƒë„ ìˆì–´ì•¼ í•œë‹¤. ê·¼ë° ì¿ í‚¤ê°’ì´ ìˆì–´ì„œ ìë™ìœ¼ë¡œ ë¡œê·¸ì¸ì´ ë˜ëŠ”ë° ì–´ë–»ê²Œ ë¡œê·¸ì•„ì›ƒì„ í•´ì•¼í• ê¹Œ? ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ì€ ì¿ í‚¤ë¥¼ ì‚­ì œí•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ ì¢…ë£Œ ë‚ ì§œë¥¼ 0ìœ¼ë¡œ ì¤˜ì„œ ë°”ë¡œ ë§Œë£Œì‹œí‚´ìœ¼ë¡œì¨ ì‚­ì œí•  ìˆ˜ ìˆë‹¤.
```java
@PostMapping("/logout")
public String logout(HttpServletResponse response) {
    expiredCookie(response, "memberId");
    return "redirect:/";
}

private void expiredCookie(HttpServletResponse response, String cookieName) {
    Cookie cookie = new Cookie(cookieName, null);
    cookie.setMaxAge(0);
    response.addCookie(cookie);
}
```

## ì¿ í‚¤ì™€ ë³´ì•ˆ ë¬¸ì œ
ì¿ í‚¤ë¥¼ ì‚¬ìš©í•´ì„œ ë¡œê·¸ì¸Idë¥¼ ì „ë‹¬í•´ì„œ ë¡œê·¸ì¸ì„ ìœ ì§€í•  ìˆ˜ ìˆì—ˆë‹¤. ê·¸ëŸ°ë° ì—¬ê¸°ì—ëŠ” ì‹¬ê°í•œ ë³´ì•ˆ ë¬¸ì œê°€ ìˆë‹¤.
* ì¿ í‚¤ ê°’ì€ ì„ì˜ë¡œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤
* ì¿ í‚¤ì— ë³´ê´€ëœ ì •ë³´(memberId) ë¥¼ íƒ€ì¸ì´ í›”ì³ê°ˆ ìˆ˜ ìˆë‹¤. 
* í•œ ë²ˆ ë„ìš©ëœ ì¿ í‚¤ì •ë³´ëŠ” ê³„ì† ì•…ìš©ë  ìˆ˜ ìˆë‹¤. 

ì¿ í‚¤ ë°©ì‹ì˜ ë¬¸ì œì ì„ ì •ë¦¬í•´ë³´ë©´ ê²°êµ­ ì¤‘ìš”í•œ ê°œì¸ì •ë³´ë“¤ì´ í´ë¼ì´ì–¸íŠ¸ì— ì €ì¥ë˜ì–´ìˆê¸° ë•Œë¬¸ì— ìœ„ë³€ì¡° ë° ë„ìš©ì´ ì‰½ë‹¤ëŠ” ë¬¸ì œê°€ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.  
ê·¸ëŸ¼ ë¬¸ì œì ì„ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” ì´ëŸ° ì¤‘ìš” ì •ë³´ë“¤ì€ í´ë¼ì´ì–¸íŠ¸ê°€ ì•„ë‹ˆë¼ ì„œë²„ì—ì„œ ê´€ë¦¬í•˜ë„ë¡ í•˜ê³  ê·¸ê²Œ ì™¸ë¶€ë¡œ ë…¸ì¶œë˜ì§€ ì•Šë„ë¡ í•´ì•¼ í•œë‹¤ëŠ” ì ì´ë‹¤.  
ê·¸ë˜ì„œ í´ë¼ì´ì–¸íŠ¸ëŠ” ì„œë²„ê°€ ë³´ê´€í•˜ê³  ìˆëŠ” ì¤‘ìš” ì •ë³´ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í‚¤ë§Œ ê°€ì§€ê³  ìˆê³ , ì´ í‚¤ ë˜í•œ ìœ íš¨ì‹œê°„ì„ ì§§ê²Œ ë‘¬ì„œ ê°±ì‹ ë˜ë„ë¡ í•˜ë©´ ë³´ì•ˆì ìœ¼ë¡œ ë§ì´ ì•ˆì „í•´ì§ˆ ê²ƒì´ë‹¤.  
ê·¸ë¦¬ê³  ì´ë ‡ê²Œ ì¤‘ìš”í•œ ì •ë³´ë¥¼ ì„œë²„ì— ë³´ê´€ ë° ì—°ê²° ìœ ì§€ ë°©ë²•ì„ ì„¸ì…˜ì´ë¼ í•œë‹¤.

# ğŸ’¡ ì„¸ì…˜ì„ í†µí•œ ë¡œê·¸ì¸ ì²˜ë¦¬
ì¤‘ìš” ì •ë³´ëŠ” ì„œë²„ì˜ ì„¸ì…˜ ì €ì¥ì†Œì— key/valueë¡œ ì €ì¥í•œ ë’¤ ë¸Œë¼ìš°ì €ì—ì„œëŠ” keyê°’ë§Œ ê°€ì§€ê³  ìˆë„ë¡ í•˜ëŠ” ê²ƒì´ë‹¤.  ì´ ê°œë…ì„ ê·¸ë¦¼ìœ¼ë¡œ í‘œí˜„í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.
![image](https://user-images.githubusercontent.com/39439576/228253506-b3445b47-d02f-404d-927b-2ea57e7e9336.png)
#### í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ëŠ” ê²°êµ­ ì¿ í‚¤ë¡œ ì—°ê²°ì´ ë˜ì–´ì•¼ í•œë‹¤.
* ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ì— sessionId ë§Œ ì¿ í‚¤ì— ë‹´ì•„ì„œ ì „ë‹¬í•œë‹¤.
* í´ë¼ì´ì–¸íŠ¸ëŠ” ì¿ í‚¤ ì €ì¥ì†Œì— sessionId ì¿ í‚¤ë¥¼ ë³´ê´€í•œë‹¤.
#### ì¤‘ìš”
* ì—¬ê¸°ì„œ ì¤‘ìš”í•œ í¬ì¸íŠ¸ëŠ” íšŒì›ê³¼ ê´€ë ¨ëœ ì •ë³´ëŠ” í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì´ë‹¤.
* ì˜¤ì§ ì¶”ì • ë¶ˆê°€ëŠ¥í•œ ì„¸ì…˜ IDë§Œ ì¿ í‚¤ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬í•œë‹¤.
#### ì„œë¸”ë¦¿ì—ì„œëŠ” HttpSessionê°ì²´ë¥¼ ì œê³µí•˜ê³  ìˆë‹¤. 
* ì„œë¸”ë¦¿ì„ í†µí•´ HttpSession ì„ ìƒì„±í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì¿ í‚¤ë¥¼ ìƒì„±í•œë‹¤. 
* ì¿ í‚¤ ì´ë¦„ì´ JSESSIONID ì´ê³ , ê°’ì€ ì¶”ì • ë¶ˆê°€ëŠ¥í•œ ëœë¤ ê°’ì´ë‹¤.
* Cookie: JSESSIONID=5B78E23B513F50164D6FDD8C97B0AD05

# ğŸ’¡ ì„œë¸”ë¦¿ HttpSessionì„ ì´ìš©í•œ ë¡œê·¸ì¸ ì²˜ë¦¬
```java
@PostMapping("login")
public String loginV3(@Valid @ModelAttribute LoginForm form, BindingResult bindingResult, 
        HttpServletRequest request, HttpServletResponse response) {
        
    if (bindingResult.hasErrors()) {
        return "login/loginForm";
    }

    Member loginMember = loginService.login(form.getLoginId(), form.getPassword());
    if (loginMember == null) {
        bindingResult.reject("loginFail", "ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        return "login/loginForm";
    }

    //ì„¸ì…˜ì´ ìˆìœ¼ë©´ ìˆëŠ” ì„¸ì…˜ ë°˜í™˜, ì—†ìœ¼ë©´ ì‹ ê·œ ì„¸ì…˜ ìƒì„±
    HttpSession session = request.getSession();
    //ì„¸ì…˜ì— ë¡œê·¸ì¸ íšŒì› ì •ë³´ ë³´ê´€
    session.setAttribute(SessionConst.LOGIN_MEMBER, loginMember);

    return "redirect:/";
}

@PostMapping("/logout")
public String logoutV3(HttpServletResponse response, HttpServletRequest request) {
    HttpSession session = request.getSession(false);
    if (session != null) {
        session.invalidate();
    }

    return "redirect:/";
}
```
### ì„¸ì…˜ ìƒì„±ê³¼ ì¡°íšŒ
request.getSession()
  * getSession ë©”ì„œë“œëŠ” ì„¸ì…˜ì„ ìƒì„± í˜¹ì€ ì¡°íšŒí•˜ëŠ” ë©”ì„œë“œì´ë‹¤. 
  * public HttpSession getSession(boolean create); //default true  

ì—¬ê¸°ì„œ create ì˜µì…˜ì˜ ì˜ë¯¸ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. 
* trueì¼ ê²½ìš°
  * ì„¸ì…˜ì´ ìˆìœ¼ë©´ ê¸°ì¡´ ì„¸ì…˜ì„ ë°˜í™˜í•œë‹¤.
  * ì„¸ì…˜ì´ ì—†ìœ¼ë©´ ìƒˆë¡œìš´ ì„¸ì…˜ì„ ìƒì„±í•´ ë°˜í™˜í•œë‹¤.
* falseì¼ ê²½ìš°
  * ì„¸ì…˜ì´ ìˆìœ¼ë©´ ê¸°ì¡´ ì„¸ì…˜ì„ ë°˜í™˜í•œë‹¤.
  * ì„¸ì…˜ì´ ì—†ìœ¼ë©´ ìƒˆë¡œìš´ ì„¸ì…˜ì„ ìƒì„±í•˜ì§€ ì•Šê³  nullì„ ë°˜í™˜í•œë‹¤.

session.invalidate();
* ì„¸ì…˜ì„ ì œê±°í•˜ëŠ” ë©”ì„œë“œ

### @SessionAttribute ì• ë…¸í…Œì´ì…˜ í™œìš©
ìŠ¤í”„ë§ì€ ì„¸ì…˜ì„ ë” í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ @SessionAttributeë¼ëŠ” ì• ë…¸í…Œì´ì…˜ì„ ì œê³µí•œë‹¤.
```java
@GetMapping("/")
public String homeLoginV3Spring(
        @SessionAttribute(name = SessionConst.LOGIN_MEMBER, required = false)Member loginMember,
        HttpServletRequest request, Model model) {

    if (loginMember == null) {
        return "home";
    }

    model.addAttribute("member", loginMember);
    return "loginHome";
}
```
@SessionAttribute(name = SessionConst.LOGIN_MEMBER, required = false)  
: ì´ì „ì— ì‚¬ìš©í•œ @CookieValueì™€ ë¹„ìŠ·í•˜ë‹¤. í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì „ë‹¬ë°›ì€ ë‚´ìš©ì˜ ì„¸ì…˜ì¤‘ì—ì„œ keyê°€ ì¼ì¹˜í•˜ëŠ”ê²Œ ìˆëŠ”ì§€ ì°¾ëŠ”ë‹¤. requiredê°€ falseì´ë‹ˆ ë§Œì•½ ëª»ì°¾ìœ¼ë©´ nullì´ í• ë‹¹ë  ê²ƒì´ë‹¤.

### HttpSessionì—ì„œ ì œê³µí•˜ëŠ” ì •ë³´
HttpSessionì—ì„œëŠ” ë§ì€ ì„¸ì…˜ì •ë³´ë¥¼ ì œê³µí•˜ëŠ”ë° ë‹¤ìŒê³¼ ê°™ë‹¤. 
```java
public void printSessionInfo(HttpServletRequest request, String sessionId){
		HttpSession session = request.getSession(false);    

    log.info("sessionId={}", session.getId());
    log.info("getMaxInactiveInterval={}", session.getMaxInactiveInterval());
    log.info("creationTime={}", new Date(session.getCreationTime()));
    log.info("lastAccessedTime={}", new Date(session.getLastAccessedTime()));
    log.info("isNew={}", session.isNew());
}
```
* sessionId : ì„¸ì…˜ ì•„ì´ë””(JSESSIONID)ì˜ ê°’(ex:754BE5D4DD969894D958AC278370D06E)
* maxInactiveInterval : ì„¸ì…˜ì˜ ìœ íš¨ ì‹œê°„(ex: 1800ì´ˆ, (30ë¶„))
* creationTime: ì„¸ì…˜ ìƒì„±ì¼ì‹œ
* lastAccessedTime : ì„¸ì…˜ê³¼ ì—°ê²°ëœ ì‚¬ìš©ìê°€ ìµœê·¼ì— ì„œë²„ì— ì ‘ì†í•œ ì‹œê°„. (í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ë¡œ sessionId(JSESSIONID)ë¥¼ ìš”ì²­í•œ ê²½ìš° ê°±ì‹ ëœë‹¤.)
* isNew : ìƒˆë¡œ ìƒì„±ëœ ì„¸ì…˜ì¸ì§€, ì•„ë‹ˆë©´ ì´ë¯¸ ê³¼ê±°ì— ë§Œë“¤ì–´ì¡Œê³ , í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ë¡œ sessionId(JSESSIONID)ë¥¼ ìš”ì²­í•´ì„œ ì¡°íšŒëœ ì„¸ì…˜ì¸ì§€ ì—¬ë¶€
