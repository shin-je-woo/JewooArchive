# 검증 - Validation
![image](https://user-images.githubusercontent.com/39439576/225552795-9b354b9f-f025-462d-b0fc-288f18233e57.png)
1. 사용자가 상품 등록페이지에 접근한다(HTTP GET /add)
2. 사용자가 상품정보를 입력 후 서버로 전송한다(HTTP POST /add)
3. 상품의 유효성 검증이 실패하면 검증 오류 결과가 포함된 정보를 담아 다시 상품 등록 페이지로 이동한다.

# BindingResult를 이용하여 검증하기
* 스프링이 제공하는 검증 오류 처리 방법
* 컨트롤러의 매핑 메서드에서 BindingResult를 매개변수로 받음으로써 타입 불일치에 대한 대응도 가능해진다.
* BindingResult 매개변수는 무조건 전송받을 객체(ex: Item) 다음에 위치해야 한다.
> 검증 컨트롤러
```java
@PostMapping("/add")
public String addItemV1(@ModelAttribute Item item, BindingResult bindingResult, RedirectAttributes redirectAttributes) {

    // 검증 로직
    if (!StringUtils.hasText(item.getItemName())) {
        bindingResult.addError(new FieldError("item", "itemName", "상품 이름은 필수입니다."));
    }
    if (item.getPrice() == null || item.getPrice() < 1000 || item.getPrice() > 1000000 ) {
        bindingResult.addError(new FieldError("item", "price", "가격은 1,000원 ~ 1,000,000원까지 허용합니다."));
    }
    if (item.getQuantity() == null || item.getQuantity() >= 9999) {
        bindingResult.addError(new FieldError("item", "quantity", "수량은 최대 9,999까지 허용합니다."));
    }

     // 특정 필드가 아닌 복합 룰 검증
    if (item.getPrice() != null && item.getQuantity() != null) {
        int resultPrice = item.getPrice() * item.getQuantity();
        if (resultPrice < 10000) {
            bindingResult.addError(new ObjectError("item", "가격 * 수량의 합은 10,000원 이상이어야 합니다."));
        }
    }

    // 검증에 실패하면 다시 입력 폼으로
    if (bindingResult.hasErrors()) {
        log.info("erros={} ", bindingResult);
        return "/validation/v2/addForm";
    }

    // 성공 로직
    Item savedItem = itemRepository.save(item);
    redirectAttributes.addAttribute("itemId", savedItem.getId());
    redirectAttributes.addAttribute("status", true);
    return "redirect:/validation/v2/items/{itemId}";
}
```

> 검증 페이지(타임리프)
```html
<div th:if="${#fields.hasGlobalErrors()}">
    <p class="field-error"
       th:each="err : ${#fields.globalErrors()}"
       th:text="${err}">
        글로벌 오류 메시지
    </p>
</div>
<div>
    <label for="itemName" th:text="#{label.item.itemName}">상품명</label>
    <input type="text" id="itemName" th:field="*{itemName}"
           th:errorclass="field-error" class="form-control"
           placeholder="이름을 입력하세요">
    <div class="field-error" th:errors="*{itemName}">상품명 오류</div>
</div>
```
#### 타임리프 스프링 검증 오류 통합 기능
타임리프는 스프링의 BindingResult 를 활용해서 편리하게 검증 오류를 표현하는 기능을 제공한다.
* `#fields` : BindingResult 가 제공하는 검증 오류에 접근할 수 있다.
* `th:errors` : 해당 필드에 오류가 있는 경우에 태그를 출력한다. th:if 의 편의 버전이다.
* `th:errorclass` : th:field 에서 지정한 필드에 오류가 있으면 class 정보를 추가한다.

