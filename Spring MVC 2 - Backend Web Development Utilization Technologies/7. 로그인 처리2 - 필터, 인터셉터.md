# ğŸ’¡ ê³µí†µ ê´€ì‹¬ ì‚¬í•­
ëŒ€ë¶€ë¶„ ë§ì€ ì›¹ ì„œë¹„ìŠ¤ëŠ” ë¡œê·¸ì¸ì„ í•´ì•¼ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•  ìˆ˜ ìˆë‹¤.  
ë¡œê·¸ì¸ì„ í•˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í˜ì´ì§€ê°€ ì œí•œì ì´ë©° ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ ì ‘ê·¼ì´ í—ˆìš©ë˜ì„œëŠ” ì•ˆëœë‹¤.  
í•˜ì§€ë§Œ, ê·¸ë ‡ë‹¤ê³  ë¡œê·¸ì¸ì´ í•„ìš”í•œ ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ ë¡œì§ì— ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒì€ ë„ˆë¬´ ë¹„íš¨ìœ¨ì ì´ë‹¤. ìˆ˜ì •ì—ë„ ì·¨ì•½í•˜ë‹¤. 
ì´ë ‡ê²Œ ë§ì€ ë¡œì§ì—ì„œ ê³µí†µìœ¼ë¡œ ê´€ì‹¬ì´ ìˆëŠ” ë¶€ë¶„ì„ `ê³µí†µ ê´€ì‹¬ì‚¬(cross-cutting concerns)`ë¼ í•œë‹¤.  

ì—¬ëŸ¬ ë¡œì§ì—ì„œ ê³µí†µìœ¼ë¡œ ë¡œê·¸ì¸ì— ê´€ì‹¬ì„ ê°€ì§€ê³  ìˆëŠ”ë°, ì´ëŸ¬í•œ ê³µí†µ ê´€ì‹¬ì‚¬ëŠ” ìŠ¤í”„ë§ì—ì„œ AOPë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.  
í•˜ì§€ë§Œ, ì›¹ì— ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ì‚¬ëŠ” ìŠ¤í”„ë§ AOP ë³´ë‹¤ëŠ” `ì„œë¸”ë¦¿ í•„í„°`, `ìŠ¤í”„ë§ ì¸í„°ì…‰í„°`ì—ì„œ ì²˜ë¦¬í•˜ëŠ”ê²Œ ì¢‹ë‹¤.  
ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ì‚¬ë¥¼ ì²˜ë¦¬í•  ë•ŒëŠ” HTTPì˜ í—¤ë”ë‚˜ URL ì •ë³´ê°€ í•„ìš”í•œë° ì„œë¸”ë¦¿ í•„í„°ë‚˜, ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” HttpServletRequestë¥¼ ì œê³µí•œë‹¤.

# ğŸ’¡ ì„œë¸”ë¦¿ í•„í„° vs ìŠ¤í”„ë§ ì¸í„°ì…‰í„°
ì„œë¸”ë¦¿ í•„í„°ì™€ ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ëª¨ë‘ ì›¹ê³¼ ê´€ë ¨ëœ ê³µí†µ ê´€ì‹¬ì‚¬ë¥¼ ì²˜ë¦¬í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” ê¸°ìˆ ì´ë‹¤.  
`í•„í„°`ëŠ” ì„œë¸”ë¦¿ì—ì„œ ì œê³µí•˜ê³  `ì¸í„°ì…‰í„°`ëŠ” ìŠ¤í”„ë§ MVCê°€ ì œê³µí•˜ëŠ” ê¸°ìˆ ì¸ë°, ì ìš©ë˜ëŠ” ìˆœì„œì™€ ë²”ìœ„, ê·¸ë¦¬ê³  ì‚¬ìš©ë°©ë²•ì´ ë‹¤ë¥´ë‹¤. 

![image](https://user-images.githubusercontent.com/39439576/228564529-47c2012e-2f5c-49c2-994f-43a9f04f688c.png)
* í•„í„°ë¥¼ ì ìš©í•˜ë©´ í•„í„°ê°€ í˜¸ì¶œëœ ì´í›„ ì„œë¸”ë¦¿ì´ í˜¸ì¶œëœë‹¤. (ì—¬ê¸°ì„œ ì„œë¸”ë¦¿ì€ ìŠ¤í”„ë§ì˜ ê²½ìš° ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ì„ ì˜ë¯¸í•œë‹¤ê³  ìƒê°í•˜ë©´ ëœë‹¤.)
* ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•˜ë©´ ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ê³¼ ì»¨íŠ¸ë¡¤ëŸ¬ ì‚¬ì´ì—ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì§ì „ì— í˜¸ì¶œëœë‹¤.
* í•„í„°ëŠ” ì„œë¸”ë¦¿ í˜¸ì¶œ ì „ì—, ì¸í„°ì…‰í„°ëŠ” ì„œë¸”ë¦¿ í˜¸ì¶œ ì´í›„ í˜¸ì¶œë˜ê¸° ë•Œë¬¸ì— ì¸í„°ì…‰í„°ëŠ” ì„œë¸”ë¦¿ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤ë©´ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.

![image](https://user-images.githubusercontent.com/39439576/228565212-b4077ef7-778c-42ae-adaa-0dcf3ad405d5.png)
* í•„í„°ì™€ ì¸í„°ì…‰í„°ëŠ” ê°ê° ìš”ì²­ì´ ì ì ˆí•˜ì§€ ì•Šì„ ê²½ìš° ìì‹ ì˜ ìƒíƒœì—ì„œ ì¢…ë£Œí•  ìˆ˜ ìˆë‹¤. (ê·¸ë˜ì„œ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ê¸° ì¢‹ë‹¤.)
* í•„í„°ëŠ” ì„œë¸”ë¦¿ê¹Œì§€ ê°€ì§€ ëª»í•˜ì§€ë§Œ, ìŠ¤í”„ë§ ì¸í„°ì…‰í„°ëŠ” ì„œë¸”ë¦¿ê¹Œì§€ í†µê³¼ í›„ ì œí•œì´ ëœë‹¤. 

![image](https://user-images.githubusercontent.com/39439576/228565623-b0bc6df3-b5e8-499d-93d8-a67be7cb4bf4.png)
* ë‘˜ ë‹¤ ììœ ë¡­ê²Œ í•„í„° ë° ì¸í„°ì…‰í„°ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤. 
* ë¡œê·¸ë¥¼ ë‚¨ê¸°ëŠ” í•„í„°(í˜¹ì€ ì¸í„°ì…‰í„°)ë¥¼ ì ìš© í›„ ê·¸ ë‹¤ìŒ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ ì²´í¬í•˜ëŠ” í•„í„°(í˜¹ì€ ì¸í„°ì…‰í„°)ë¥¼ ë§Œë“¤ì–´ ì ìš©í•  ìˆ˜ ìˆë‹¤. 

# ğŸ’¡ ì„œë¸”ë¦¿ í•„í„°
### Filter ì¸í„°í˜ì´ìŠ¤
```java
public interface Filter {
    public default void init(FilterConfig filterConfig) throws ServletException {}

    public void doFilter(ServletRequest request, ServletResponse response,
            FilterChain chain) throws IOException, ServletException;

    public default void destroy() {}
}
```
* í•„í„° ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  ë“±ë¡í•˜ë©´ ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ í•„í„°ë¥¼ ì‹±ê¸€í†¤ ê°ì²´ë¡œ ìƒì„±í•˜ê³ , ê´€ë¦¬í•œë‹¤.
* init(): í•„í„° ì´ˆê¸°í™” ë©”ì„œë“œ, ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ìƒì„±ë  ë•Œ í˜¸ì¶œëœë‹¤.
* doFilter(): ê³ ê°ì˜ ìš”ì²­ì´ ì˜¬ ë•Œ ë§ˆë‹¤ í•´ë‹¹ ë©”ì„œë“œê°€ í˜¸ì¶œëœë‹¤. í•„í„°ì˜ ë¡œì§ì„ êµ¬í˜„í•˜ë©´ ëœë‹¤.
* destroy(): í•„í„° ì¢…ë£Œ ë©”ì„œë“œ, ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë  ë•Œ í˜¸ì¶œëœë‹¤.

### ìš”ì²­ ë¡œê·¸ í•„í„° êµ¬í˜„í•´ë³´ê¸°
> LogFilter
```java
@Slf4j
public class LogFilter implements Filter {
  
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
        log.info("log filter init");
    }

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
       
        log.info("log filter doFilter");

        HttpServletRequest httpRequest = (HttpServletRequest) request;
        String requestURI = httpRequest.getRequestURI();
        String uuid = UUID.randomUUID().toString();

        try{
            log.info("REQUEST [{}][{}]", uuid, requestURI);
            chain.doFilter(request, response);
        }catch(Exception e){
            throw e;
        }finally {
            log.info("RESPONSE [{}][{}]", uuid, requestURI);
        }
    }

    @Override
    public void destroy() {
        log.info("log filter destroy");
    }
}
```
* Filter ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ë©° init, doFilter, destroy ë©”ì„œë“œë¥¼ ì¬ì •ì˜í•´ì¤€ë‹¤.
* doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
  * HTTP ìš”ì²­ì´ ì˜¤ë©´ doFilterê°€ í˜¸ì¶œëœë‹¤. 
  * ServletRequest requestëŠ” HTTP ìš”ì²­ì´ ì•„ë‹Œ ê²½ìš°ë„ ê³ ë ¤í•´ì„œ ë§Œë“  ì¸í„°í˜ì´ìŠ¤ì´ë‹¤. HTTPë¥¼ ì‚¬ìš©í•˜ë©´ HttpServletRequestë¡œ ë‹¤ìš´ìºìŠ¤íŒ…í•œ ë’¤ ì‚¬ìš©í•˜ë©´ ëœë‹¤. 
* â— chain.doFilter(request, response);
  * ì´ ë¶€ë¶„ì´ ê°€ì¥ ì¤‘ìš”í•˜ë‹¤. ë‹¤ìŒ í•„í„°ê°€ ìˆìœ¼ë©´ í•„í„°ë¥¼ í˜¸ì¶œí•˜ê³ , í•„í„°ê°€ ì—†ìœ¼ë©´ ì„œë¸”ë¦¿ì„ í˜¸ì¶œí•œë‹¤.
  * ë§Œì•½ ì´ ë¡œì§ì„ í˜¸ì¶œí•˜ì§€ ì•Šìœ¼ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.

> WebConfig - í•„í„° ì„¤ì •
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
  
    @Bean
    public FilterRegistrationBean logFilter() {
        FilterRegistrationBean<Filter> filterRegistrationBean = new FilterRegistrationBean<>();
        filterRegistrationBean.setFilter(new LogFilter());
        filterRegistrationBean.setOrder(1);
        filterRegistrationBean.addUrlPatterns("/*");

        return filterRegistrationBean;
    }
}
```
í•„í„°ë¥¼ ë“±ë¡í•˜ëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ê°€ì§€ê°€ ìˆì§€ë§Œ, ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ FilterRegistrationBean ì„ ì‚¬ìš©í•´ì„œ ë“±ë¡í•˜ë©´ ëœë‹¤.
* setFilter(new LogFilter()) : ë“±ë¡í•  í•„í„°ë¥¼ ì§€ì •í•œë‹¤.
* setOrder(1) : í•„í„°ëŠ” ì²´ì¸ìœ¼ë¡œ ë™ì‘í•œë‹¤. ë”°ë¼ì„œ ìˆœì„œê°€ í•„ìš”í•˜ë‹¤. ë‚®ì„ ìˆ˜ë¡ ë¨¼ì € ë™ì‘í•œë‹¤.
* addUrlPatterns("/*") : í•„í„°ë¥¼ ì ìš©í•  URL íŒ¨í„´ì„ ì§€ì •í•œë‹¤. í•œë²ˆì— ì—¬ëŸ¬ íŒ¨í„´ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

### ë¡œê·¸ì¸ ì¸ì¦ í•„í„° êµ¬í˜„í•´ë³´ê¸°
> LoginCheckFilter - whitelistë¡œ ì§€ì •í•œ ê²½ë¡œë¥¼ ì œì™¸í•˜ê³ ëŠ” ëª¨ë‘ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ê²€ì‚¬ í›„ í˜ì´ì§€ ì ‘ê·¼ ì—¬ë¶€ë¥¼ ê²°ì •í•œë‹¤. 
```java
@Slf4j
public class LoginCheckFilter implements Filter {

    private static final String[] whitelist = {"/", "/members/add", "/login", "/logout", "/css/*"};

    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        String requestURI = httpRequest.getRequestURI();
        HttpServletResponse httpResponse = (HttpServletResponse) response;

        try {
            log.info("ì¸ì¦ ì²´í¬ í•„í„° ì‹œì‘ {}", requestURI);
            if (isLoginPathCheck(requestURI)) {
                log.info("ì¸ì¦ ì²´í¬ ë¡œì§ ì‹¤í–‰ {}", requestURI);
                HttpSession session = httpRequest.getSession(false);
                if (session == null || session.getAttribute(SessionConst.LOGIN_MEMBER) == null) {
                    log.info("ë¯¸ì¸ì¦ ì‚¬ìš©ì ìš”ì²­ {}", requestURI);
                    //ë¡œê·¸ì¸ìœ¼ë¡œ redirect
                    httpRespone.sendRedirect("/login?redirectURL=" + requestURI);
                    return; //ì—¬ê¸°ê°€ ì¤‘ìš”, ë¯¸ì¸ì¦ ì‚¬ìš©ìëŠ” ë‹¤ìŒìœ¼ë¡œ ì§„í–‰í•˜ì§€ ì•Šê³  ë!
                }
            }
            chain.doFilter(request, response);
        } catch (Exception e) {
            throw e; //ì˜ˆì™¸ ë¡œê¹… ê°€ëŠ¥ í•˜ì§€ë§Œ, í†°ìº£ê¹Œì§€ ì˜ˆì™¸ë¥¼ ë³´ë‚´ì£¼ì–´ì•¼ í•¨
        } finally {
            log.info("ì¸ì¦ ì²´í¬ í•„í„° ì¢…ë£Œ {}", requestURI);
        }
    }

    /**
     * whiteListì˜ ê²½ìš° ì¸ì¦ ì²´í¬ë¥¼ ì•ˆí•˜ë„ë¡ í•œë‹¤.
     */
    private boolean isLoginCheckPath(String requestURI) {
        return !PatternMatchUtils.simpleMatch(whitelist, requestURI);
    }

}
```
* whitelist = {"/", "/members/add", "/login", "/logout","/css/*"};
  * ì¸ì¦ í•„í„°ë¥¼ ì ìš©í•´ë„ í™ˆ, íšŒì›ê°€ì…, ë¡œê·¸ì¸ í™”ë©´, css ê°™ì€ ë¦¬ì†ŒìŠ¤ì—ëŠ” ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. 
  * ì´ë ‡ê²Œ í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ ê²½ë¡œëŠ” ì¸ì¦ê³¼ ë¬´ê´€í•˜ê²Œ í•­ìƒ í—ˆìš©í•œë‹¤. 
  * í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ëª¨ë“  ê²½ë¡œì—ëŠ” ì¸ì¦ ì²´í¬ ë¡œì§ì„ ì ìš©í•œë‹¤.
* isLoginCheckPath(requestURI)
  * í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸ë¥¼ ì œì™¸í•œ ëª¨ë“  ê²½ìš°ì— ì¸ì¦ ì²´í¬ ë¡œì§ì„ ì ìš©í•œë‹¤.
* httpResponse.sendRedirect("/login?redirectURL=" + requestURI);
  * ë¯¸ì¸ì¦ ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•œë‹¤. 
  * ê·¸ëŸ°ë° ë¡œê·¸ì¸ ì´í›„ì— ë‹¤ì‹œ í™ˆìœ¼ë¡œ ì´ë™í•´ë²„ë¦¬ë©´, ì›í•˜ëŠ” ê²½ë¡œë¥¼ ë‹¤ì‹œ ì°¾ì•„ê°€ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìˆë‹¤.
  *  ì˜ˆë¥¼ ë“¤ì–´ì„œ ìƒí’ˆ ê´€ë¦¬ í™”ë©´ì„ ë³´ë ¤ê³  ë“¤ì–´ê°”ë‹¤ê°€ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ë©´, ë¡œê·¸ì¸ ì´í›„ì— ë‹¤ì‹œ ìƒí’ˆ ê´€ë¦¬ í™”ë©´ìœ¼ë¡œ ë“¤ì–´ê°€ëŠ” ê²ƒì´ ì¢‹ë‹¤. 
  *  ì´ëŸ¬í•œ ê¸°ëŠ¥ì„ ìœ„í•´ í˜„ì¬ ìš”ì²­í•œ ê²½ë¡œì¸ requestURI ë¥¼ /login ì— queryStringìœ¼ë¡œ í•¨ê»˜ ì „ë‹¬í•œë‹¤. 
  *  ë¬¼ë¡  /login ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë¡œê·¸ì¸ ì„±ê³µì‹œ í•´ë‹¹ ê²½ë¡œë¡œ ì´ë™í•˜ëŠ” ê¸°ëŠ¥ì€ ì¶”ê°€ë¡œ ê°œë°œí•´ì•¼ í•œë‹¤.
* return;
  *  ì—¬ê¸°ê°€ ì¤‘ìš”í•˜ë‹¤. í•„í„°ë¥¼ ë”ëŠ” ì§„í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤. 
  *  ì´í›„ í•„í„°ëŠ” ë¬¼ë¡  ì„œë¸”ë¦¿, ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë”ëŠ” í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤. 
  *  ì•ì„œ redirect ë¥¼ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— redirect ê°€ ì‘ë‹µìœ¼ë¡œ ì ìš©ë˜ê³  ìš”ì²­ì´ ëë‚œë‹¤.

> WebConfig - loginCheckFilter ì„¤ì •
```java
@Bean
public FilterRegistrationBean loginCheckFilter() {
    FilterRegistrationBean<Filter> filterRegistrationBean = new FilterRegistrationBean<>();
    filterRegistrationBean.setFilter(new LoginCheckFilter());
    filterRegistrationBean.setOrder(2);
    filterRegistrationBean.addUrlPatterns("/*");

    return filterRegistrationBean;
}
```
* ë“±ë¡í•˜ëŠ” ë‚´ìš©ì€ ìœ„ì™€ ë™ì¼í•˜ê¸°ì— ë”°ë¡œ ì„¤ëª…ì€ ìƒëµí•œë‹¤. 
* ì—¬ê¸°ì„œ í—ˆìš© URLì€ /*ìœ¼ë¡œ ì „ë¶€ í—ˆìš©ì„ í•´ ì¤€ ìƒíƒœì´ë‹¤. í•˜ì§€ë§Œ, í•„í„° ë‚´ë¶€ì— í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ê°€ ìˆê¸° ë•Œë¬¸ì— ê²€ì‚¬ê°€ ë¶ˆí•„ìš”í•œ ê²½ë¡œëŠ” ê²€ì‚¬ë¥¼ í•˜ì§€ ì•ŠëŠ”ë‹¤. 
