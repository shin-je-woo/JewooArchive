# 타임리프 스프링 통합
타임리프는 스프링 없이도 동작하지만, 스프링과 통합을 위한 다양한 기능을 편리하게 제공한다.  
그리고 이런 부분은 스프링으로 백엔드를 개발하는 개발자 입장에서 타임리프를 선택하는 하나의 이유가 된다.

#### 스프링 통합으로 추가되는 기능들
* 스프링의 SpringEL 문법 통합
* ${@myBean.doSomething()} 처럼 스프링 빈 호출 지원
* 편리한 폼 관리를 위한 추가 속성
  * th:object (기능 강화, 폼 커맨드 객체 선택)
  * th:field , th:errors , th:errorclass
* 폼 컴포넌트 기능
  * checkbox, radio button, List 등을 편리하게 사용할 수 있는 기능 지원
* 스프링의 메시지, 국제화 기능의 편리한 통합
* 스프링의 검증, 오류 처리 통합
* 스프링의 변환 서비스 통합(ConversionService)

# 입력 폼 처리
th:object, *{...}, th:field 3개를 함께 사용하면 &lt;form&gt;을 편리하게 작성할 수 있다.
* th:object : 커맨드 객체를 지정한다.
  * 단, 해당 오브젝트 정보를 model에 담아서 넘겨주어야 한다.
  * 등록 폼이기 때문에 데이터가 비어있는 빈 오브젝트를 만들어서 뷰에 전달한다.
* *{...} : 선택 변수 식이라고 한다. th:object 에서 선택한 객체에 접근한다.
  * ${객체.필드}와 같다.
  * th:object=${객체명} + *{필드명} 을 사용하던지, ${객체.필드}를 사용하던지 선택하면 된다.
* th:field
  * HTML 태그의 id , name , value 속성을 자동으로 만들어준다.
  * value는 th:field에서 지정한 변수의 값(model에 담긴 값)을 사용한다.
```java
@GetMapping("/add")
public String addForm(Model model) {
  model.addAttribute("item", new Item()); //빈 오브젝트를 뷰에 넘겨준다.
  return "form/addForm";
}
```
> 렌더링 전
```html
<form action="item.html" th:action th:object="${item}" method="post">
	<label for="itemName">상품명</label>
	<input type="text" th:field="*{itemName}" placeholder="상품명을 입력하세요">
</form>
```
> 렌더링 후
```html
<form action method="post">
	<label for="itemName">상품명</label>
	<input type="text" id="itemName" name="itemName" value="" placeholder="상품명을 입력하세요">
</form>
```

# 체크 박스-싱글
```html
<form action="/thymeleaf/result" method="post">
  <input type="checkbox" id="open" name="open">
  <label for="open">판매 오픈</label>
  <button>submit</button>
</form>
```
#### 위와 같은 form을 서버로 전송하면 어떻게 되는가?
1. 체크되어 있는 상태: controller에서 스프링 `타입 컨버터`를 이용해 정상적으로 값을 받는다.
    * String으로 받으면 open=on, boolean으로 받으면 open=true
    * item.open=true // 체크 박스를 선택하는 경우
2. 체크되어 있지 않은 상태: open이라는 필드 자체가 서버로 전송되지 않는다.
    * 서버 입장에서는 open 필드를 체크하지 않은건지, 진짜로 값이 넘어오지 않은건지 판단할 수 없다.
    * item.open=null // 체크 박스를 선택하지 않은 경우
* 이런 문제를 해결하기 위해 스프링은 히든 필드를 만들어서 체크되지 않으면 open=false을 받는다.
* 히든 필드는 다음과 같은 규칙에 따라 만든다.
  * type="hidden"
  * name="_"+기존 체크 박스 이름
> 수정 코드
```html
<form action="/thymeleaf/result" method="post">
  <input type="checkbox" id="open" name="open">
  <input type="hidden" name="_open" value="on"/>  <!-- 히든 필드 추가 -->
  <label for="open">판매 오픈</label>
  <button>submit</button>
</form>
```
#### 스프링 MVC의 체크박스 체크여부 확인
1. 체크 박스 체크
    * open=on&_open=on
    * 체크 박스를 체크하면 스프링 MVC가 open 에 값이 있는 것을 확인하고 사용한다. 이때 _open 은 무시한다.
2. 체크 박스 미체크
    * _open=on
    * 체크 박스를 체크하지 않으면 스프링 MVC가 _open 만 있는 것을 확인하고, open 의 값이 체크되지 않았다고 인식한다.
    * 이 경우 서버에서 Boolean 타입을 찍어보면 결과가 null 이 아니라 false 인 것을 확인할 수 있다.

####  타임리프가 제공하는 폼 기능을 사용하면 이런 부분을 자동으로 처리할 수 있다.
> 타임리프 적용
```html
<form action="/thymeleaf" method="post">
  <input type="checkbox" id="open" th:field="${item.open}">
  <label for="open">판매 오픈</label>
  <button>submit</button>
</form>
```
> 타임리프 렌더링 결과
```html
<div class="form-check">
  <input type="checkbox" id="open" name="open" value="true">
  <input type="hidden" name="_open" value="on"/>
  <label for="open">판매 오픈</label>
</div>
```

# 체크박스-멀티
```java
@ModelAttribute("regions")
public Map<String, String> regions() {
    Map<String, String> regions = new LinkedHashMap<>();
    regions.put("SEOUL", "서울");
    regions.put("BUSAN", "부산");
    regions.put("JEJU", "제주");
    return regions;
}
```
#### 
