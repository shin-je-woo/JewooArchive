# Previous
* ì£¼ë¬¸ë‚´ì—­ì—ì„œ ì¶”ê°€ë¡œ ì£¼ë¬¸í•œ ìƒí’ˆ ì •ë³´ë¥¼ ì¶”ê°€ë¡œ ì¡°íšŒí•˜ì.
* Orderê¸°ì¤€ìœ¼ë¡œ ì»¬ë ‰ì…˜ì¸ OrderItem ì™€ Item ì´ í•„ìš”í•˜ë‹¤.
* ì•ì˜ ì˜ˆì œì—ì„œëŠ” xxxToOne(OneToOne, ManyToOne) ê´€ê³„ë§Œ ìˆì—ˆë‹¤. ì´ë²ˆì—ëŠ” ì»¬ë ‰ì…˜ì¸ ì¼ëŒ€ë‹¤ ê´€ê³„(OneToMany)ë¥¼ ì¡°íšŒí•˜ê³ , ìµœì í™”í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì.

# ğŸ’¡ ì£¼ë¬¸ ì¡°íšŒ V1: ì—”í‹°í‹° ì§ì ‘ ë…¸ì¶œ
```java
@GetMapping("/api/v1/orders")
List<Order> ordersV1() {
    List<Order> all = orderRepository.findAllByString(new OrderSearch());
    for (Order order : all) {
        order.getMember().getName(); //Lazyë•Œë¬¸ì— í”„ë¡ì‹œê°ì²´ ê°•ì œ ì´ˆê¸°í™”
        order.getDelivery().getStatus(); //Lazyë•Œë¬¸ì— í”„ë¡ì‹œê°ì²´ ê°•ì œ ì´ˆê¸°í™”

        List<OrderItem> orderItems = order.getOrderItems();
        orderItems.stream().forEach(o -> o.getItem().getName()); //Lazyë•Œë¬¸ì— í”„ë¡ì‹œê°ì²´ ê°•ì œ ì´ˆê¸°í™”(OrderItem, Item ë‘˜ ë™ì‹œì—)
    }
    return all;
}
```
* orderItem, item ê´€ê³„ë¥¼ ì§ì ‘ ì´ˆê¸°í™”í•˜ë©´ Hibernate5Module ì„¤ì •ì— ì˜í•´ ì—”í‹°í‹°ë¥¼ JSONìœ¼ë¡œ ìƒì„±í•œë‹¤.
* ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë©´ ë¬´í•œ ë£¨í”„ì— ê±¸ë¦¬ì§€ ì•Šê²Œ í•œ ê³³ì— @JsonIgnore ë¥¼ ì¶”ê°€í•´ì•¼ í•œë‹¤.
* ì—”í‹°í‹°ë¥¼ ì§ì ‘ ë…¸ì¶œí•˜ë¯€ë¡œ ì¢‹ì€ ë°©ë²•ì€ ì•„ë‹ˆë‹¤.

# ğŸ’¡ ì£¼ë¬¸ ì¡°íšŒ V2: ì—”í‹°í‹°ë¥¼ DTOë¡œ ë³€í™˜
```java
@GetMapping("/api/v2/orders")
public List<OrderDto> ordersV2() {
    List<Order> orders = orderRepository.findAllByString(new OrderSearch());
    List<OrderDto> collect = orders.stream()
            .map(o -> new OrderDto(o))
            .collect(Collectors.toList());
    return collect;
}

@Data
static class OrderDto {
    private Long orderId;
    private String name;
    private LocalDateTime orderDate;
    private OrderStatus orderStatus;
    private Address address;
    private List<OrderItemDto> orderItems;

    public OrderDto(Order o) {
        orderId = o.getId();
        name = o.getMember().getName(); // Lazy í”„ë¡ì‹œ ì´ˆê¸°í™”
        orderDate = o.getOrderDate();
        orderStatus = o.getStatus();
        address = o.getDelivery().getAddress(); // Lazy í”„ë¡ì‹œ ì´ˆê¸°í™”
        orderItems = o.getOrderItems().stream()
                .map(orderItem -> new OrderItemDto(orderItem))
                .collect(Collectors.toList());
    }
}

@Data
static class OrderItemDto {
    private String itemName; //ìƒí’ˆ ëª…
    private int orderPrice; //ì£¼ë¬¸ ê°€ê²©
    private int count; //ì£¼ë¬¸ ìˆ˜ëŸ‰

    public OrderItemDto(OrderItem orderItem) {
        itemName = orderItem.getItem().getName(); // Lazy í”„ë¡ì‹œ ì´ˆê¸°í™”
        orderPrice = orderItem.getOrderPrice();
        count = orderItem.getCount();
    }
}
```
* OrderDto ìƒì„±ìë¥¼ ì˜ ì‚´í´ë³´ë©´ OrderItemsì—­ì‹œ ì§€ì—°ë¡œë”©ìœ¼ë¡œ í˜¸ì¶œí•´ì£¼ê³  ìˆë‹¤. í•˜ì§€ë§Œ, OrderItemì—­ì‹œ ì—”í‹°í‹°ì´ê¸° ë•Œë¬¸ì— ê·¸ëŒ€ë¡œ í˜¸ì¶œ í•´ì£¼ë©´ ì•ˆëœë‹¤. 
* ê·¸ë ‡ê¸° ë•Œë¬¸ì— í•„ìš”í•œ í•„ë“œë¥¼ í¬í•¨í•˜ëŠ” OrderItemDtoë¥¼ ë§Œë“¤ì–´ì„œ ìƒì„±í•´ì¤˜ì•¼ í•œë‹¤.
* ì§€ì—° ë¡œë”©ìœ¼ë¡œ ë„ˆë¬´ ë§ì€ SQL ì‹¤í–‰
* SQL ì‹¤í–‰ ìˆ˜
  * orderë¦¬ìŠ¤íŠ¸ 1ë²ˆ
  * member, delivery Në²ˆ(order ì¡°íšŒ ìˆ˜ ë§Œí¼)
  * orderItem Në²ˆ(order ì¡°íšŒ ìˆ˜ ë§Œí¼)
  * item Në²ˆ(orderItem ì¡°íšŒ ìˆ˜ ë§Œí¼)

> ğŸ“Œ ì°¸ê³   
> ì§€ì—° ë¡œë”©ì€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ìˆìœ¼ë©´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ìˆëŠ” ì—”í‹°í‹°ë¥¼ ì‚¬ìš©í•˜ê³  ì—†ìœ¼ë©´ SQLì„ ì‹¤í–‰í•œë‹¤.    
> ë”°ë¼ì„œ ê°™ì€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì´ë¯¸ ë¡œë”©í•œ íšŒì› ì—”í‹°í‹°ë¥¼ ì¶”ê°€ë¡œ ì¡°íšŒí•˜ë©´ SQLì„ ì‹¤í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤.

# ğŸ’¡ ì£¼ë¬¸ ì¡°íšŒ V3: ì—”í‹°í‹°ë¥¼ DTOë¡œ ë³€í™˜ - í˜ì¹˜ ì¡°ì¸ ìµœì í™”
```java
@GetMapping("/api/v3/orders")
List<OrderDto> ordersV3() {
    return orderRepository.findAllWithItem().stream()
            .map(o -> new OrderDto(o))
            .collect(toList());
}
```
```java
public List<Order> findAllWithItem() {
    return em.createQuery(
            "select distinct o from Order o " +
                    " join fetch o.member m" +
                    " join fetch o.delivery d" +
                    " join fetch o.orderItems oi" +
                    " join fetch oi.item i", Order.class
    ).getResultList();
}
```
* `í˜ì¹˜ ì¡°ì¸`ìœ¼ë¡œ SQLì´ 1ë²ˆë§Œ ì‹¤í–‰ë¨
* `distinct` ë¥¼ ì‚¬ìš©í•œ ì´ìœ ëŠ” 1ëŒ€ë‹¤ ì¡°ì¸ì´ ìˆìœ¼ë¯€ë¡œ rowìˆ˜ê°€ Oneì˜ ê°¯ìˆ˜ê°€ ì•„ë‹Œ Manyì˜ ê°¯ìˆ˜ë§Œí¼ ì¦ê°€í•œë‹¤.
*  ê·¸ ê²°ê³¼ ê°™ì€ order ì—”í‹°í‹°ì˜ ì¡°íšŒ ìˆ˜ë„ ì¦ê°€í•˜ê²Œ ëœë‹¤. JPAì˜ distinctëŠ” SQLì— distinctë¥¼ ì¶”ê°€í•˜ê³ , ë”í•´ì„œ ê°™ì€ ì—”í‹°í‹°ê°€ ì¡°íšŒë˜ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì¤‘ë³µì„ ê±¸ëŸ¬ì¤€ë‹¤.

âœ… ì»¬ë ‰ì…˜ í˜ì¹˜ì¡°ì¸ê³¼ í˜ì´ì§•
* ì»¬ë ‰ì…˜ í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•˜ë©´ í˜ì´ì§•ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤.
* í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” ê²½ê³  ë¡œê·¸ë¥¼ ë‚¨ê¸°ë©´ì„œ `ëª¨ë“  ë°ì´í„°`ë¥¼ DBì—ì„œ ì½ì–´ì˜¤ê³ , `ë©”ëª¨ë¦¬ì—ì„œ í˜ì´ì§•` í•´ë²„ë¦°ë‹¤(ë§¤ìš° ìœ„í—˜í•˜ë‹¤).
* ì»¬ë ‰ì…˜ í˜ì¹˜ ì¡°ì¸ì€ 1ê°œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. 
* ì»¬ë ‰ì…˜ ë‘˜ ì´ìƒ í˜ì¹˜ì¡°ì¸ì„ ì‚¬ìš©í•˜ë©´ ë°ì´í„°ì˜ ì •í•©ì„±ì´ ë–¨ì–´ì§ˆ ë¿ë§Œ ì•„ë‹ˆë¼ N * Nê°œë¡œ ì¡°íšŒë˜ëŠ” ì¤‘ë³µëœ ROWì˜ ìˆ˜ê°€ ê¸°í•˜ê¸‰ìˆ˜ì ìœ¼ë¡œ ëŠ˜ì–´ë‚˜ê²Œ ëœë‹¤. 

# ğŸ’¡ ì£¼ë¬¸ ì¡°íšŒ V3.1: ì—”í‹°í‹°ë¥¼ DTOë¡œ ë³€í™˜ - í˜ì´ì§•ê³¼ í•œê³„ ëŒíŒŒ
