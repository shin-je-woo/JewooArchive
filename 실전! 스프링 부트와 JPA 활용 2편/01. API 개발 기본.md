# ğŸ’¡ íšŒì› ë“±ë¡ API
â–¶ï¸ íšŒì› ë“±ë¡ V1: ì—”í‹°í‹°ë¥¼ Request Bodyì— ì§ì ‘ ë§¤í•‘
```java
@RestController
@RequiredArgsConstructor
public class MemberApiController {

    private final MemberService memberService;

    @PostMapping("/api/v1/members")
    public CreateMemberResponse saveMemberV1(@RequestBody @Valid Member member) {
        Long id = memberService.join(member);
        return new CreateMemberResponse(id);
    }
    
		@Data
    @AllArgsConstructor
    static class CreateMemberResponse {
        private Long id;
    }
}
```
* ì—”í‹°í‹°ë¥¼ RequestBodyì— ì§ì ‘ ë§¤í•‘í•˜ë©´ ì—¬ëŸ¬ ë¬¸ì œì ì´ ë°œìƒí•œë‹¤.
* ì—”í‹°í‹°ì— í”„ë ˆì  í…Œì´ì…˜ ê³„ì¸µì„ ìœ„í•œ ë¡œì§ì´ ì¶”ê°€ëœë‹¤. 
* ì—”í‹°í‹°ì— API ê²€ì¦ì„ ìœ„í•œ ë¡œì§ì´ ë“¤ì–´ê°„ë‹¤.(ex: @NotEmpty ...)   
  â†’ ì˜ˆë¥¼ ë“¤ì–´, nameí•„ë“œë¥¼ ì–´ë–¤ APIì—ì„œëŠ” NotEmptyí•˜ê²Œ ì‚¬ìš©í•˜ê³  ì‹¶ì–´ í•˜ì§€ë§Œ, ë˜ ë‹¤ë¥¸ APIì—ì„œëŠ” Emptyë¥¼ í—ˆìš©í•˜ë©´ ë¬¸ì œê°€ ë  ìˆ˜ ìˆë‹¤.
* ì‹¤ë¬´ì—ì„œëŠ” íšŒì› ì—”í‹°í‹°ë¥¼ ìœ„í•œ APIê°€ ë‹¤ì–‘í•˜ê²Œ ë§Œë“¤ì–´ì§€ëŠ”ë°,  í•œ ì—”í‹°í‹°ì— ê°ê°ì˜ APIë¥¼ ìœ„í•œ ëª¨ë“  ìš”êµ¬ì‚¬í•­ì„ ë‹´ê¸°ëŠ” ì–´ë µë‹¤.  
  â†’ ìµœì¢… ì ‘ì† ì‹œê°„ì´ ì¶”ê°€ë˜ê³ , ì–´ë–¤ í•˜ë‚˜ì˜ APIë•Œë¬¸ì— ìš”ê¸ˆì •ì‚° ìˆ˜ìˆ˜ë£Œ ì •ì‚°ìœ¨ì´ ì¶”ê°€ë˜ê³  í•˜ë‹¤ë³´ë©´ ëì´ ì—†ë‹¤. 
* â— (ì¤‘ìš”) ì—”í‹°í‹°ê°€ ë³€ê²½ë˜ë©´ APIì˜ ìŠ¤í™ì´ ë³€í•œë‹¤.  
  â†’ Member ì—”í‹°í‹°ì˜ name í•„ë“œê°€ usernameì´ ë˜ëŠ” ìˆœê°„ í•´ë‹¹ ì—”í‹°í‹°ë¥¼ ì‚¬ìš©í•˜ëŠ” APIëŠ” ëª¨ë‘ ë³€ê²½ë˜ì–´ì•¼ í•œë‹¤!!
  
â–¶ï¸ íšŒì› ë“±ë¡ V2: ì—”í‹°í‹° ëŒ€ì‹ ì— DTOë¥¼ RequestBodyì— ë§¤í•‘
```java
@RestController
@RequiredArgsConstructor
public class MemberApiController {

    private final MemberService memberService;

    @PostMapping("/api/v2/members")
    public CreateMemberResponse saveMemberV2(@RequestBody @Valid CreateMemberRequest request) {
    
        Member member = new Member();
        member.setName(request.getName());
        Long id = memberService.join(member);
        
        return new CreateMemberResponse(id);
    }

    @Data
    static class CreateMemberRequest {
        @NotEmpty
        private String name;
    }
}
```
* CreateMemberRequest DTOë¥¼ Member ì—”í‹°í‹° ëŒ€ì‹  RequestBodyì™€ ë§¤í•‘í•˜ì—¬ ìœ„ ë¬¸ì œì ì„ í•´ê²°í•œë‹¤.
* ì—”í‹°í‹°ì™€ í”„ë ˆì  í…Œì´ì…˜ ê³„ì¸µì´ ë¶„ë¦¬ë˜ì—ˆë‹¤.
* ì—”í‹°í‹°ì™€ API ìŠ¤í™ì„ ëª…í™•í•˜ê²Œ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤.
* ì—”í‹°í‹°ê°€ ë³€ê²½ë˜ì–´ë„ APIìŠ¤í™ì´ ë³€ê²½ë˜ì§€ ì•ŠëŠ”ë‹¤. 

### ì •ë¦¬
* ì‹¤ë¬´ì—ì„œëŠ” APIìŠ¤í™ì— ì—”í‹°í‹°ê°€ ë…¸ì¶œë˜ì–´ì„œëŠ” ì•ˆëœë‹¤.  
* ê·¸ë ‡ê¸° ë•Œë¬¸ì— ê°ê°ì— APIì— ë§ëŠ” DTOë¥¼ ë§Œë“¤ì–´ì„œ ì—”í‹°í‹°ì™€ ë¶„ë¦¬ì‹œí‚¤ëŠ”ê²Œ ì¤‘ìš”í•˜ë‹¤.
* ì—”í‹°í‹°ë¥¼ ê·¸ëŒ€ë¡œ ì“¸ ê²½ìš°ì˜ ì¥ì ì€ ì•„ì£¼ ì¡°ê¸ˆ ê°„í¸í•´ì§„ë‹¤ëŠ” ê²ƒ ë¿ì´ë‹¤.

# ğŸ’¡ íšŒì› ìˆ˜ì • API
```java
@RestController
@RequiredArgsConstructor
public class MemberApiController {

    private final MemberService memberService;

    @PatchMapping("/api/v2/members/{id}")
    public UpdateMemberResponse updateMemberV2(
            @PathVariable Long id,
            @RequestBody @Valid UpdateMemberRequest request) {

        memberService.update(id, request.getName());
        Member findMember = memberService.findOne(id);
        return new UpdateMemberResponse(findMember.getId(), findMember.getName());
    }

    @Data
    static class UpdateMemberRequest {
        private String name;
    }

    @Data
    @AllArgsConstructor
    static class UpdateMemberResponse {
        private Long id;
        private String name;
    }
}
```
```java
@Service
@Transactional(readOnly = true)
@RequiredArgsConstructor
public class MemberService {

    private final MemberRepository memberRepository;
    
    @Transactional
    public void update(Long id, String name) {
        Member findMember = memberRepository.findById(id).get();
        findMember.setName(name);
    }
}
```
* ë°ì´í„° ìˆ˜ì •ì€ `ë³€ê²½ ê°ì§€`ë¥¼ ì´ìš©í•˜ì.

# ğŸ’¡ íšŒì› ì¡°íšŒ API
â–¶ï¸ íšŒì›ì¡°íšŒ V1: ì‘ë‹µ ê°’ìœ¼ë¡œ ì—”í‹°í‹°ë¥¼ ì§ì ‘ ì™¸ë¶€ì— ë…¸ì¶œ
```java
@GetMapping("/api/v1/members")
public List<Member> membersV1(){
    return memberService.findMembers();
}
```
* ì—”í‹°í‹°ë¥¼ ì§ì ‘ ì™¸ë¶€ì— ë…¸ì¶œí•˜ë©´ ì—¬ëŸ¬ ë¬¸ì œì ì´ ë°œìƒí•œë‹¤.
* ì—”í‹°í‹°ì— í”„ë ˆì  í…Œì´ì…˜ ê³„ì¸µì„ ìœ„í•œ ë¡œì§ì´ ì¶”ê°€ëœë‹¤.
* ê¸°ë³¸ì ìœ¼ë¡œ ì—”í‹°í‹°ì˜ ëª¨ë“  ê°’ì´ ë…¸ì¶œëœë‹¤.
* ì‘ë‹µ ìŠ¤í™ì„ ë§ì¶”ê¸° ìœ„í•´ ë¡œì§ì´ ì¶”ê°€ëœë‹¤.(ex: @JsonIgnore, ë³„ë„ì˜ ë·° ë¡œì§ ë“±ë“±)
* ì‹¤ë¬´ì—ì„œëŠ” ê°™ì€ ì—”í‹°í‹°ì— ëŒ€í•´ APIê°€ ìš©ë„ì— ë”°ë¼ ë‹¤ì–‘í•˜ê²Œ ë§Œë“¤ì–´ì§€ëŠ”ë°, í•œ ì—”í‹°í‹°ì— ê°ê°ì˜ APIë¥¼ ìœ„í•œ í”„ë ˆì  í…Œì´ì…˜ ì‘ë‹µ ë¡œì§ì„ ë‹´ê¸°ëŠ” ì–´ë µë‹¤.
* ì—”í‹°í‹°ê°€ ë³€ê²½ë˜ë©´ APIìŠ¤í™ì´ ë³€í•œë‹¤.(name â†’ username) 
* ì¶”ê°€ë¡œ ì»¬ë ‰ì…˜ì„ ì§ì ‘ ë°˜í™˜í•˜ë©´ í•­í›„ API ìŠ¤í™ì„ ë³€ê²½í•˜ê¸° ì–´ë µë‹¤. (ë³„ë„ì˜ Resultí´ë˜ìŠ¤ ìƒì„±ìœ¼ë¡œ í•´ê²° â†’ ex: Response Object)

> ğŸ“Œ ì°¸ê³ : ì—”í‹°í‹°ë¥¼ ì™¸ë¶€ì— ë…¸ì¶œí•˜ì§€ ë§ˆì„¸ìš”!   
> ì‹¤ë¬´ì—ì„œëŠ” member ì—”í‹°í‹°ì˜ ë°ì´í„°ê°€ í•„ìš”í•œ APIê°€ ê³„ì† ì¦ê°€í•˜ê²Œ ëœë‹¤.   
> ì–´ë–¤ APIëŠ” name í•„ë“œê°€ í•„ìš”í•˜ì§€ë§Œ, ì–´ë–¤ APIëŠ” name í•„ë“œê°€ í•„ìš”ì—†ì„ ìˆ˜ ìˆë‹¤.   
> ê²°ë¡ ì ìœ¼ë¡œ ì—”í‹°í‹° ëŒ€ì‹ ì— API ìŠ¤í™ì— ë§ëŠ” ë³„ë„ì˜ DTOë¥¼ ë…¸ì¶œí•´ì•¼ í•œë‹¤.

â–¶ï¸ íšŒì›ì¡°íšŒ V2: ì‘ë‹µ ê°’ìœ¼ë¡œ ì—”í‹°í‹°ê°€ ì•„ë‹Œ ë³„ë„ì˜ DTO ì‚¬ìš©
```java
@GetMapping("/api/v2/members")
public Result memberV2() {
    List<Member> findMembers = memberService.findMembers();
    List<MemberDto> collect = findMembers.stream()
            .map(m -> new MemberDto(m.getName()))
            .collect(Collectors.toList());

    return new Result(collect.size(), collect);
}

@Data
@AllArgsConstructor
static class Result<T> {
    private int count;
    private T data;
}

@Data
@AllArgsConstructor
static class MemberDto {
    private String name;
}
```
* ì—”í‹°í‹°ë¥¼ DTOë¡œ ë³€í™˜í•´ì„œ ë°˜í™˜í•œë‹¤.
* ì—”í‹°í‹°ê°€ ë³€í•´ë„ API ìŠ¤í™ì´ ë³€ê²½ë˜ì§€ ì•ŠëŠ”ë‹¤.
* ì¶”ê°€ë¡œ Result í´ë˜ìŠ¤ë¡œ ì»¬ë ‰ì…˜ì„ ê°ì‹¸ì„œ í–¥í›„ í•„ìš”í•œ í•„ë“œë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.
