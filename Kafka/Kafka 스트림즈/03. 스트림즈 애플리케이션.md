# ğŸ’¡ í•„í„°ë§ ìŠ¤íŠ¸ë¦¼ì¦ˆ

- í† í”½ìœ¼ë¡œ ë“¤ì–´ì˜¨ ë¬¸ìì—´ ë°ì´í„° ì¤‘ ë¬¸ìì—´ì˜ ê¸¸ì´ê°€ 5ë³´ë‹¤ í° ê²½ìš°ë§Œ í•„í„°ë§í•˜ëŠ” ìŠ¤íŠ¸ë¦¼ì¦ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìŠ¤íŠ¸ë¦¼ í”„ë¡œì„¸ì„œë¥¼ ì‚¬ìš©í•˜ì—¬ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
- ë©”ì‹œì§€ í‚¤ ë˜ëŠ” ë©”ì‹œì§€ ê°’ì„ í•„í„°ë§í•˜ì—¬ íŠ¹ì • ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ë¥¼ ê³¨ë¼ë‚¼ ë•ŒëŠ” `filter()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
- filter() ë©”ì„œë“œëŠ” ìŠ¤íŠ¸ë¦¼ì¦ˆDSLì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ í•„í„°ë§ ìŠ¤íŠ¸ë¦¼ í”„ë¡œì„¸ì„œì´ë‹¤.

![image](https://github.com/user-attachments/assets/7d91053e-68d4-44b6-b29c-b64cecaae06c)

```java
public class StreamsFilter {

    private static final String APPLICATION_ID = "streams-application";
    private static final String BOOTSTRAP_SERVERS = "my-kafka:9092";
    private static final String STREAM_LOG = "stream_log";
    private static final String STREAM_LOG_COPY = "stream_log_filter";

    public static void main(String[] args) {
        Properties props = new Properties();
        props.put(StreamsConfig.APPLICATION_ID_CONFIG, APPLICATION_ID);
        props.put(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG, BOOTSTRAP_SERVERS);
        props.put(StreamsConfig.DEFAULT_KEY_SERDE_CLASS_CONFIG, Serdes.String().getClass());
        props.put(StreamsConfig.DEFAULT_VALUE_SERDE_CLASS_CONFIG, Serdes.String().getClass());

        StreamsBuilder builder = new StreamsBuilder();
        KStream<String, String> streamLog = builder.stream(STREAM_LOG); // ì†ŒìŠ¤ í”„ë¡œì„¸ì„œ) í† í”½ì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
        KStream<String, String> filter = streamLog.filter((key, value) -> value.length() > 5); // ìŠ¤íŠ¸ë¦¼ í”„ë¡œì„¸ì„œ) ë°ì´í„°ë¥¼ ë³€í™˜ì²˜ë¦¬í•œë‹¤.
        filter.to(STREAM_LOG_COPY); // ì‹±í¬ í”„ë¡œì„¸ì„œ) í† í”½ ë°ì´í„°ë¥¼ í† í”½ìœ¼ë¡œ ë³´ë‚¸ë‹¤.

//        ë©”ì„œë“œ ì²´ì´ë‹ ë°©ì‹ ê°€ëŠ¥
//        KStream<String, String> streamLog = new StreamsBuilder().stream(STREAM_LOG);
//        streamLog.filter((key, value) -> value.length() > 5)
//                .to(STREAM_LOG_COPY);

        KafkaStreams kafkaStreams = new KafkaStreams(builder.build(), props);
        kafkaStreams.start();
    }
}
```

- í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰ì‹œí‚¤ê³  stream_log í† í”½ì— ë ˆì½”ë“œë¥¼ ìƒì‚°í•˜ê³ , stream_log_filter í† í”½ì„ ì»¨ìŠˆë°í•˜ë„ë¡ CLIë¥¼ ì´ìš©í•˜ì—¬ í™•ì¸í•´ë³´ì.

![image](https://github.com/user-attachments/assets/66e6bcfc-531b-4258-81ec-fa251dac73a7)

![image](https://github.com/user-attachments/assets/1da9668c-2812-474d-8f7b-f966f9b3ae5c)

- ê·¸ëŸ¬ë©´ ìœ„ ê·¸ë¦¼ê³¼ ê°™ì´ 5ê¸€ì ë¯¸ë§Œì¸ ë°ì´í„°ëŠ” í•„í„°ë§ë˜ê³ , 5ê¸€ìê°€ ë„˜ëŠ” ë°ì´í„°ë§Œ stream_log_filter í† í”½ì— ì €ì¥ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

# ğŸ’¡ KStream, KTable ì¡°ì¸ ìŠ¤íŠ¸ë¦¼ì¦ˆ

![image](https://github.com/user-attachments/assets/de761abf-86f2-40ae-8f01-427be2f1c7e3)

- KTableê³¼ KStream ì€ ë©”ì‹œì§€ í‚¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¡°ì¸í•  ìˆ˜ ìˆë‹¤.
- ëŒ€ë¶€ë¶„ì˜ ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì •ì ìœ¼ë¡œ ì €ì¥ëœ ë°ì´í„°ë¥¼ ì¡°ì¸í•˜ì—¬ ì‚¬ìš©í•˜ì§€ë§Œ, ì¹´í”„ì¹´ì—ì„œëŠ” ì‹¤ì‹œê°„ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ë°ì´í„°ë“¤ì„ ì¡°ì¸í•  ìˆ˜ ìˆë‹¤.
- ì‚¬ìš©ìì˜ ì´ë²¤íŠ¸ ë°ì´í„°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ì§€ ì•Šê³ ë„ ì¡°ì¸í•˜ì—¬ ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.

![image](https://github.com/user-attachments/assets/50fddc2d-a9ea-42e9-a61d-0f910f2a72db)

- ìœ„ ê·¸ë¦¼ê³¼ ê°™ì´ keyê°€ ë™ì¼í•œ KStream, KTableì„ ì¡°ì¸í•˜ì—¬ ë¬¼í’ˆê³¼ ì£¼ì†Œê°€ ì¡°í•©ëœ ë°ì´í„°ë¥¼ ìƒì„±í•´ë³´ì.
- ê·¸ ì „ì—, KStreamê³¼ KTableì„ ì¡°ì¸í•˜ê¸° ìœ„í•´ì„œëŠ” ì½”íŒŒí‹°ì…”ë‹ëœ ìƒíƒœì´ì–´ì•¼ í•˜ë¯€ë¡œ ì•„ë˜ì™€ ê°™ì´ í† í”½ì„ ë¯¸ë¦¬ ìƒì„±í•´ë‘”ë‹¤.

![image](https://github.com/user-attachments/assets/ec9f337e-e861-4e63-90f9-82415b7a7fe9)

```java
public class KStreamJoinKTable {

    private static final String APPLICATION_ID = "order-join-application";
    private static final String BOOTSTRAP_SERVERS = "my-kafka:9092";
    private static final String ADDRESS_TABLE = "address";
    private static final String ORDER_STREAM = "order";
    private static final String ORDER_JOIN_STREAM = "order_join";

    public static void main(String[] args) {
        Properties props = new Properties();
        props.put(StreamsConfig.APPLICATION_ID_CONFIG, APPLICATION_ID);
        props.put(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG, BOOTSTRAP_SERVERS);
        props.put(StreamsConfig.DEFAULT_VALUE_SERDE_CLASS_CONFIG, Serdes.String().getClass());
        props.put(StreamsConfig.DEFAULT_KEY_SERDE_CLASS_CONFIG, Serdes.String().getClass());

        StreamsBuilder builder = new StreamsBuilder();
        KTable<String, String> addressTable = builder.table(ADDRESS_TABLE);  // ì†ŒìŠ¤ í”„ë¡œì„¸ì„œ
        KStream<String, String> orderStream = builder.stream(ORDER_STREAM);  // ì†ŒìŠ¤ í”„ë¡œì„¸ì„œ

        orderStream.join(addressTable, (order, address) -> order + " send to " + address) // ìŠ¤íŠ¸ë¦¼ í”„ë¡œì„¸ì„œ
                .to(ORDER_JOIN_STREAM); // ì‹±í¬ í”„ë¡œì„¸ì„œ

        KafkaStreams kafkaStreams = new KafkaStreams(builder.build(), props);
        kafkaStreams.start();
    }
}
```

- ì˜ˆì œ ê·¸ë¦¼ê³¼ ê°™ì´ í† í”½ê³¼ ë°ì´í„°ë¥¼ ìƒì„±í•˜ê³ , order_join í† í”½ì„ í™•ì¸í•´ë³´ë©´ ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ì´ joinëœ ê²°ê³¼ë¬¼ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![image](https://github.com/user-attachments/assets/8f37f5cc-11b0-4128-9060-cae211f131e4)

# ğŸ’¡ KStream, GlobalKTable ì¡°ì¸ ìŠ¤íŠ¸ë¦¼ì¦ˆ

- order í† í”½ê³¼ address í† í”½ì€ ì½”íŒŒí‹°ì…”ë‹ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ê°ê° KStreamê³¼ KTableë¡œ ì„ ì–¸í•´ì„œ ì¡°ì¸ì„ í•  ìˆ˜ ìˆì—ˆë‹¤.
- ê·¸ëŸ¬ë‚˜ ì½”íŒŒí‹°ì…”ë‹ ë˜ì–´ìˆì§€ ì•Šì€ í† í”½ì„ ì¡°ì¸í•´ì•¼ í• ë•ŒëŠ” ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ?
- ì½”íŒŒí‹°ì…”ë‹ ë˜ì§€ ì•Šì€ í† í”½ì„ ì¡°ì¸í•˜ëŠ” ë°©ë²•ì€ ë‘ ê°€ì§€ê°€ ìˆë‹¤.
  - ë¦¬íŒŒí‹°ì…”ë‹ì„ ìˆ˜í–‰í•œ ì´í›„ì— ì½”íŒŒí‹°ì…”ë‹ì´ ëœ ìƒíƒœë¡œ ì¡°ì¸ ì²˜ë¦¬ë¥¼ í•œë‹¤.
  - KTableë¡œ ì‚¬ìš©í•˜ëŠ” í† í”½ì„ GlobalKTableë¡œ ì„ ì–¸í•˜ì—¬ ì‚¬ìš©í•œë‹¤.
- ì˜ˆì œë¥¼ í™•ì¸í•˜ê¸° ì „ì—, íŒŒí‹°ì…˜ì´ 3ê°œì¸ order í† í”½ê³¼ ë‹¤ë¥´ê²Œ íŒŒí‹°ì…˜ì´ 2ê°œì¸ address_v2 í† í”½ì„ ë§Œë“¤ì–´ì„œ ì½”íŒŒí‹°ì…”ë‹ ë˜ì§€ ì•Šì€ í† í”½ê´€ê³„ë¥¼ ë§Œë“¤ì.

![image](https://github.com/user-attachments/assets/2444c972-205e-4ee2-b8b5-98ed978a3cc6)

```java
public class KStreamJoinGlobalKTable {
    private static final String APPLICATION_ID = "global-table-join-application";
    private static final String BOOTSTRAP_SERVERS = "my-kafka:9092";
    private static final String ADDRESS_GLOBAL_TABLE = "address_v2";
    private static final String ORDER_STREAM = "order";
    private static final String ORDER_JOIN_STREAM = "order_join";

    public static void main(String[] args) {
        Properties props = new Properties();
        props.put(StreamsConfig.APPLICATION_ID_CONFIG, APPLICATION_ID);
        props.put(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG, BOOTSTRAP_SERVERS);
        props.put(StreamsConfig.DEFAULT_KEY_SERDE_CLASS_CONFIG, Serdes.String().getClass());
        props.put(StreamsConfig.DEFAULT_VALUE_SERDE_CLASS_CONFIG, Serdes.String().getClass());

        StreamsBuilder builder = new StreamsBuilder();
        GlobalKTable<String, String> addressGlobalTable = builder.globalTable(ADDRESS_GLOBAL_TABLE);// ì†ŒìŠ¤ í”„ë¡œì„¸ì„œ
        KStream<String, String> orderStream = builder.stream(ORDER_STREAM); // ì†ŒìŠ¤ í”„ë¡œì„¸ì„œ

        orderStream.join(addressGlobalTable,
                (orderKey, orderValue) -> orderKey, // GlobalKTable ì¡°ì¸ì€ ë©”ì‹œì§€ í‚¤ë¥¼ ì •í•˜ëŠ” íŒŒë¦¬ë¯¸í„°ê°€ ì¶”ê°€ë¨
                (order, address) -> order + " send to " + address) // ìŠ¤íŠ¸ë¦¼ í”„ë¡œì„¸ì„œ
                .to(ORDER_JOIN_STREAM); // ì‹±í¬ í”„ë¡œì„¸ì„œ

        KafkaStreams kafkaStreams = new KafkaStreams(builder.build(), props);
        kafkaStreams.start();
    }
}
```

- ë§ˆì°¬ê°€ì§€ë¡œ ë°ì´í„°ë¥¼ ìƒì„±í•˜ê³  order_join í† í”½ì„ í™•ì¸í•´ë³´ë©´ ë°ì´í„°ê°€ ìƒì„±ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
- ì¦‰, ì½”íŒŒí‹°ì…”ë‹ ë˜ì§€ ì•Šì€ 2ê°œì˜ í† í”½ì„ KStreamê³¼ GlobalKTableë¡œ ì¡°ì¸í•  ìˆ˜ ìˆìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.
