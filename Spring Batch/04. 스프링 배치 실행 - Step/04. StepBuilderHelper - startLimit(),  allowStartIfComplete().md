# ğŸ’¡ StepBuilderHelper - startLimit()

- Stepì˜ ìµœëŒ€ ì‹¤í–‰íšŸìˆ˜ë¥¼ ì¡°ì •í•˜ëŠ” ì„¤ì •ì´ë‹¤.
- ì„¤ì • ê°’ì„ ì´ˆê³¼í•´ì„œ ë‹¤ì‹œ ì‹¤í–‰í•˜ë ¤ê³  í•˜ë©´ `StartLimitExceededException`ì´ ë°œìƒ
- startLimitì˜ ë””í´íŠ¸ ê°’ì€ Integer.MAX_VALUEì´ë‹¤.

# ğŸ’¡ StepBuilderHelper - allowStartIfComplete()

- ê¸°ë³¸ì ìœ¼ë¡œ COMPLETED ìƒíƒœë¥¼ ê°€ì§„ Step ì€ Job ì¬ì‹œì‘ì‹œ ì‹¤í–‰í•˜ì§€ ì•Šê³  ìŠ¤í‚µí•œë‹¤.
- Stepì˜ ì´ì „ ì„±ê³µ ì—¬ë¶€ì™€ ìƒê´€ì—†ì´ í•­ìƒ Stepì„ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ì„¤ì •ì´ë‹¤.
- ë³´í†µ ìœ íš¨ì„±ì„ ê²€ì¦í•˜ëŠ” Stepì´ë‚˜ ì‚¬ì „ ì‘ì—…ì´ ê¼­ í•„ìš”í•œ Step ë“±ì— ì‚¬ìš©í•œë‹¤.
- allowStartIfCompleteê°€ trueë¡œ ì„¤ì •ëœ Stepì€ í•­ìƒ ì‹¤í–‰í•œë‹¤.

![image](https://github.com/user-attachments/assets/1f1be939-5f68-4f68-9ebe-5af1e58af4a6)

# ğŸ’¡ ì˜ˆì œ

```java
@Bean
    public Job batchJob() {
        return new JobBuilder("batchJob1", jobRepository)
                .start(batchStep1())
                .next(batchStep2())
                .build();
    }

    @Bean
    public Step batchStep1() {
        return new StepBuilder("batchStep1", jobRepository)
                .tasklet(((contribution, chunkContext) -> {
                    log.info("Batch step 1 started");
                    log.info("stepContribution = {} , chunkContext = {}", contribution, chunkContext);
                    return RepeatStatus.FINISHED;
                }), transactionManager)
                .allowStartIfComplete(true)
                .build();
    }

    @Bean
    public Step batchStep2() {
        return new StepBuilder("batchStep2", jobRepository)
                .tasklet(((contribution, chunkContext) -> {
                    log.info("Batch step 2 started");
                    log.info("stepContribution = {} , chunkContext = {}", contribution, chunkContext);
                    throw new RuntimeException("ì¼ë¶€ëŸ¬ ë‚´ëŠ” ì˜¤ë¥˜");
//                    return RepeatStatus.FINISHED;
                }), transactionManager)
                .startLimit(3)
                .build();
    }
```

- batchStep1ì€ allowStartIfComplete(true)ë¡œ ì„¤ì •í•´ì„œ ì¬ì‹œì‘ì‹œ BatchStatusì™€ ìƒê´€ì—†ì´ ì‹¤í–‰í•œë‹¤.
- batchStep2ì€ startLimit(3)ìœ¼ë¡œ ì„¤ì •í•´ì„œ ìµœëŒ€ ì‹¤í–‰ íšŸìˆ˜ë¥¼ 3íšŒë¡œ ì œí•œí•œë‹¤.
- ë§Œì•½, ì´ ìƒíƒœë¡œ Jobì„ ê³„ì† ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ë©”íƒ€ë°ì´í„°ê°€ ì €ì¥ëœë‹¤.

![image](https://github.com/user-attachments/assets/07d7f1b4-d984-466f-8035-e288e187b87b)

- batchStep1ì€ BatchStatus=COMPLETEDì´ì§€ë§Œ, allowStartIfComplete(true)ë¡œ ì„¤ì •í–ˆê¸° ë•Œë¬¸ì— ë¬´ì¡°ê±´ ì‹¤í–‰ëœë‹¤.
- batchStep2ëŠ” BatchStatus=FAILEDë¼ ì¬ì‹¤í–‰ë˜ì§€ë§Œ, startLimit(3)ìœ¼ë¡œ ì„¤ì •í–ˆê¸° ë•Œë¬¸ì— 3íšŒê¹Œì§€ë§Œ ì‹¤í–‰ë˜ê³ , ì´í›„ì—ëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.

![image](https://github.com/user-attachments/assets/c8582199-871c-4db7-9e91-3a1cda97a201)

- BATCH_JOB_EXECUTION ë©”íƒ€ë°ì´í„°ë¥¼ ë³´ë©´, 3íšŒê¹Œì§€ëŠ” ì¼ë°˜ì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì§€ë§Œ 4íšŒ, 5íšŒì—ëŠ” `StartLimitExceededException`ì˜ˆì™¸ê°€ ë°œìƒí•œ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.
