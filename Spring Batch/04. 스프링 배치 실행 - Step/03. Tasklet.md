# ğŸ’¡ Tasklet

- Step ë‚´ì—ì„œ êµ¬ì„±ë˜ê³  ì‹¤í–‰ë˜ëŠ” ë„ë©”ì¸ ê°ì²´ë¡œì„œ ì£¼ë¡œ ë‹¨ì¼ Taskë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ ê°ì²´
- TaskletStepì— ì˜í•´ ë°˜ë³µì ìœ¼ë¡œ ìˆ˜í–‰ë˜ë©° ë°˜í™˜ê°’ì— ë”°ë¼ ê³„ì† ìˆ˜í–‰í•˜ê±°ë‚˜ ì¢…ë£Œí•œë‹¤.
- `RepeatStatus` : Taskletì˜ ë°˜ë³µ ì—¬ë¶€ ìƒíƒœ ê°’
  - `RepeatStatus.FINISHED` - Tasklet ì¢…ë£Œ, RepeatStatusë¥¼ nullë¡œ ë°˜í™˜í•˜ë©´ RepeatStatus.FINISHEDë¡œ í•´ì„ëœë‹¤.
  - `RepeatStatus.CONTINUABLE` - Tasklet ë°˜ë³µ
  - RepeatStatus.FINISHEDê°€ ë¦¬í„´ë˜ê±°ë‚˜ ì‹¤íŒ¨ ì˜ˆì™¸ê°€ ë˜ì ¸ì§€ê¸° ì „ê¹Œì§€ TaskletStepì— ì˜í•´ while ë¬¸ ì•ˆì—ì„œ ë°˜ë³µì ìœ¼ë¡œ í˜¸ì¶œëœë‹¤. (ë¬´í•œë£¨í”„ ì£¼ì˜!!)
- Stepì— ì˜¤ì§ í•˜ë‚˜ì˜ Taskletë§Œ ì„¤ì •ì´ ê°€ëŠ¥í•˜ë©° ë‘ê°œ ì´ìƒì„ ì„¤ì •í•  ê²½ìš° ë§ˆì§€ë§‰ì— ì„¤ì •í•œ ê°ì²´ë§Œ ì‹¤í–‰ëœë‹¤.
- tasklet() ë©”ì„œë“œì˜ ì¸ìë¡œ ì„¸íŒ…í•˜ê³ , tasklet() ë©”ì„œë“œëŠ” `TaskletStepBuilder`ë¥¼ ë°˜í™˜í•˜ì—¬ ê´€ë ¨ API ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

# ğŸ’¡ Tasklet Implementation ì˜ˆì œ

ë°°ì¹˜ ì‘ì—…ì—ì„œëŠ” ì£¼ ì²˜ë¦¬ ë‹¨ê³„(main processing) ì´ì „ì— ë¦¬ì†ŒìŠ¤ë¥¼ ì„¤ì •í•˜ê±°ë‚˜, ì²˜ë¦¬ê°€ ì™„ë£Œëœ í›„ì— ë¦¬ì†ŒìŠ¤ë¥¼ ì •ë¦¬í•˜ëŠ” ë‹¨ê³„ê°€ í•„ìš”í•  ë•Œê°€ ë§ë‹¤.   
ì˜ˆë¥¼ ë“¤ì–´, íŒŒì¼ì„ ì£¼ë¡œ ë‹¤ë£¨ëŠ” ì‘ì—…ì—ì„œëŠ” íŠ¹ì • íŒŒì¼ì„ ë‹¤ë¥¸ ìœ„ì¹˜ë¡œ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œí•œ í›„, ë¡œì»¬ì—ì„œ í•´ë‹¹ íŒŒì¼ì„ ì‚­ì œí•˜ëŠ” ì‘ì—…ì´ í•„ìš”í•  ìˆ˜ ìˆë‹¤.   
ì•„ë˜ëŠ” Tasklet êµ¬í˜„ ì˜ˆì‹œë¡œ, íŒŒì¼ ì‚­ì œ ì—­í• ì„ ìˆ˜í–‰í•˜ëŠ” Taskletì˜ ì˜ˆì‹œë¥¼ ë³´ì—¬ì¤€ë‹¤.

```java
public class FileDeletingTasklet implements Tasklet, InitializingBean {

    private Resource directory;

    public RepeatStatus execute(StepContribution contribution, ChunkContext chunkContext) throws Exception {
        File dir = directory.getFile();
        Assert.state(dir.isDirectory(), "The resource must be a directory");

        File[] files = dir.listFiles();
        for (int i = 0; i < files.length; i++) {
            boolean deleted = files[i].delete();
            if (!deleted) {
                throw new UnexpectedJobExecutionException("Could not delete file " + files[i].getPath());
            }
        }
        return RepeatStatus.FINISHED;
    }

    public void setDirectoryResource(Resource directory) {
        this.directory = directory;
    }

    public void afterPropertiesSet() throws Exception {
        Assert.state(directory != null, "Directory must be set");
    }
}
```

ì•ì„œ ì–¸ê¸‰ëœ Tasklet êµ¬í˜„ì€ íŠ¹ì • ë””ë ‰í† ë¦¬ ë‚´ì˜ ëª¨ë“  íŒŒì¼ì„ ì‚­ì œí•œë‹¤.  
ì¤‘ìš”í•œ ì ì€ `execute` ë©”ì„œë“œê°€ ë‹¨ í•œ ë²ˆë§Œ í˜¸ì¶œëœë‹¤ëŠ” ì ì´ë‹¤. (RepeatStatus.FINISHED)  
ì´ Taskletì„ ì•„ë˜ ì½”ë“œì™€ ê°™ì´ ë°°ì¹˜ ì‘ì—…ì˜ Stepì—ì„œ ì°¸ì¡°í•˜ë„ë¡ ì„¤ì •í•˜ë©´ ë©ë‹ˆë‹¤.

```java
@Bean
public Job taskletJob(JobRepository jobRepository, Step deleteFilesInDir) {
    return new JobBuilder("taskletJob", jobRepository)
                .start(deleteFilesInDir)
                .build();
}

@Bean
public Step deleteFilesInDir(JobRepository jobRepository, PlatformTransactionManager transactionManager) {
    return new StepBuilder("deleteFilesInDir", jobRepository)
                .tasklet(fileDeletingTasklet(), transactionManager)
                .build();
}

@Bean
public FileDeletingTasklet fileDeletingTasklet() {
    FileDeletingTasklet tasklet = new FileDeletingTasklet();
    tasklet.setDirectoryResource(new FileSystemResource("target/test-outputs/test-dir"));
    return tasklet;
}
```
