# ğŸ’¡ JdbcPagingItemReader

- Paging ê¸°ë°˜ì˜ JDBC êµ¬í˜„ì²´ë¡œì„œ ì¿¼ë¦¬ì— ì‹œì‘ í–‰ ë²ˆí˜¸(offset)ì™€ í˜ì´ì§€ì—ì„œ ë°˜í™˜ í•  í–‰ ìˆ˜ (limit)ë¥¼ ì§€ì •í•´ì„œ SQLì„ ì‹¤í–‰í•œë‹¤.
- ìŠ¤í”„ë§ ë°°ì¹˜ì—ì„œ offsetê³¼ limitì„ PageSizeì— ë§ê²Œ ìë™ìœ¼ë¡œ ìƒì„±í•´ ì£¼ë©° í˜ì´ì§• ë‹¨ìœ„ë¡œ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ ì¿¼ë¦¬ê°€ ì‹¤í–‰ëœë‹¤.
- í˜ì´ì§€ë§ˆë‹¤ ìƒˆë¡œìš´ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— í˜ì´ì§• ì‹œ ê²°ê³¼ ë°ì´í„°ì˜ ìˆœì„œê°€ ë³´ì¥ë  ìˆ˜ ìˆë„ë¡ order by êµ¬ë¬¸ì´ ì‘ì„±ë˜ì–´ì•¼ í•œë‹¤.
- ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ Thread ì•ˆì •ì„±ì„ ë³´ì¥í•˜ê¸° ë•Œë¬¸ì— ë³„ë„ì˜ ë™ê¸°í™”ë¥¼ í•  í•„ìš”ê°€ ì—†ë‹¤.

### PagingQueryProvider

- ì¿¼ë¦¬ ì‹¤í–‰ì— í•„ìš”í•œ ì¿¼ë¦¬ë¬¸ì„ ItemReaderì—ê²Œ ì œê³µí•˜ëŠ” í´ë˜ìŠ¤
- ë°ì´í„°ë² ì´ìŠ¤ë§ˆë‹¤ í˜ì´ì§• ì „ëµì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ê° ë°ì´í„°ë² ì´ìŠ¤ ìœ í˜•ë§ˆë‹¤ ë‹¤ë¥¸ PagingQueryProviderë¥¼ ì‚¬ìš©í•œë‹¤.
- select ì ˆ, from ì ˆ, sortKeyëŠ” í•„ìˆ˜ë¡œ ì„¤ì •í•´ì•¼ í•˜ë©° where, group by ì ˆì€ í•„ìˆ˜ê°€ ì•„ë‹ˆë‹¤.

![image](https://github.com/user-attachments/assets/438587fe-a92a-4608-9034-bc069a3c19fb)

![image](https://github.com/user-attachments/assets/7167bafd-2f89-4b7d-8094-9ef54f32d15d)

![image](https://github.com/user-attachments/assets/30718c1c-ffd8-43aa-be7e-1eeb661e5545)

# ğŸ’¡ ì˜ˆì œ ì½”ë“œ

```java
@Configuration
@RequiredArgsConstructor
public class JdbcPagingConfiguration {
    private final JobRepository jobRepository;
    private final PlatformTransactionManager transactionManager;
    private final DataSource dataSource;
    private static final int CHUNK_SIZE = 2;

    @Bean
    public Job job() {
        return new JobBuilder("job", jobRepository)
            .start(step())
            .incrementer(new RunIdIncrementer())
            .build();
    }

    @Bean
    public Step step() {
        return new StepBuilder("step", jobRepository)
            .<Customer, Customer>chunk(CHUNK_SIZE, transactionManager)
            .reader(itemReader())
            .writer(itemWriter())
            .build();
    }

    @Bean
    public ItemReader<Customer> itemReader() {
        final HashMap<String, Object> parameters = new HashMap<>();
        parameters.put("firstName", "A%");
        return new JdbcPagingItemReaderBuilder<Customer>()
            .name("jdbcPagingItemReader")
            .pageSize(CHUNK_SIZE)
            .dataSource(dataSource)
            .beanRowMapper(Customer.class)
            .queryProvider(queryProvider())
            .parameterValues(parameters)
            .build();
    }

    private PagingQueryProvider queryProvider() {
        final SqlPagingQueryProviderFactoryBean queryProvider = new SqlPagingQueryProviderFactoryBean();
        queryProvider.setDataSource(dataSource);
        queryProvider.setSelectClause("id, first_name, last_name, birth_date");
        queryProvider.setFromClause("from customer");
        queryProvider.setWhereClause("first_name like :firstName");

        final HashMap<String, Order> sortKeys = new HashMap<>();
        sortKeys.put("id", Order.ASCENDING);
        queryProvider.setSortKeys(sortKeys);
        try {
            return queryProvider.getObject();
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }

    @Bean
    public ItemWriter<Customer> itemWriter() {
        return chunk -> chunk.getItems().forEach(System.out::println);
    }
}
```
