# ğŸ’¡ JobExplorer

- JobRepositoryì˜ readonly ë²„ì „
- Jobì˜ ì‹¤í–‰ ì •ë³´ì¸ JobExecution ë˜ëŠ” Stepì˜ ì‹¤í–‰ ì •ë³´ì¸ StepExecutionì„ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.

![image](https://github.com/user-attachments/assets/54402e5d-b731-4082-ae76-295b8b002d56)

# ğŸ’¡ JobRegistry

- ìƒì„±ëœ Jobì„ ìë™ìœ¼ë¡œ ë“±ë¡, ì¶”ì  ë° ê´€ë¦¬í•˜ë©° ì—¬ëŸ¬ ê³³ì—ì„œ Jobì„ ìƒì„±í•œ ê²½ìš° ApplicationContextì—ì„œ Jobì„ ìˆ˜ì§‘í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- ê¸°ë³¸ êµ¬í˜„ì²´ë¡œ Map ê¸°ë°˜ì˜ MapJobRegistryí´ë˜ìŠ¤ë¥¼ ì œê³µí•œë‹¤.
  - jobNameì„ Keyë¡œ í•˜ê³  Jobì„ ê°’ìœ¼ë¡œ í•˜ì—¬ ë§¤í•‘í•œë‹¤.
- Job ë“±ë¡
  - JobRegistryBeanPostProcessor: BeanPostProcessor ë‹¨ê³„ì—ì„œ bean ì´ˆê¸°í™” ì‹œ ìë™ìœ¼ë¡œ JobRegistryì— Jobì„ ë“±ë¡ ì‹œì¼œì¤€ë‹¤.

![image](https://github.com/user-attachments/assets/ead75226-9046-4d89-b371-68f941c4f602)

# ğŸ’¡ JobOperator

- JobRepository, JobExplorer, JobRegistry, JobLauncherë¥¼ í¬í•¨í•˜ê³  ìˆìœ¼ë©° ë°°ì¹˜ì˜ ì‹œì‘, ì¤‘ë‹¨, ì¬ì‹œì‘, Job ìš”ì•½ ë“±ì˜ ëª¨ë‹ˆí„°ë§ì´ ê°€ëŠ¥í•˜ë‹¤.
- ê¸°ë³¸ êµ¬í˜„ì²´ë¡œ SimpleJobOprerator í´ë˜ìŠ¤ë¥¼ ì œê³µí•œë‹¤.

![image](https://github.com/user-attachments/assets/edaabb33-e8b9-4a82-85d1-607597dc0934)

# ğŸ’¡ ì˜ˆì œ

```java
@RestController
@RequiredArgsConstructor
public class JobOperationController {
    private final JobExplorer jobExplorer;
    private final JobRegistry jobRegistry;
    private final JobOperator jobOperator;

    @SneakyThrows
    @PostMapping("/batch/start")
    public String start(@RequestBody MyJobParameter myJobParameter) {
        for (String jobName : jobRegistry.getJobNames()) {
            final Job job = jobRegistry.getJob(jobName);
            System.out.println("jobName: " + job.getName());

            final Properties properties = new Properties();
            properties.put("id", myJobParameter.id() + ",java.lang.Long"); // JobOperatorì—ì„œ íŒŒë¼ë¯¸í„° ì„¤ì • ì£¼ì˜!
            jobOperator.start(job.getName(), properties);
        }
        return "batch started";
    }

    @SneakyThrows
    @PostMapping("/batch/stop")
    public String stop() {
        for (String jobName : jobRegistry.getJobNames()) {
            final Job job = jobRegistry.getJob(jobName);
            final Set<JobExecution> runningJobExecutions = jobExplorer.findRunningJobExecutions(job.getName());

            for (JobExecution jobExecution : runningJobExecutions) {
                jobOperator.stop(jobExecution.getId()); // í˜„ì¬ ì‹¤í–‰ì¤‘ì¸ Stepê¹Œì§€ëŠ” ì»¤ë°‹í•˜ê³  ì¢…ë£Œ, Stepì˜ StatusëŠ” STOPPED
                System.out.println("jobName: " + job.getName() + " stopped!!!!!");
            }
        }
        return "batch stopped";
    }

    @SneakyThrows
    @PostMapping("/batch/restart")
    public String restart() {
        for (String jobName : jobRegistry.getJobNames()) {
            final Job job = jobRegistry.getJob(jobName);

            final JobInstance lastJobInstance = jobExplorer.getLastJobInstance(job.getName());
            final JobExecution lastJobExecution = jobExplorer.getLastJobExecution(lastJobInstance);

            if(lastJobExecution.getStatus() != BatchStatus.COMPLETED) {
                jobOperator.restart(lastJobExecution.getId());
            }
        }
        return "batch restarted";
    }
}
```
