# ğŸ’¡ Partitioning

- ManagerStepì´ WorkerStepì„ ì‹¤í–‰ì‹œí‚¤ëŠ” êµ¬ì¡°
- WorkerStepì€ ê° ìŠ¤ë ˆë“œì— ì˜í•´ ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©°, ê° ìŠ¤ë ˆë“œë§ˆë‹¤ ë…ë¦½ì ì¸ StepExecutionì„ êµ¬ì„±í•œë‹¤. (WorkerStepì€ 1ê°œ ì¡´ì¬í•œë‹¤ëŠ” ì  ìœ ì˜!)
- WorkerStepì€ ItemReader / ItemProcessor / ItemWriter ë“±ì„ ê°€ì§€ê³  ë™ì‘í•˜ë©° ì‘ì—…ì„ ë…ë¦½ì ìœ¼ë¡œ ë³‘ë ¬ ì²˜ë¦¬í•œë‹¤.
- ManagerStepì€ PartitionStepì´ë©°, WorkerStepì€ TaskletStep, FlowStep ë“±ì´ ì˜¬ ìˆ˜ ìˆë‹¤.

![image](https://github.com/user-attachments/assets/ccaa1632-ebf8-40e5-b981-828a67e188fc)

### PartitionStep

- íŒŒí‹°ì…”ë‹ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” Step êµ¬í˜„ì²´
- íŒŒí‹°ì…”ë‹ ìˆ˜í–‰ í›„ StepExecutionAggregatorë¥¼ ì‚¬ìš©í•´ì„œ StepExecutionì˜ ì •ë³´ë¥¼ ìµœì¢… ì§‘ê³„í•œë‹¤.

### PartitionHandler

- PartitionHandlerëŠ” ì›ê²© ë˜ëŠ” ê·¸ë¦¬ë“œ í™˜ê²½ì˜ íŒ¨ë¸Œë¦­(fabric)ì— ëŒ€í•œ ì •ë³´ë¥¼ ì•Œê³  ìˆëŠ” ì»´í¬ë„ŒíŠ¸ì´ë‹¤. (ë³´í†µì€ ë¡œì»¬ì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” TaskExecutorPartitionHandler ì œê³µ, ì›ê²© ì‹¤í–‰ í™˜ê²½ì´ í•„ìš”í•œ ê²½ìš° ë³„ë„ êµ¬í˜„)
- PartitionStepì— ì˜í•´ í˜¸ì¶œë˜ë©° ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•´ì„œ WorkerStepì„ ë³‘ë ¬ë¡œ ì‹¤í–‰í•œë‹¤.
- WorkerStepì—ì„œ ì‚¬ìš©í•  StepExecution ìƒì„±ì€ StepExecutionSplitterì™€ Partitionerì—ê²Œ ìœ„ì„í•œë‹¤.
- WorkerStepì„ ë³‘ë ¬ë¡œ ì‹¤í–‰ í›„ ìµœì¢… ê²°ê³¼ë¥¼ ë‹´ì€ StepExecutionì„ PartitionStepì— ë°˜í™˜í•œë‹¤.

### StepExecutionSplitter

- WorkerStepì—ì„œ ì‚¬ìš©í•  StepExecutionì„ gridSizeë§Œí¼ ìƒì„±í•œë‹¤.
- Partitionerë¥¼ í†µí•´ ExecutionContextë¥¼ ì–»ì–´ì„œ StepExecutionì— ë§¤í•‘í•œë‹¤.

### Partitioner

- StepExecutionì— ë§¤í•‘í•  ExecutionContextë¥¼ gridSizeë§Œí¼ ìƒì„±í•œë‹¤.
- ê° ExecutionContextì— ì €ì¥ëœ ì •ë³´ëŠ” WorkerStepì„ ì‹¤í–‰í•˜ëŠ” ìŠ¤ë ˆë“œë§ˆë‹¤ ë…ë¦½ì ìœ¼ë¡œ ì°¸ì¡° ë° í™œìš© ê°€ëŠ¥í•˜ë‹¤.

![image](https://github.com/user-attachments/assets/3e68021e-5046-4c4f-9608-6ccc8794a571)

![image](https://github.com/user-attachments/assets/667496d3-e739-4e9e-a1af-0ad00dab4c7b)

![image](https://github.com/user-attachments/assets/9a5ac487-bb4a-4d08-b71b-22c492a2115c)

# ğŸ’¡ API ì„¤ì •

```java
@Bean
public Step managerStep() {
    return new StepBuilder("managerStep", jobRepository) // 1ë²ˆ
            .partitioner(workerStep().getName(), partitioner()) // 2ë²ˆ
            .step(workerStep()) // 3ë²ˆ 
            .gridSize(4) // 4ë²ˆ
            .taskExecutor(new SimpleAsyncTaskExecutor()) // 5ë²ˆ
            .build(); // 6ë²ˆ
}
```

1. Step ê¸°ë³¸ ì„¤ì •
2. PartitionStep ìƒì„±ì„ ìœ„í•œ PartitionStepBuilderê°€ ìƒì„±ë˜ê³  Partitionerë¥¼ ì„¤ì •
3. WorkerStep ì„¤ì • : TaskletStep, FlowStep ë“±ì´ ì˜¬ìˆ˜ ìˆë‹¤.
4. íŒŒí‹°ì…˜ êµ¬ë¶„ì„ ìœ„í•œ ê°’ ì„¤ì • : ëª‡ ê°œì˜ íŒŒí‹°ì…˜ìœ¼ë¡œ ë‚˜ëˆŒ ê²ƒì¸ì§€ ì‚¬ìš©ëœë‹¤.
5. ìŠ¤ë ˆë“œ í’€ ì‹¤í–‰ì ì„¤ì • : ìŠ¤ë ˆë“œ ìƒì„±, ìŠ¤ë ˆë“œ í’€ ê´€ë¦¬
6. PartitionStep ìƒì„± : ManagerStepì˜ ì—­í•  ë‹´ë‹¹
