# π’΅ ν¬μΈνΈμ»·, μ–΄λ“λ°”μ΄μ¤, μ–΄λ“λ°”μ΄μ € - μ†κ°
- **ν¬μΈνΈμ»·( Pointcut )** : μ–΄λ””μ— λ¶€κ°€ κΈ°λ¥μ„ μ μ©ν• μ§€, μ–΄λ””μ— λ¶€κ°€ κΈ°λ¥μ„ μ μ©ν•μ§€ μ•μ„μ§€ νλ‹¨ν•λ” ν•„ν„°λ§ λ΅μ§μ΄λ‹¤. μ£Όλ΅ ν΄λμ¤μ™€ λ©”μ„λ“ μ΄λ¦„μΌλ΅ ν•„ν„°λ§ ν•λ‹¤. μ΄λ¦„ κ·Έλ€λ΅ μ–΄λ–¤ ν¬μΈνΈ(Point)μ— κΈ°λ¥μ„
μ μ©ν• μ§€ ν•μ§€ μ•μ„μ§€ μλΌμ„(cut) κµ¬λ¶„ν•λ” κ²ƒμ΄λ‹¤.
- **μ–΄λ“λ°”μ΄μ¤( Advice )** : ν”„λ΅μ‹κ°€ νΈμ¶ν•λ” λ¶€κ°€ κΈ°λ¥μ΄λ‹¤. λ‹¨μν•κ² ν”„λ΅μ‹ λ΅μ§μ΄λΌ μƒκ°ν•λ©΄ λλ‹¤.
- **μ–΄λ“λ°”μ΄μ €( Advisor )** : ν•λ‚μ ν¬μΈνΈμ»·κ³Ό ν•λ‚μ μ–΄λ“λ°”μ΄μ¤λ¥Ό κ°€μ§€κ³  μλ” κ²ƒμ΄λ‹¤. (ν¬μΈνΈμ»·1 + μ–΄λ“λ°”μ΄μ¤1)
- μ •λ¦¬ν•λ©΄, λ¶€κ°€ κΈ°λ¥ λ΅μ§μ„ **ν¬μΈνΈμ»·**μΌλ΅ **μ–΄λ””μ—** μ μ©ν• μ§€ μ„ νƒν•κ³ , **μ–΄λ“λ°”μ΄μ¤**λ΅ **μ–΄λ–¤** λ΅μ§μ„ μ μ©ν• μ§€ μ„ νƒν•λ” κ²ƒμ΄λ‹¤.
- κ·Έλ¦¬κ³  μ–΄λ””μ—? μ–΄λ–¤ λ΅μ§?μ„ λ¨λ‘ μ•κ³  μλ” κ²ƒμ΄ μ–΄λ“λ°”μ΄μ €μ΄λ‹¤.

![image](https://github.com/shin-je-woo/TIL/assets/39439576/360acd47-af0b-4909-a206-60a2b5dd3985)

# π’΅ ν¬μΈνΈμ»·, μ–΄λ“λ°”μ΄μ¤, μ–΄λ“λ°”μ΄μ € - μμ 
## μμ  μ½”λ“1 - μ–΄λ“λ°”μ΄μ €
```java
@Test
void advisorTest1() {
    ServiceInterface target = new ServiceImpl();
    ProxyFactory proxyFactory = new ProxyFactory(target);
    DefaultPointcutAdvisor advisor = new DefaultPointcutAdvisor(Pointcut.TRUE, new TimeAdvice());
    proxyFactory.addAdvisor(advisor);
    ServiceInterface proxy = (ServiceInterface) proxyFactory.getProxy();

    proxy.save();
    proxy.find();
}
```
- `new DefaultPointcutAdvisor(..)`
  - Advisor μΈν„°νμ΄μ¤μ κ°€μ¥ μΌλ°μ μΈ κµ¬ν„μ²΄μ΄λ‹¤.
  - μƒμ„±μλ¥Ό ν†µν•΄ ν•λ‚μ ν¬μΈνΈμ»·κ³Ό ν•λ‚μ μ–΄λ“λ°”μ΄μ¤λ¥Ό λ„£μ–΄μ£Όλ©΄ λλ‹¤.
  - μ–΄λ“λ°”μ΄μ €λ” ν•λ‚μ ν¬μΈνΈμ»·κ³Ό ν•λ‚μ μ–΄λ“λ°”μ΄μ¤λ΅ κµ¬μ„±λλ‹¤.
- `Pointcut.TRUE`
  - ν•­μƒ true λ¥Ό λ°ν™ν•λ” ν¬μΈνΈμ»·μ΄λ‹¤.
  - ν¬μΈνΈμ»·μ„ μ§μ ‘ λ§λ“¤μ–΄ ν• λ‹Ήν•  μλ„ μλ‹¤.

## μμ  μ½”λ“2 - μ§μ ‘ λ§λ“  ν¬μΈνΈμ»·
```java
static class MyPointcut implements Pointcut {

    @Override
    public ClassFilter getClassFilter() {
        return ClassFilter.TRUE;
    }

    @Override
    public MethodMatcher getMethodMatcher() {
        return new MyMethodMatcher();
    }
}

static class MyMethodMatcher implements MethodMatcher {

    private String matchName = "save";

    @Override
    public boolean matches(Method method, Class<?> targetClass) {
        boolean result = method.getName().equals(matchName);
        log.info("ν¬μΈνΈμ»· νΈμ¶ method={}, targetClass={}", method.getName(), targetClass);
        log.info("ν¬μΈνΈμ»· κ²°κ³Ό={}", result);
        return result;
    }

    @Override
    public boolean isRuntime() {
        return false;
    }

    @Override
    public boolean matches(Method method, Class<?> targetClass, Object... args) {
        return false;
    }
}
```
- ν¬μΈνΈμ»·μ€ ν¬κ² `ClassFilter` μ™€ `MethodMatcher` λ‘λ΅ μ΄λ£¨μ–΄μ§„λ‹¤.
- μ΄λ¦„ κ·Έλ€λ΅ ν΄λμ¤κ°€ λ§λ”μ§€, λ©”μ„λ“κ°€ λ§λ”μ§€ ν™•μΈν•  λ• μ‚¬μ©ν•λ‹¤.
- λ‘λ‹¤ trueλ¥Ό λ°ν™ν•΄μ•Ό μ–΄λ“λ°”μ΄μ¤λ¥Ό μ μ©ν•  μ μλ‹¤.

```java
@Test
@DisplayName("μ§μ ‘ λ§λ“  ν¬μΈνΈμ»·")
void advisorTest2() {
    ServiceInterface target = new ServiceImpl();
    ProxyFactory proxyFactory = new ProxyFactory(target);
    DefaultPointcutAdvisor advisor = new DefaultPointcutAdvisor(new MyPointcut(), new TimeAdvice());
    proxyFactory.addAdvisor(advisor);
    ServiceInterface proxy = (ServiceInterface) proxyFactory.getProxy();

    proxy.save();
    proxy.find();
}
```

## μμ  μ½”λ“3 - μ¤ν”„λ§μ΄ μ κ³µν•λ” ν¬μΈνΈμ»·
- μ¤ν”„λ§μ€ μ°λ¦¬κ°€ ν•„μ”ν• ν¬μΈνΈμ»·μ„ μ΄λ―Έ λ€λ¶€λ¶„ μ κ³µν•λ‹¤.
- μ΄λ²μ—λ” μ¤ν”„λ§μ΄ μ κ³µν•λ” `NameMatchMethodPointcut` λ¥Ό μ‚¬μ©ν•΄μ„ κµ¬ν„ν•΄λ³΄μ.
```java
@Test
@DisplayName("μ¤ν”„λ§μ΄ μ κ³µν•λ” ν¬μΈνΈμ»·")
void advisorTest3() {
    ServiceInterface target = new ServiceImpl();
    ProxyFactory proxyFactory = new ProxyFactory(target);

    NameMatchMethodPointcut pointcut = new NameMatchMethodPointcut();
    pointcut.setMappedName("save");

    DefaultPointcutAdvisor advisor = new DefaultPointcutAdvisor(pointcut, new TimeAdvice());
    proxyFactory.addAdvisor(advisor);
    ServiceInterface proxy = (ServiceInterface) proxyFactory.getProxy();

    proxy.save();
    proxy.find();
}
```
- `NameMatchMethodPointcut` μ„ μƒμ„±ν•κ³  `setMappedNames(..)` μΌλ΅ λ©”μ„λ“ μ΄λ¦„μ„ μ§€μ •ν•λ©΄ ν¬μΈνΈμ»·μ΄ μ™„μ„±λλ‹¤.

### β… μ¤ν”„λ§μ΄ μ κ³µν•λ” ν¬μΈνΈμ»·
- `NameMatchMethodPointcut` : λ©”μ„λ“ μ΄λ¦„μ„ κΈ°λ°μΌλ΅ λ§¤μΉ­ν•λ‹¤. λ‚΄λ¶€μ—μ„λ” `PatternMatchUtils` λ¥Ό μ‚¬μ©ν•λ‹¤. μ) *xxx* ν—μ©
- `JdkRegexpMethodPointcut` : JDK μ •κ· ν‘ν„μ‹μ„ κΈ°λ°μΌλ΅ ν¬μΈνΈμ»·μ„ λ§¤μΉ­ν•λ‹¤.
- `TruePointcut` : ν•­μƒ μ°Έμ„ λ°ν™ν•λ‹¤.
- `AnnotationMatchingPointcut` : μ• λ…Έν…μ΄μ…μΌλ΅ λ§¤μΉ­ν•λ‹¤.
- `AspectJExpressionPointcut` : aspectJ ν‘ν„μ‹μΌλ΅ λ§¤μΉ­ν•λ‹¤.
  - κ°€μ¥ μ¤‘μ”ν• κ²ƒμ€ aspectJ ν‘ν„μ‹
  - μ‹¤λ¬΄μ—μ„λ” μ‚¬μ©ν•κΈ°λ„ νΈλ¦¬ν•κ³  κΈ°λ¥λ„ κ°€μ¥ λ§μ€ aspectJ ν‘ν„μ‹μ„ κΈ°λ°μΌλ΅ μ‚¬μ©ν•λ” `AspectJExpressionPointcut` μ„ μ‚¬μ©ν•κ² λλ‹¤.
 
## μμ  μ½”λ“4 - μ—¬λ¬ μ–΄λ“λ°”μ΄μ € ν•¨κ» μ μ©
![image](https://github.com/shin-je-woo/TIL/assets/39439576/f5173a7d-04e5-4174-b909-b1de1e03d644)

- μ–΄λ“λ°”μ΄μ €λ” ν•λ‚μ ν¬μΈνΈμ»·κ³Ό μ–΄λ“λ°”μ΄μ € μμΌλ΅ μ΄λ£¨μ–΄μ Έ μλ‹¤.
- κ·Έλ¬λ©΄ μ—¬λ¬ μ–΄λ“λ°”μ΄μ €λ¥Ό μ μ©ν•λ ¤λ©΄ μ„ κ·Έλ¦Όμ²λΌ μ¤‘κ°„μ— μ—¬λ¬ ν”„λ΅μ‹κ°μ²΄λ¥Ό μƒμ„±ν•΄μ•Όν• κΉ?

![image](https://github.com/shin-je-woo/TIL/assets/39439576/b30c1cfd-3443-448a-9d52-fcd27549d367)
- μ•„λ‹λ‹¤. ν•λ‚μ ν”„λ΅μ‹λ” μ—¬λ¬ μ–΄λ“λ°”μ΄μ €λ¥Ό μ μ©ν•  μ μλ‹¤.
- μ¦‰, ν•λ‚μ ν”„λ΅μ‹ν©ν† λ¦¬μ— μ—¬λ¬ μ–΄λ“λ°”μ΄μ €λ¥Ό μ¶”κ°€ν•  μ μμΌλ©°, μƒμ„±λ ν”„λ΅μ‹ κ°μ²΄λ” μ¶”κ°€λ μ–΄λ“λ°”μ΄μ €κ°€ μμ„λ€λ΅ μ μ©λλ‹¤.

```java
@Test
@DisplayName("ν•λ‚μ ν”„λ΅μ‹, μ—¬λ¬ μ–΄λ“λ°”μ΄μ €")
void multiAdvisorTest2() {
    // client -> proxy -> advisor2 -> advisor1 -> target

    DefaultPointcutAdvisor advisor1 = new DefaultPointcutAdvisor(Pointcut.TRUE, new Advice1());
    DefaultPointcutAdvisor advisor2 = new DefaultPointcutAdvisor(Pointcut.TRUE, new Advice2());

    // ν”„λ΅μ‹ μƒμ„±
    ServiceInterface target = new ServiceImpl();
    ProxyFactory proxyFactory = new ProxyFactory(target);

    proxyFactory.addAdvisor(advisor2);
    proxyFactory.addAdvisor(advisor1);
    ServiceInterface proxy = (ServiceInterface) proxyFactory.getProxy();

    // μ‹¤ν–‰
    proxy.save();
    proxy.find();
}
```
