# Previous

- 운영체제는 사용자가 컴퓨터 시스템을 편리하게 사용할 수 있는 환경을 제공하고 컴퓨터 시스템의 자원을 효율적으로 관리하는 소프트웨어이다.
- 운영체제의 여러 기능 중 핵심 기능를 담당하는 부분을 커널(kernel)이라고 한다.

![image](https://github.com/shin-je-woo/TIL/assets/39439576/3b9a14c4-e3e5-4578-bb77-cb981ffa96dc)

- 사용자가 운영체제 위에서 실행되는 프로그램을 편하고 효율적으로 사용할 수 있게 하드웨어와 소프트웨어 간 중개자 역할을 한다.
- CPU, I/O 장치, 메모리, 저장소와 같은 하드웨어 자원을 프로그램에 잘 할당하는 데 있다.
- 운영체제는 응용 프로그램이 하드웨어 자원에 직접 접근하는 것을 방지하여 자원을 보호한다.
  - 응용 프로그램이 하드웨어 자원에 직접 접근해서 조작 할 수 있다면 자원 관리가 되지 않고 프로세스 간 데이터가 훼손되어 컴퓨터 시스템 전체에 오류를 가져오게 된다.
  - 응용 프로그램이 하드 웨어 자원에 접근하려고 할 때는 반드시 운영체제를 통해서만 접근하도록 한다.
 
# 💡 CPU 권한 모드

- CPU 는 명령어를 실행할 때 크게 두 가지 권한 모드로 구분해서 실행한다.
- 사용자모드(user mode) 와 커널모드(kernel mode) 로 구분한다.
- CPU 는 동작하는 동안 두가지 모드를 번갈아 가면서 수행한다.

## 사용자 모드(Mode Bit =1)

- 사용자 응용프로그램의 코드가 실행 되는 모드로서 메모리의 유저영역만 접근 가능
- 디스크, 메모리, Printer 및 여러 I/O 장치들과 같은 특정 리소스들에 직접 접근할 수 없다.
- 대부분의 응용프로그램은 입출력 장치나 파일로의 접근이 필요하기 때문에 이 때는 유저모드에서 커널모드로 전환이 되어야 한다.

![image](https://github.com/shin-je-woo/TIL/assets/39439576/b54a8b17-4d7b-4379-b63f-1f97ae25b4eb)

## 커널 모드 (Mode Bit =0)

- 커널 영역의 코드가 실행 되는 모드로서 메모리의 유저영역, 커널영역 모두 접근 가능
- 하드웨어 자원에 직접 접근할 수 있음

# 💡 시스템 호출(System Call)

- User Mode와 Kernel모드의 전환을 위한 인터페이스
- 응용 프로그램이 운영체제의 커널이 제공하는 서비스를 이용할 수 있도록 커널모드에 접근하기 위한 인터페이스
- 응용 프로그램이 파일 입출력이나, 화면에 메시지를 출력하는 등의 기능은 커널 모드 일때 CPU가 실행하기 때문에 반드시 시스템 콜을 사용해서 커널모드로 전환해야 한다.
- 예를 들어 프로세스가 실행되고 있는 중에 라이브러리 함수인 fopen함수를 호출했다고 가정해보자.
- 그렇게 되면 fopen내부에서 system call인 open을 호출하면서 커널모드로 넘어간다.
- open에 대한 입력값이 커널로 전달이 되고 해당 일을 완료하고 커널에서 return을 해주면서 유저모드로 돌아가게 된다.

![image](https://github.com/shin-je-woo/TIL/assets/39439576/0fd7850a-fe17-4bf8-a61a-ee2202b554f2)

## 시스템 호출 동작 과정

- 사용자 응용 프로그램은 작업 과정에서 커널의 기능을 사용하기 위해 매우 빈번하게 시스템 콜을 요청하고 이로 인해 사용자 모드와 커널 모드를 상호 전환하며 실행하게 된다.
- I/O 처리를 위해 사용자 모드와 커널 모드를 번갈아 오가는 것은 컨텍스트 스위칭과 관련이 있으며 이는 멀티 스레드 환경에서 참고해야 할 중요한 배경적 지식이다.

![image](https://github.com/shin-je-woo/TIL/assets/39439576/711a594b-7ac9-4184-9852-b78bb55a8b80)
