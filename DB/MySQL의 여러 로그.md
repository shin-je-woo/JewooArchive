## **Undo 로그**

Undo 로그는 **트랜잭션의 논리적 이전 상태를 보관하는 로그**다.

### **존재 이유**

- 트랜잭션 롤백을 가능하게 한다.
- MVCC 기반 일관성 읽기를 가능하게 한다.

### **언제 기록되는가**

- INSERT, UPDATE, DELETE 등 **데이터 변경 시점에 즉시 기록된다**.
- 커밋 여부와 무관하게 먼저 생성된다.

### **무엇을 저장하는가**

- 변경 전 레코드의 값이다.
- 레코드별 이전 버전 체인이다.
- 각 Undo 레코드에는 **trx_id(변경한 트랜잭션 ID)** 가 포함된다.

### **무엇을 저장하지 않는가**

- 커밋되었다는 정보는 저장하지 않는다.
- 롤백되었다는 플래그도 저장하지 않는다.

### **어떻게 사용되는가**

- 롤백 시
    - Undo 로그를 따라가며 레코드를 이전 상태로 되돌린다.
- SELECT 시
    - ReadView 기준으로 보이지 않는 최신 버전을 건너뛰고
    - Undo 로그에서 **보이는 버전**을 재구성한다.

### **언제 삭제되는가**

- 해당 Undo 로그를 참조하는 트랜잭션이 더 이상 없을 때 purge된다.
- 즉시 삭제되지 않는다.
- 오래 실행되는 트랜잭션이 있으면 계속 유지된다.

### 한 줄 정리

Undo 로그는 **과거를 되돌리거나 다시 보는 용도**

## **Redo 로그**

Redo 로그는 **물리적 변경 사항을 다시 적용하기 위한 로그**다.

### **존재 이유**

- 트랜잭션의 내구성을 보장한다.
- 장애 발생 후 복구를 가능하게 한다.

### **언제 기록되는가**

- 데이터 페이지가 변경될 때 **즉시 기록된다**.
- 커밋 시점에 **디스크로 플러시된다**.

### **무엇을 저장하는가**

- 페이지에 어떤 변경이 있었는지에 대한 **물리적 변경 내용**이다.
- 페이지 번호, 오프셋, 변경 데이터다.

### **커밋과의 관계**

- InnoDB에서 커밋의 의미는
    - Redo 로그가 디스크에 안전하게 기록되었다는 뜻이다.
- 데이터 페이지는 아직 디스크에 없어도 된다.

### **롤백과의 관계**

- 롤백 자체도 데이터 변경이므로 Redo 로그에 기록된다.
- Undo 로그를 적용해 되돌린 결과가 Redo 로그에 남는다.

### **장애 복구 시 역할**

- 서버 재시작 시 Redo 로그를 읽는다.
- 커밋된 변경은 다시 적용한다.
- 커밋되지 않은 변경은 Undo 로그로 되돌린다.

### 한 줄 정리

Redo 로그는 **디스크에 반영되지 않은 변경을 다시 살리는 용도**

## **3. Binary 로그**

Binary 로그는 **논리적 변경 기록을 외부로 전달하기 위한 로그**다.

### **존재 이유**

- 복제(Replication)를 가능하게 한다.
- 시점 복구(Point in Time Recovery)를 가능하게 한다.

### **언제 기록되는가**

- 트랜잭션이 **커밋될 때 기록된다**.
- 커밋되지 않은 트랜잭션은 기록되지 않는다.

### **무엇을 저장하는가**

- SQL 문장 또는 논리적 변경 이벤트다.
- 스토리지 엔진과 무관한 상위 레벨 로그다.

### **InnoDB와의 관계**

- InnoDB 전용 로그가 아니다.
- MySQL 서버 레벨 로그다.
- MyISAM, InnoDB 모두 사용한다.

### **Redo 로그와의 차이**

- Redo 로그
    - 물리 로그다.
    - 충돌 복구용이다.
- Binary 로그
    - 논리 로그다.
    - 복제와 백업용이다.

### 한 줄 정리

Binary 로그는 **다른 서버나 미래로 변경을 전달하는 용도**

## 비교표

| **구분** | **Undo 로그** | **Redo 로그** | **Binary 로그** |
| --- | --- | --- | --- |
| 목적 | 롤백, MVCC | 장애 복구 | 복제, 백업 |
| 레벨 | InnoDB | InnoDB | MySQL 서버 |
| 기록 시점 | 변경 시 | 변경 시 | 커밋 시 |
| 커밋 정보 | 없음 | 있음 | 있음 |
| 논리 or 물리 | 논리 | 물리 | 논리 |
| 디스크 플러시 | 지연 | 커밋 시 | 커밋 시 |

## 정리

InnoDB는 변경 시 Undo 로그로 과거를 보존하고, Redo 로그로 현재 변경을 보장하며, 커밋된 결과만 Binary 로그로 외부에 전달한다.
