# 💡 외부 설정이란?
- 여러 설정값들을 개발/운영 환경으로 나누어 사용해야 할 경우가 있다.
- ex) 개발용DB 설정 / 운영용DB 설정
- 애플리케이션에서 필요한 외부설정을 불러오는 방법은 일반적으로 4가지가 있다.

![image](https://github.com/shin-je-woo/TIL/assets/39439576/c788393a-506c-41e0-8ddf-e6781ee75daa)
1. OS 환경 변수: OS에서 지원하는 외부 설정, 해당 OS를 사용하는 모든 프로세스에서 사용
2. 자바 시스템 속성: 자바에서 지원하는 외부 설정, 해당 JVM안에서 사용
3. 자바 커맨드 라인 인수: 커맨드 라인에서 전달하는 외부 설정, 실행시 main(args) 메서드에서 사용
4. 외부 파일(설정 데이터): 프로그램에서 외부 파일을 직접 읽어서 사용

# 💡 외부 설정 - OS 환경 변수
- OS 환경 변수(OS environment variables)는 해당 OS를 사용하는 모든 프로그램에서 읽을 수 있는 설정값이다.
- 다른 외부 설정과 비교해서 사용 범위가 가장 넓다.
- 애플리케이션에서 OS 환경 변수의 값을 읽어오는 방법은 다음 코드를 참고하자.

```java
@Slf4j
public class OsEnv {
    public static void main(String[] args) {
        Map<String, String> envMap = System.getenv();
        for (String key : envMap.keySet()) {
            log.info("env {}={}", key, System.getenv(key));
        }
    }
}
```
- `System.getenv()` 로 OS 환경변수를 읽어올 수 있다.
- 즉, OS 환경 변수를 설정하고 필요한 곳에서 `System.getenv()` 를 사용하면 외부 설정을 사용할 수 있다.

# 💡 외부 설정 - 자바 시스템 속성
- 자바 시스템 속성(Java System properties)은 실행한 JVM 안에서 접근 가능한 외부 설정이다.
- 추가로 자바가 내부에서 미리 설정해두고 사용하는 속성들도 있다.
- 자바 시스템 속성은 다음과 같이 자바 프로그램을 실행할 때 사용한다.
  - 예) java -Durl=dev -jar app.jar
  - `-D` VM 옵션을 통해서 `key=value` 형식을 주면 된다. 이 예제는 url=dev 속성이 추가된다.
  - 순서에 주의해야 한다. -D 옵션이 - jar 보다 앞에 있다.
 
  ```java
  @Slf4j
  public class JavaSystemProperties {
      public static void main(String[] args) {
          Properties properties = System.getProperties();
          for (Object key : properties.keySet()) {
              log.info("prop {}={}", key, System.getProperty(String.valueOf(key)));
          }
      }
  }
  ```
  - `System.getProperties()` 로 자바 시스템 속성을 읽어올 수 있다.
  - 자바 시스템 속성은 자바가 기본으로 제공하는 수 많은 속성들이 추가되어 있는 것을 확인할 수 있다.
 
# 💡 외부 설정 - 커맨드 라인 인수
- 커맨드 라인 인수(Command line arguments)는 애플리케이션 실행 시점에 외부 설정값을 `main(args)` 메서드의 `args` 파라미터로 전달하는 방법이다.
- 사용법은 다음과 같다.
  - 예) java -jar app.jar dataA dataB
  - 필요한 데이터를 마지막 위치에 스페이스로 구분해서 전달하면 된다.
  - 이 경우 dataA , dataB 2개의 문자가 args 에 전달된다.

```java
@Slf4j
public class CommandLineV1 {
    public static void main(String[] args) {
        for (String arg : args) {
            log.info("arg {}", arg);
        }
    }
}
```
- 커맨드 라인 인수는 다른 방법과 다르게 key=value형식이 아닌 통문자이다.
- 이 경우 개발자가 직접 구분자를 기준으로 파싱하고, key=value형식으로 변환해야 한다.
- 이런 불편함을 해결하기 위해 스프링에서는 커맨드 라인 옵션 인수를 제공한다.

# 💡 외부 설정 - 커맨드 라인 옵션 인수 (스프링 방식)
- 커맨드 라인 옵션 인수는 커맨드 라인 인수를 key=value 형식으로 편리하게 사용할 수 있도록 스프링이 제공하는 방식이다.
- 스프링은 커맨드 라인에 `--` 를 연결해서 시작하면 key=value 형식으로 변환해준다.
  - 예) --url=devdb --username=dev_user --password=dev_pw

```java
@Slf4j
public class CommandLineV2 {

    public static void main(String[] args) {
        ApplicationArguments appArgs = new DefaultApplicationArguments(args);

        List<String> url = appArgs.getOptionValues("url");
        List<String> username = appArgs.getOptionValues("username");
        List<String> password = appArgs.getOptionValues("password");
        log.info("url={}", url);
        log.info("username={}", username);
        log.info("password={}", password);
    }
}
```
- 스프링이 제공하는 `ApplicationArguments` 인터페이스와 `DefaultApplicationArguments` 구현체를 사용하면 커맨드 라인 옵션 인수를 읽어올 수 있다.
- 옵션 인수는 `--username=userA --username=userB `처럼 하나의 키에 여러 값을 포함할 수 있기 때문에 appArgs.getOptionValues(key) 의 결과는 List를 반환한다.
- 참고로 커맨드 라인 옵션 인수는 자바 언어의 표준 기능이 아니다. 스프링이 편리함을 위해 제공하는 기능이다.

## 커맨드 라인 옵션 인수와 스프링 부트
- 스프링 부트는 커맨드 라인을 포함해서 커맨드 라인 옵션 인수를 활용할 수 있는 `ApplicationArguments` 를 스프링 빈으로 등록해둔다.
- 그리고 그 안에 입력한 커맨드 라인을 저장해둔다.
- 그래서 해당 빈을 주입 받으면 커맨드 라인으로 입력한 값을 어디서든 사용할 수 있다.
