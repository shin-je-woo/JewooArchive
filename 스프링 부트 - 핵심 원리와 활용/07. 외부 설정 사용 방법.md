# Previous
- ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” `Environment` ë¥¼ í†µí•´ì„œ OS í™˜ê²½ë³€ìˆ˜, ìë°” ì‹œìŠ¤í…œ ì†ì„±, ì»¤ë§¨ë“œ ë¼ì¸ ì˜µì…˜ ì¸ìˆ˜ ë“±ì˜ ì™¸ë¶€ ì„¤ì •ì„ ì¼ê´€ëœ ë°©ì‹ìœ¼ë¡œ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.
- ìŠ¤í”„ë§ì€ `Environment` ëŠ” ë¬¼ë¡ ì´ê³  `Environment` ë¥¼ í™œìš©í•´ì„œ ë” í¸ë¦¬í•˜ê²Œ ì™¸ë¶€ ì„¤ì •ì„ ì½ëŠ” ë°©ë²•ë“¤ì„ ì œê³µí•œë‹¤.
  - `Environment`
  - `@Value` - ê°’ ì£¼ì…
  - `@ConfigurationProperties` - íƒ€ì… ì•ˆì „í•œ ì„¤ì • ì†ì„±
- ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” `@Value` ë°©ì‹ê³¼ `@ConfigurationProperties` ë°©ì‹ì˜ ì‚¬ìš©ë²•ì„ ì˜ˆì œë¥¼ í†µí•´ ì•Œì•„ë³¸ë‹¤.
- ì˜ˆì œëŠ” ì™¸ë¶€ ì„¤ì •(`application.properties`)ì„ ì½ì–´ì™€ì„œ `MyDataSource` ë¼ëŠ” ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ì˜ˆì œì´ë‹¤.

â–¶ï¸ MyDataSource - ì™¸ë¶€ ì„¤ì •ì„ ì´ìš©í•´ ê°’ì„ ì„¸íŒ…í•  ê°ì²´
```java
@Slf4j
public class MyDataSource {

    private String url;
    private String username;
    private String password;
    private int maxConnection;
    private Duration timeout;
    private List<String> options;

    public MyDataSource(String url, String username, String password, int maxConnection, Duration timeout, List<String> options) {
        this.url = url;
        this.username = username;
        this.password = password;
        this.maxConnection = maxConnection;
        this.timeout = timeout;
        this.options = options;
    }

    @PostConstruct
    public void init() {
        log.info("url={}", url);
        log.info("username={}", username);
        log.info("password={}", password);
        log.info("maxConnection={}", maxConnection);
        log.info("timeout={}", timeout);
        log.info("options={}", options);
    }
}
```
â–¶ï¸ application.properties - ì™¸ë¶€ ì„¤ì •
```properties
my.datasource.url=local.db.com
my.datasource.username=local_user
my.datasource.password=local_pw
my.datasource.etc.max-connection=1
my.datasource.etc.timeout=3500ms
my.datasource.etc.options=CACHE,ADMIN
```

# ğŸ’¡ ì™¸ë¶€ì„¤ì • ì‚¬ìš© - @Value
- `@Value` ë¥¼ ì‚¬ìš©í•˜ë©´ ì™¸ë¶€ ì„¤ì •ê°’ì„ í¸ë¦¬í•˜ê²Œ ì£¼ì…ë°›ì„ ìˆ˜ ìˆë‹¤.
- ì°¸ê³ ë¡œ `@Value` ë„ ë‚´ë¶€ì—ì„œëŠ” `Environment` ë¥¼ ì‚¬ìš©í•œë‹¤.
- `@Value` ì— `${}` ë¥¼ ì‚¬ìš©í•´ì„œ ì™¸ë¶€ ì„¤ì •ì˜ keyë¥¼ ì£¼ë©´ valueë¥¼ ì£¼ì… ë°›ì„ ìˆ˜ ìˆë‹¤.
- `@Value` ëŠ” í•„ë“œì— ì‚¬ìš©í•  ìˆ˜ë„ ìˆê³ , íŒŒë¼ë¯¸í„°ì—ë„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤.
- ë§Œì•½, keyì— í•´ë‹¹í•˜ëŠ” valueê°€ ì—†ì„ ê²½ìš° ê¸°ë³¸ê°’ì„ ì„¤ì •í•  ìˆ˜ë„ ìˆë‹¤.
  - ë‹¤ìŒê³¼ ê°™ì´ `:` ë’¤ì— ê¸°ë³¸ê°’ì„ ì ì–´ì£¼ë©´ ëœë‹¤.
  - ì˜ˆ) `@Value("${my.datasource.etc.max-connection:99}")`

```java
@Configuration
public class MyDatasourceValueConfig {

    @Value("${my.datasource.url}")
    private String url;
    @Value("${my.datasource.username}")
    private String username;
    @Value("${my.datasource.password}")
    private String password;
    @Value("${my.datasource.etc.max-connection}")
    private int maxConnection;
    @Value("${my.datasource.etc.timeout}")
    private Duration timeout;
    @Value("${my.datasource.etc.options}")
    private List<String> options;

    @Bean
    public MyDataSource myDataSource1() {
        return new MyDataSource(url, username, password, maxConnection, timeout, options);
    }

    @Bean
    public MyDataSource myDataSource2(
            @Value("${my.datasource.url}") String url,
            @Value("${my.datasource.username}") String username,
            @Value("${my.datasource.password}") String password,
            @Value("${my.datasource.etc.max-connection}") int maxConnection,
            @Value("${my.datasource.etc.timeout}") Duration timeout,
            @Value("${my.datasource.etc.options}") List<String> options) {
        
        return new MyDataSource(url, username, password, maxConnection, timeout, options);
    }
}
```

# ğŸ’¡ ì™¸ë¶€ì„¤ì • ì‚¬ìš© - @ConfigurationProperties
- Type-safe Configuration Properties
- ìŠ¤í”„ë§ì€ ì™¸ë¶€ ì„¤ì •ì˜ ë¬¶ìŒ ì •ë³´ë¥¼ ê°ì²´ë¡œ ë³€í™˜í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. ì´ê²ƒì„ íƒ€ì… ì•ˆì „í•œ ì„¤ì • ì†ì„±ì´ë¼ í•œë‹¤.
- ê°ì²´ë¥¼ ì‚¬ìš©í•˜ë©´ íƒ€ì…ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì‹¤ìˆ˜ë¡œ ì˜ëª»ëœ íƒ€ì…ì´ ë“¤ì–´ì˜¤ëŠ” ë¬¸ì œë¥¼ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.
- ì™¸ë¶€ ì„¤ì •ì„ ì£¼ì…ë°›ì„ ê°ì²´ë¥¼ ìƒì„±í•˜ê³ , `@ConfigurationProperties` ì„ ì ì–´ì¤€ë‹¤. ì—¬ê¸°ì— ì™¸ë¶€ ì„¤ì • keyì˜ prefixì¸ `my.datasource` ë¥¼ ì ì–´ì¤€ë‹¤.
- ê¸°ë³¸ ì£¼ì… ë°©ì‹ì€ ìë°”ë¹ˆ í”„ë¡œí¼í‹° ë°©ì‹(Getter, Setter)ì´ê³ , ê¶Œì¥ ë°©ì‹ì€ Constructorë°©ì‹ì´ë‹¤. (setterì˜ ê²½ìš° ê°’ì´ ë³€ê²½ë  ì†Œì§€ê°€ ìˆê¸° ë•Œë¬¸)

```java
@Getter
@ConfigurationProperties("my.datasource") // my.datasourceë¡œ ì‹œì‘í•˜ëŠ” ì™¸ë¶€ ì„¤ì •ê°’ì„ ì½ì–´ì˜¨ë‹¤.
public class MyDataSourcePropertiesV2 {

    private String url;
    private String username;
    private String password;
    private Etc etc;

    // ìƒì„±ì ì£¼ì…ì„ í†µí•´ ê°’ì„ í• ë‹¹í•œë‹¤.
    public MyDataSourcePropertiesV2(String url, String username, String password, @DefaultValue Etc etc) {
        this.url = url;
        this.username = username;
        this.password = password;
        this.etc = etc;
    }

    @Getter
    public static class Etc {
        private int maxConnection;
        private Duration timeout;
        private List<String> options;

        // ìƒì„±ì ì£¼ì…ì„ í†µí•´ ê°’ì„ í• ë‹¹í•œë‹¤.
        public Etc(int maxConnection, Duration timeout, @DefaultValue("DEFAULT") List<String> options) {
            this.maxConnection = maxConnection;
            this.timeout = timeout;
            this.options = options;
        }
    }
}
```
- ìƒì„±ìë¥¼ ë§Œë“¤ì–´ ë‘ë©´ ìƒì„±ìë¥¼ í†µí•´ì„œ ì„¤ì • ì •ë³´ë¥¼ ì£¼ì…í•œë‹¤.
- `@DefaultValue` : í•´ë‹¹ ê°’ì„ ì°¾ì„ ìˆ˜ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ê°’ì„ ì‚¬ìš©í•œë‹¤.
  - `@DefaultValue Etc etc` : etc ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì„ ê²½ìš° Etc ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ë‚´ë¶€ì— ë“¤ì–´ê°€ëŠ” ê°’ì€ ë¹„ì›Œë‘”ë‹¤.
  - `@DefaultValue("DEFAULT") List<String> options` : options ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì„ ê²½ìš° DEFAULT ë¼ëŠ” ì´ë¦„ì˜ ê°’ì„ ì‚¬ìš©í•œë‹¤.
- ì°¸ê³ ) ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 ë¶€í„°ëŠ” ìƒì„±ìê°€ í•˜ë‚˜ì¼ ë•ŒëŠ” `@ConstructorBinding` ì• ë…¸í…Œì´ì…˜ì„ ìƒëµí•  ìˆ˜ ìˆë‹¤.
  - ìƒì„±ìê°€ ë‘˜ ì´ìƒì¸ ê²½ìš°ì—ëŠ” ì‚¬ìš©í•  ìƒì„±ìì— `@ConstructorBinding` ì„ ì ìš©í•˜ë©´ ëœë‹¤.
- `@ConfigurationProperties` ë¥¼ í†µí•´ ì„¤ì •ê°’ì„ ì£¼ì…ë°›ì„ ê°ì²´ë¥¼ ë§Œë“¤ì—ˆë‹¤ë©´, ê·¸ ê°ì²´ë¥¼ `@EnableConfigurationProperties` ì„ ì‚¬ìš©í•´ì„œ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì•¼ í•œë‹¤.
  - ì°¸ê³ ) `@EnableConfigurationProperties` ëŒ€ì‹ ì— `@ConfigurationPropertiesScan` ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ë„ ìˆë‹¤.

```java
@Slf4j
@Configuration
@EnableConfigurationProperties(MyDataSourcePropertiesV2.class)
public class MyDataSourceConfigV2 {

    private final MyDataSourcePropertiesV2 properties;

    public MyDataSourceConfigV2(MyDataSourcePropertiesV2 properties) {
        this.properties = properties;
    }

    @Bean
    public MyDataSource myDataSource() {
        return new MyDataSource(properties.getUrl(),
                properties.getUsername(),
                properties.getPassword(),
                properties.getEtc().getMaxConnection(),
                properties.getEtc().getTimeout(),
                properties.getEtc().getOptions());
    }
}
```

## @ConfigurationProperties ê²€ì¦
- `@ConfigurationProperties` ë¥¼ í†µí•´ì„œ íƒ€ì…ì´ ë§ì§€ ì•ŠëŠ” ë°ì´í„°ë¥¼ ì…ë ¥í•˜ëŠ” ë¬¸ì œë¥¼ ì˜ˆë°©í•  ìˆ˜ ìˆë‹¤.
- ì—¬ê¸°ì— ë”í•´ `@ConfigurationProperties` ëŠ” ìë°” ê°ì²´ì´ê¸° ë•Œë¬¸ì— ìŠ¤í”„ë§ì´ ìë°” ë¹ˆ ê²€ì¦ê¸°(java bean validation)ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•œë‹¤.
- `@Validated` ì• ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•˜ê³ , ê²€ì¦ì„ ì›í•˜ëŠ” í•„ë“œì— ê²€ì¦ ì• ë…¸í…Œì´ì…˜ì„ ì ì–´ì£¼ë©´ ëœë‹¤.

```java
@Getter
@ConfigurationProperties("my.datasource")
@Validated
public class MyDataSourcePropertiesV3 {

    @NotEmpty
    private String url;
    @NotEmpty
    private String username;
    @NotEmpty
    private String password;
    private Etc etc;

    public MyDataSourcePropertiesV3(String url, String username, String password, Etc etc) {
        this.url = url;
        this.username = username;
        this.password = password;
        this.etc = etc;
    }

    @Getter
    public static class Etc {
        @Min(1)
        @Max(99)
        private int maxConnection;
        @DurationMin(seconds = 1)
        @DurationMax(seconds = 60)
        private Duration timeout;
        private List<String> options;

        public Etc(int maxConnection, Duration timeout, @DefaultValue("DEFAULT") List<String> options) {
            this.maxConnection = maxConnection;
            this.timeout = timeout;
            this.options = options;
        }
    }
}
```
