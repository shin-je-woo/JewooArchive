# ğŸ’¡ ìƒí’ˆ ì—”í‹°í‹° ê°œë°œ(ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¶”ê°€)
```java
@Entity
@Inheritance(strategy = InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn(name = "dtype")
@Getter @Setter
public abstract class Item {

    @Id
    @GeneratedValue
    @Column(name = "item_id")
    private Long id;

    private int price;
    private String name;
    private int stockQuantity;

    @ManyToMany(mappedBy = "items")
    private List<Category> categories = new ArrayList<>();
    
    //===ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§==//
    /**
     * stock ì¦ê°€
     */
    public void addStock(int quantity){
        this.stockQuantity += quantity;
    }

    /**
     * stock ê°ì†Œ
     */
    public void removeStock(int quantity){
        int restStock = this.stockQuantity - quantity;
        if(restStock  < 0){
            throw new NotEnoughStockException("need more stock");
        }
        this.stockQuantity = restStock;
    }
}
```
* ì‹¤ë¬´ì—ì„œëŠ” @Setterë¥¼ ì œê±°í•˜ëŠ”ê²Œ ì¢‹ë‹¤. ì˜ˆë¥¼ë“¤ì–´ ì¬ê³ (stock)ì˜ ê²½ìš°ì—ë„ Setterë¥¼ í†µí•´ ë³€ê²½í•˜ëŠ”ê²ƒì´ ì•„ë‹ˆë¼ ë³„ë„ì˜ ë©”ì„œë“œ(addStock(), removeStock())ì„ í†µí•´ ìˆ˜ì •
* ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„(DDD)ë¥¼ í•œë‹¤ê³  í•  ë•Œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ì—”í‹°í‹° ì•ˆì— ìˆëŠ”ê²ƒì´ ì‘ì§‘ë„ë¥¼ ë†’í ìˆ˜ ìˆë‹¤.(= ê°ì²´ì§€í–¥ ì„¤ê³„)

# ğŸ’¡ ìƒí’ˆ ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ
```java
@Repository
@RequiredArgsConstructor
public class ItemRepository {

    private final EntityManager em;

    public void save(Item item){
        if(item.getId() == null){// idê°€ ì—†ì„ ê²½ìš° ìƒˆë¡œìš´ ê°ì²´ì´ê¸°ì— persistí•´ì¤€ë‹¤
            em.persist(item);
        } else {//idê°€ ìˆì„ ê²½ìš° ì´ë¯¸ dbì—ì„œ ê´€ë¦¬ë˜ê³  ìˆëŠ” ê°ì²´ì´ê¸°ì— mergeë¡œ ì—…ë°ì´íŠ¸ í•´ ì¤€ë‹¤.
            em.merge(item);
        }
    }

    public Item findOne(Long id){
        return em.find(Item.class, id);
    }

    public List<Item> findAll(){
        return em.createQuery("select i from Item i", Item.class).getResultList();
    }
}
```

# ğŸ’¡ ìƒí’ˆ ì„œë¹„ìŠ¤ ê°œë°œ
```java
@Service
@Transactional(readOnly = true)
@RequiredArgsConstructor
public class ItemService {

    private final ItemRepository itemRepository;

    @Transactional
    public void saveItem(Item item){
        itemRepository.save(item);
    }

    public List<Item> findItems(){
        return itemRepository.findAll();
    }

    public Item findOne(Long itemId){
        return itemRepository.findOne(itemId);
    }
}
```
