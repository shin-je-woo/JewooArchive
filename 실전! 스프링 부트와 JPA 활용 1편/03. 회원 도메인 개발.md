â–¶ï¸ íšŒì›(Member) ì—”í‹°í‹°
```java
@Entity
@Getter @Setter
public class Member {
    @Id @GeneratedValue
    @Column(name = "member_id") 
    private Long id;

    private String name;

    @Embedded
    private Address address;

    @OneToMany(mappedBy = "member")
    private List<Order> orders = new ArrayList<>();
}
```

# ğŸ’¡ íšŒì› ë¦¬í¬ì§€í† ë¦¬ ê°œë°œ
```java
@Repository
public class MemberRepository {

    @PersistenceContext
    private EntityManager em;

    public void save(Member member) {em.persist(member);}

    public Member findOne(Long id) {
        return em.find(Member.class, id);
    }

    public List<Member> findAll() {
        return em.createQuery("select m from Member m", Member.class).getResultList();
    }

    public List<Member> findByName(String name){
        return em.createQuery("select m from Member m where m.name = :name", Member.class)
                .setParameter("name", name)
                .getResultList();
    }

}
```
* @Repository : ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡, JPA ì˜ˆì™¸ë¥¼ ìŠ¤í”„ë§ ê¸°ë°˜ ì˜ˆì™¸ë¡œ ì˜ˆì™¸ ë³€í™˜
* @PersistenceContext : ì—”í‹°í‹° ë©”ë‹ˆì €( EntityManager ) ì£¼ì…
* @PersistenceUnit : ì—”í‹°í‹° ë©”ë‹ˆí„° íŒ©í† ë¦¬( EntityManagerFactory ) ì£¼ì…

# ğŸ’¡ íšŒì› ì„œë¹„ìŠ¤ ê°œë°œ
```java
@Service
@Transactional
@RequiredArgsConstructor
public class MemberService {
    
    private final MemberRepository memberRepository; //finalì„ ë„£ìœ¼ë©´ ì»´íŒŒì¼ ì‹œì ì— ì£¼ì…ì´ ì œëŒ€ë¡œ ë˜ëŠ”ì§€ í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤.

    /**
     * íšŒì› ê°€ì…
     */
    @Transactional
    public Long join(Member member){
        validateDuplicateMember(member); //ì¤‘ë³µ íšŒì› ê²€ì¦
        memberRepository.save(member);
        return member.getId();
    }

    private void validateDuplicateMember(Member member) {
        List<Member> findMembers = memberRepository.findByName(member.getName());
        if(!findMembers.isEmpty()){
            throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
        }
    }

    /**
     * ì „ì²´ íšŒì› ì¡°íšŒ
     */
    @Transactional(readOnly = true) //ì¡°íšŒë§Œ í•˜ëŠ” serviceì—ì„œ readOnlyì„¤ì •ì„ í•´ì£¼ë©´ ìµœì í™”ì™€ ì„±ëŠ¥ê°œì„ ì„ ê¸°ëŒ€í•  ìˆ˜ ìˆë‹¤. 
    public List<Member> findMembers(){
        return memberRepository.findAll();
    }
    
    @Transactional(readOnly = true)
    public Member findOne(Long memberId){
        return memberRepository.findOne(memberId);
    }
}
```
* @Transactional : íŠ¸ëœì­ì…˜, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸
  * readOnly=true : ë°ì´í„°ì˜ ë³€ê²½ì´ ì—†ëŠ” ì½ê¸° ì „ìš© ë©”ì„œë“œì— ì‚¬ìš©, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ í”ŒëŸ¬ì‹œ í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì•½ê°„ì˜ ì„±ëŠ¥ í–¥ìƒ(ì½ê¸° ì „ìš©ì—ëŠ” ë‹¤ ì ìš©)
  * ë°ì´í„°ë² ì´ìŠ¤ ë“œë¼ì´ë²„ê°€ ì§€ì›í•˜ë©´ DBì—ì„œ ì„±ëŠ¥ í–¥ìƒ

# ğŸ’¡ íšŒì› ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
í…ŒìŠ¤íŠ¸ ìš”êµ¬ì‚¬í•­
* íšŒì›ê°€ì…ì„ ì„±ê³µí•´ì•¼ í•œë‹¤.
* íšŒì›ê°€ì… í•  ë•Œ ê°™ì€ ì´ë¦„ì´ ìˆìœ¼ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•´ì•¼ í•œë‹¤.

```java
@RunWith(SpringRunner.class)
@SpringBootTest
@Transactional
public class MemberServiceTest {

    @Autowired
    MemberService memberService;

    @Autowired
    MemberRepository memberRepository;


    @Test
    @Rollback(false) 
    public void íšŒì›ê°€ì…() throws Exception{
        //given
        Member member = new Member();
        member.setName("kim");

        //when
        Long savedId =  memberService.join(member);

        //then
        assertEquals(member, memberRepository.findOne(savedId));
    }

    @Test(expected = IllegalStateException.class)
    public void ì¤‘ë³µ_íšŒì›_ì˜ˆì™¸() throws Exception{
        //given
        Member member1 = new Member();
        member1.setName("kim1");

        Member member2 = new Member();
        member2.setName("kim1");

        //when
        memberService.join(member1);
        memberService.join(member2); //ì˜ˆì™¸ê°€ ë°œìƒí•´ì•¼ í•œë‹¤.

        //then
        fail("ì˜ˆì™¸ê°€ ë°œìƒí•´ì•¼ í•œë‹¤.");
    }

}
```
