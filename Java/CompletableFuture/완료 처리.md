# Previous

- CompletableFuture ëŠ” ë¹„ë™ê¸° ì‘ì—…ì˜ ì™„ë£Œë¥¼ ìœ„í•œ ì—¬ëŸ¬ê°€ì§€ ë©”ì„œë“œë¥¼ ì œê³µí•˜ê³  ìˆë‹¤.

![image](https://github.com/shin-je-woo/TIL/assets/39439576/b2855009-82c7-4136-a0a1-daeacb3d3243)

# ğŸ’¡ ì™„ë£Œ ì„¤ì • ë©”ì„œë“œ

- CompletableFuture ì˜ í•µì‹¬ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ë¡œì¨ ë¹„ë™ê¸° ì‘ì—…ì˜ ê²°ê³¼ë¥¼ ì‚¬ìš©ìê°€ ì§ì ‘ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

## complete(T result)

- CompletableFuture ê°€ ì™„ë£Œë˜ì§€ ì•Šì•˜ë‹¤ë©´ ì£¼ì–´ì§„ ê°’ìœ¼ë¡œ ì„¤ì •í•˜ê³  CompletableFuture ë¥¼ ì™„ë£Œ ìƒíƒœë¡œ ì „í™˜í•œë‹¤.
- ì´ë¯¸ ì™„ë£Œ ìƒíƒœì´ë©´ ë‹¤ë¥¸ ê°’ìœ¼ë¡œ ë‹¤ì‹œ ì™„ë£Œì‹œí‚¬ ìˆ˜ ì—†ìœ¼ë©° ì™„ë£Œ ìƒíƒœë¡œ ì „í™˜í•˜ë©´ true ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ false ë¥¼ ë°˜í™˜í•œë‹¤.

```java
CompletableFuture<Integer> future = new CompletableFuture<>(); // í˜„ì¬ result ëŠ” null ìƒíƒœ
new Thread(() -> { // ë¹„ë™ê¸° ì‘ì—… ìˆ˜í–‰
    try {
        Thread.sleep(2000);
        int result = 42; // ì‘ì—… ê²°ê³¼
        boolean isCompleted = future.complete(result); // ì‘ì—… ì™„ë£Œ ë° ê²°ê³¼ ì„¤ì •
    } catch (InterruptedException e) {
    }
}).start();

otherTask(); // ì‘ì—…ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°í•˜ì§€ ì•Šê³  ë‹¤ë¥¸ ì‘ì—… ìˆ˜í–‰ ê°€ëŠ¥
int result = future.join(); // ê²°ê³¼ ê°€ì ¸ì˜¤ê¸° (ì‘ì—…ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°)
System.out.println("ì‘ì—… ê²°ê³¼: " + result); // ì¶œë ¥: ì‘ì—… ê²°ê³¼: 42
```

## completedFuture (T result)

- ì£¼ì–´ì§„ ê°’ìœ¼ë¡œ ì´ë¯¸ ì™„ë£Œëœ ìƒˆë¡œìš´ CompletableFutureë¥¼ ë°˜í™˜í•œë‹¤.
- ë¹„ë™ê¸° ì‘ì—…ì„ ìˆ˜í–‰í•˜ì§€ ì•Šê³  ë¯¸ë¦¬ ê³„ì‚°ëœ ê²°ê³¼ë¥¼ ë°˜í™˜í•´ì•¼ í•  ë•Œ ìœ ìš©í•˜ë‹¤.

```java
CompletableFuture<Integer> future = CompletableFuture.completedFuture(42); // ì´ë¯¸ ì™„ë£Œëœ ê²°ê³¼ ê°’ì„ ê°€ì§„ CompletableFuture ìƒì„±
int result = future.join(); // ê²°ê³¼ ê°€ì ¸ì˜¤ê¸° (ë¹„ë™ê¸° ì‘ì—… ì—†ìŒ)
System.out.println("ê²°ê³¼: " + result); // ì¶œë ¥: ê²°ê³¼: 42
```

## completeOnTimeout(T value, long timeout, TimeUnit unit)

- ì§€ì •ëœ íƒ€ì„ì•„ì›ƒ ì´ì „ì— ì™„ë£Œë˜ì§€ ì•ŠëŠ” ê²½ìš° ì£¼ì–´ì§„ ê¸°ë³¸ ê°’ìœ¼ë¡œ ì™„ë£Œí•œë‹¤.

```java
CompletableFuture<Integer> future = CompletableFuture.supplyAsync(() -> {
    try {
        Thread.sleep(3000);
        return 42;
    } catch (InterruptedException e) {
    }
});

// ì‘ì—…ì´ ì£¼ì–´ì§„ ì‹œê°„ ë‚´ì— ì™„ë£Œë˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ê°’ ë°˜í™˜
CompletableFuture<Integer> resultFuture = future.completeOnTimeout(100, 2, TimeUnit.SECONDS);
int result = resultFuture.join(); // ê²°ê³¼ ê°€ì ¸ì˜¤ê¸°
System.out.println("ìµœì¢… ê²°ê³¼: " + result); // 100
```

## completeExceptionally(Throwable ex)

- CompletableFuture ë¥¼ ì˜ˆì™¸ ìƒíƒœë¡œ ì™„ë£Œì‹œí‚¤ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ë©”ì„œë“œë¡œ ì£¼ì–´ì§„ ì˜ˆì™¸ ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë™ê¸° ì‘ì—…ì„ ì˜ˆì™¸ë¡œ ì²˜ë¦¬í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- exceptionally ë˜ëŠ” handle ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ˆì™¸ ì²˜ë¦¬ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìœ¼ë©° ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ê³  ëŒ€ì²´ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ê±°ë‚˜ ë‹¤ë¥¸ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

```java
CompletableFuture<Integer> future = new CompletableFuture<>();
new Thread(() -> {
    try {
        int result = 10 / 0; // ì˜ˆì™¸ ë°œìƒ
        future.complete(result); // ì‘ì—… ì™„ë£Œ (ì‹¤í–‰ë˜ì§€ ì•ŠìŒ)
    } catch (ArithmeticException e) {
        future.completeExceptionally(e); // ì˜ˆì™¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‘ì—… ì™„ë£Œ
    }
}).start();

// ê²°ê³¼ ê°€ì ¸ì˜¤ê¸° (ì˜ˆì™¸ ì²˜ë¦¬)
future.exceptionally(ex -> {
    System.err.println("ì˜ˆì™¸ ë°œìƒ: " + ex.getMessage()); // ì¶œë ¥: ì˜ˆì™¸ ë°œìƒ: / by zero
    return 0; // ëŒ€ì²´ ê²°ê³¼ ë°˜í™˜
});

// ì‘ì—… ê²°ê³¼ ê°€ì ¸ì˜¤ê¸° (ëŒ€ì²´ ê²°ê³¼)
int result = future.join();
System.out.println("ì‘ì—… ê²°ê³¼: " + result); // ì¶œë ¥: ì‘ì—… ê²°ê³¼: 0 (ì˜ˆì™¸ë¡œ ì¸í•´ ëŒ€ì²´ ê²°ê³¼)
```

# ğŸ’¡ ì™„ë£Œ ìƒíƒœ í™•ì¸ ë©”ì„œë“œ

- CompletableFuture ëŠ” ì™„ë£Œ ìƒíƒœë¥¼ ëª…í™•í•˜ê²Œ êµ¬ë¶„í•  ìˆ˜ ìˆë„ë¡ `isCompletedExceptionally` ë©”ì„œë“œë¥¼ ì¶”ê°€ ì œê³µí•œë‹¤.

![image](https://github.com/shin-je-woo/TIL/assets/39439576/fb16f5e3-e34b-4fc6-b27c-703a3f394651)

## isCancelled()

- ì‘ì—…ì´ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œë˜ê¸° ì „ì— ì·¨ì†Œ ë˜ì—ˆìœ¼ë©´ true ë¥¼ ë°˜í™˜í•œë‹¤.

## isDone()

- ì •ìƒì ìœ¼ë¡œ, ì˜ˆì™¸ì ìœ¼ë¡œ, ë˜ëŠ” ì·¨ì†Œë¥¼ í†µí•´ ì™„ë£Œëœ ê²½ìš° ë“± ì–´ë–¤ ë°©ì‹ìœ¼ë¡œë“  ì™„ë£Œëœ ê²½ìš° trueë¥¼ ë°˜í™˜í•œë‹¤.

## isCompletedExceptionally()

- CompletableFuture ê°€ ì·¨ì†Œ ë˜ê±°ë‚˜ completeExceptionally ì˜ ëª…ì‹œì  í˜¸ì¶œ, CompletionStage ì‹¤í–‰ì˜ ê°‘ì‘ìŠ¤ëŸ° ì¢…ë£Œ ë“± ì˜ˆì™¸ì ìœ¼ë¡œ ì™„ë£Œëœ ê²½ìš° true ë¥¼ ë°˜í™˜í•œë‹¤.

```java
CompletableFuture<Integer> firstFuture = CompletableFuture.supplyAsync(() -> {
    sleep(2000);
    return 10;
});
CompletableFuture<Integer> secondFuture = CompletableFuture.supplyAsync(() -> {
    sleep(1000);
    throw new RuntimeException("ë‘ ë²ˆì§¸ ì‘ì—…ì—ì„œ ì˜ˆì™¸ ë°œìƒ"); // CompletableFuture ì—ëŠ” CompletionException ì´ ê²°ê³¼ê°’ìœ¼ë¡œ ì €ì¥ëœë‹¤
});
CompletableFuture<Integer> thirdFuture = CompletableFuture.supplyAsync(() -> {
    sleep(3000);
    return 20;
});
CompletableFuture<Integer> combinedFuture = firstFuture.thenCombine(secondFuture, (result1, result2) -> {
            if (secondFuture.isCompletedExceptionally()) { // ë‘ ë²ˆì§¸ ì‘ì—…ì´ ì˜ˆì™¸ë¡œ ì™„ë£Œëœ ê²½ìš° ì²« ë²ˆì§¸ ì‘ì—… ê²°ê³¼ ë°˜í™˜
                return result1;
            }
            return result1 + result2; // ë‘ ë²ˆì§¸ ì‘ì—…ì´ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œëœ ê²½ìš° í•©ì‚°í•˜ì—¬ ê²°ê³¼ ë°˜í™˜
        })
        .thenCombine(thirdFuture, (result1, result3) -> result1 + result3); // ì„¸ ë²ˆì§¸ CompletableFuture ì™€ í•©ì‚°
int result = combinedFuture.join(); // ê²°ê³¼ ê°€ì ¸ì˜¤ê¸°
System.out.println("ìµœì¢… ê²°ê³¼: " + result);
```

# ğŸ’¡ CompletableFuture ì™„ë£Œ ì›ë¦¬

![image](https://github.com/shin-je-woo/TIL/assets/39439576/a26eed2b-d9f2-495c-80d8-374a3fd18d4f)
