# ğŸ’¡ ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ ì†Œê°œ
### JPAëŠ” ë‹¤ì–‘í•œ ì¿¼ë¦¬ ë°©ë²•ì„ ì§€ì›
* JPQL
* JPA Criteria
* QueryDSL
* ë„¤ì´í‹°ë¸Œ SQL
* JDBC API ì§ì ‘ ì‚¬ìš©, MyBatis, SpringJdbcTemplate í•¨ê»˜ ì‚¬ìš©

âœ… JPQL ì†Œê°œ
* ê°€ì¥ ë‹¨ìˆœí•œ ì¡°íšŒ ë°©ë²•
  * EntityManager.find()
  * ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰(a.getB().getC())
 * â“ ë‚˜ì´ê°€ 18ì‚´ ì´ìƒì¸ íšŒì›ì„ ëª¨ë‘ ê²€ìƒ‰í•˜ê³  ì‹¶ë‹¤ë©´?

âœ… JPQL
* í…Œì´ë¸”ì´ ì•„ë‹Œ ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ” ê°ì²´ ì§€í–¥ ì¿¼ë¦¬
* SQLì„ ì¶”ìƒí™”í•´ì„œ íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ SQLì— ì˜ì¡´X
* JPQLì„ í•œë§ˆë””ë¡œ ì •ì˜í•˜ë©´ ê°ì²´ ì§€í–¥ SQL

âœ… QueryDSL ì†Œê°œ
* ë¬¸ìê°€ ì•„ë‹Œ ìë°”ì½”ë“œë¡œ JPQLì„ ì‘ì„±í•  ìˆ˜ ìˆìŒ
* JPQL ë¹Œë” ì—­í• 
* ì»´íŒŒì¼ ì‹œì ì— ë¬¸ë²• ì˜¤ë¥˜ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŒ
* ë™ì ì¿¼ë¦¬ ì‘ì„± í¸ë¦¬í•¨

âœ… ë„¤ì´í‹°ë¸Œ SQL ì†Œê°œ
* JPAê°€ ì œê³µí•˜ëŠ” SQLì„ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥
* JPQLë¡œ í•´ê²°í•  ìˆ˜ ì—†ëŠ” íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì— ì˜ì¡´ì ì¸ ê¸°ëŠ¥
* ì˜ˆ) ì˜¤ë¼í´ CONNECT BY, íŠ¹ì • DBë§Œ ì‚¬ìš©í•˜ëŠ” SQL íŒíŠ¸

âœ… JDBC ì§ì ‘ ì‚¬ìš©, SpringJdbcTemplate ë“±
* JPAë¥¼ ì‚¬ìš©í•˜ë©´ì„œ JDBC ì»¤ë„¥ì…˜ì„ ì§ì ‘ ì‚¬ìš©í•˜ê±°ë‚˜, ìŠ¤í”„ë§ JdbcTemplate, ë§ˆì´ë°”í‹°ìŠ¤ ë“±ì„ í•¨ê»˜ ì‚¬ìš© ê°€ëŠ¥
* ë‹¨, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì ì ˆí•œ ì‹œì ì— ê°•ì œë¡œ í”ŒëŸ¬ì‹œ í•„ìš”
* ì˜ˆ) JPAë¥¼ ìš°íšŒí•´ì„œ SQLì„ ì‹¤í–‰í•˜ê¸° ì§ì „ì— ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ìˆ˜ë™ í”ŒëŸ¬ì‹œ

# ğŸ’¡ JPQL - ê¸°ë³¸ ë¬¸ë²•ê³¼ ê¸°ëŠ¥
### JPQL ë¬¸ë²•
![image](https://user-images.githubusercontent.com/39439576/231673934-37b1838f-10ed-45b3-aea1-43fb4166d304.png)
* select m from Member as m where m.age > 18
* ì—”í‹°í‹°ì™€ ì†ì„±ì€ ëŒ€ì†Œë¬¸ì êµ¬ë¶„O (Member, age)
* JPQL í‚¤ì›Œë“œëŠ” ëŒ€ì†Œë¬¸ì êµ¬ë¶„X (SELECT, FROM, where)
* ì—”í‹°í‹° ì´ë¦„ ì‚¬ìš©, í…Œì´ë¸” ì´ë¦„ì´ ì•„ë‹˜(Member)
* ë³„ì¹­ì€ í•„ìˆ˜(m) (asëŠ” ìƒëµê°€ëŠ¥)
* ì§‘í•©ê³¼ ì •ë ¬
  * count(m), sum(m.age), avg(m.age), max(m.age), min(m.age)
  * group by, having

### TypeQuery, Query
* TypeQuery: ë°˜í™˜ íƒ€ì…ì´ ëª…í™•í•  ë•Œ ì‚¬ìš©
```java
TypedQuery<Member> query = em.createQuery("SELECT m FROM Meber m", Member.class);
```
* Query: ë°˜í™˜ íƒ€ì…ì´ ëª…í™•í•˜ì§€ ì•Šì„ ë•Œ ì‚¬ìš©
```java
Query query = em.createQuery("SELECT m.username, m.age FROM Meber m");
```

### ê²°ê³¼ ì¡°íšŒ API
* query.getResultList(): ê²°ê³¼ê°€ í•˜ë‚˜ ì´ìƒì¼ ë•Œ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
  * ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
* query.getSingleResult(): ê²°ê³¼ê°€ ì •í™•íˆ í•˜ë‚˜, ë‹¨ì¼ ê°ì²´ ë°˜í™˜  
  ì°¸ê³ ) ê²°ê³¼ê°€ í•˜ë‚˜ë§Œ ë‚˜ì˜¤ëŠ” ê²ƒ ì™¸ì˜ ëª¨ë“  ìƒí™©ì—ì„œ ì—ëŸ¬ê°€ ë‚˜ì˜¤ê¸° ë•Œë¬¸ì— ì‚¬ìš©ì— ì£¼ì˜ê°€ í•„ìš”.
  * ê²°ê³¼ê°€ ì—†ìœ¼ë©´: javax.persistence.NoResultException
  * ë‘˜ ì´ìƒì´ë©´: javax.persistence.NonUniqueResultException

### íŒŒë¼ë¯¸í„° ë°”ì¸ë”©
```java
String query = "SELECT m FROM Member m where m.username = :username";
query.setParameter("username" usernameParam);
```

### í”„ë¡œì ì…˜
- SELECT ì ˆì— ì¡°íšŒí•  ëŒ€ìƒì„ ì§€ì •í•˜ëŠ” ê²ƒ
- í”„ë¡œì ì…˜ ëŒ€ìƒ: ì—”í‹°í‹°, ì„ë² ë””ë“œ íƒ€ì…, ìŠ¤ì¹¼ë¼ íƒ€ì…(ìˆ«ì, ë¬¸ìë“± ê¸°ë³¸ ë°ì´í„° íƒ€ì…)
- SELECT **m** FROM Member m â†’ ì—”í‹°í‹° í”„ë¡œì ì…˜
- SELECT **m.team** FROM Member m â†’ ì—”í‹°í‹° í”„ë¡œì ì…˜
- SELECT **m.address** FROM Member m â†’ ì„ë² ë””ë“œ íƒ€ì… í”„ë¡œì ì…˜
- SELECT **m.username, m.age** FROM Member m â†’ ìŠ¤ì¹¼ë¼ íƒ€ì… í”„ë¡œì ì…˜
- DISTINCTë¡œ ì¤‘ë³µ ì œê±°

### í˜ì´ì§• API
- DB ë°©ì–¸ì— ë”°ë¼ ë‹¤ë¥¸ í˜ì´ì§• SQL ìƒì„±(ì¶”ìƒí™”ì˜ ì¥ì )
- JPAëŠ” í˜ì´ì§•ì„ ë‹¤ìŒ ë‘ APIë¡œ ì¶”ìƒí™”
- setFirstResult(int startPosition) : ì¡°íšŒ ì‹œì‘ ìœ„ì¹˜ (0ë¶€í„° ì‹œì‘)
- setMaxResults(int maxResult) : ì¡°íšŒí•  ë°ì´í„° ìˆ˜
```java
//í˜ì´ì§• ì¿¼ë¦¬
 String jpql = "select m from Member m order by m.name desc";
 List<Member> resultList = em.createQuery(jpql, Member.class)
                            .setFirstResult(10)
                            .setMaxResults(20)
                            .getResultList();
```

### ì¡°ì¸
- ë‚´ë¶€ ì¡°ì¸: SELECT m FROM Member m [INNER] JOIN m.team t
- ì™¸ë¶€ ì¡°ì¸: SELECT m FROM Member m LEFT [OUTER] JOIN m.team t
- ì„¸íƒ€ ì¡°ì¸: SELECT count(m) from Member m, Team t where m.username = t.name

âœ… ì¡°ì¸ - ON ì ˆ
1. ì¡°ì¸ ëŒ€ìƒ í•„í„°ë§  
ex: íšŒì›ê³¼ íŒ€ì„ ì¡°ì¸í•˜ë©´ì„œ, íŒ€ ì´ë¦„ì´ Aì¸ íŒ€ë§Œ ì¡°ì¸
```java
JPQL: 
SELECT m, t FROM Member m LEFT JOIN m.team t on t.name = 'A'
SQL: 
SELECT m.*, t.* FROM Member m LEFT JOIN Team t ON m.TEAM_ID = t.id and t.name ='A'
```
2. ì—°ê´€ê´€ê³„ ì—†ëŠ” ì—”í‹°í‹° ì™¸ë¶€ ì¡°ì¸  
ex: íšŒì›ì˜ ì´ë¦„ê³¼ íŒ€ì˜ ì´ë¦„ì´ ê°™ì€ ëŒ€ìƒ ì™¸ë¶€ì¡°ì¸
```java
JPQL: 
SELECT m, t FROM Member m LEFT JOIN Team t on m.username = t.name
SQL: 
SELECT m.*, t.* FROM Member m LEFT JOIN Team t ON m.username = t.name
```

### ì„œë¸Œ ì¿¼ë¦¬
* ex) ë‚˜ì´ê°€ í‰ê· ë³´ë‹¤ ë§ì€ íšŒì›
```java
select m from Member m
where m.age > (select avg(m2.age) from Member m2)
```
* ex) í•œ ê±´ì´ë¼ë„ ì£¼ë¬¸í•œ ê³ ê°
```java
select m from Member m
where (select count(o) from Order o where m = o.member) > 0
```
