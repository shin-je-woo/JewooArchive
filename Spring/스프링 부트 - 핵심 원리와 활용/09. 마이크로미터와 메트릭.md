# π’΅ λ§μ΄ν¬λ΅λ―Έν„°λ€?
- μ„λΉ„μ¤λ¥Ό μ΄μν•  λ•λ” μ• ν”λ¦¬μΌ€μ΄μ…μ CPU, λ©”λ¨λ¦¬, μ»¤λ„¥μ… μ‚¬μ©, κ³ κ° μ”μ²­μμ™€ κ°™μ€ λ§μ€ μ§€ν‘(metric)λ“¤μ„ ν™•μΈν•λ” κ²ƒμ΄ ν•„μ”ν•λ‹¤.
- ν„μ¬ μλ§μ€ λ¨λ‹ν„°λ§ ν΄μ΄ μμΌλ©°, μ‹μ¤ν…μ λ‹¤μ–‘ν• μ •λ³΄λ¥Ό λ¨λ‹ν„°λ§ ν΄μ— μ „λ‹¬ν•΄μ„ μ‚¬μ©ν•κ² ν•λ‹¤.
  - λ€ν‘μ μΌλ΅ κ·ΈλΌνλ‚, ν•€ν¬μΈνΈ λ¨λ‹ν„°λ§ ν΄μ΄ μλ‹¤.
- λ¨λ‹ν„°λ§ ν΄μ„ μ‚¬μ©ν•κΈ° μ„ν•΄μ„λ” μ‹μ¤ν…μ λ‹¤μ–‘ν• μ§€ν‘λ“¤μ„ κ°κ°μ λ¨λ‹ν„°λ§ ν΄μ— λ§λ„λ΅ λ§λ“¤μ–΄μ•Ό ν•λ‹¤.

![image](https://github.com/shin-je-woo/TIL/assets/39439576/bd278850-9da8-4843-acd5-0e84aae50e49)

- λ§μ•½, μ‹μ¤ν…μ CPU, JVM, μ»¤λ„¥μ… μ •λ³΄ λ“±μ„ JMX ν΄μ— μ „λ‹¬ν•λ ¤λ©΄ JMX λ¨λ‹ν„°λ§ ν΄μ΄ μ •ν• ν¬λ§·μΌλ΅ λ©”νΈλ¦­ μ •λ³΄λ¥Ό μΈ΅μ •ν•κ³  μ „λ‹¬ν•΄μ•Ό ν•λ‹¤.
- μ¤‘κ°„μ— ν”„λ΅λ©”ν…μ°μ¤λ΅ λ³€κ²½ν•λ ¤λ©΄ κΈ°μ΅΄μ— μΈ΅μ •ν• λ©”νΈλ¦­ μ •λ³΄λ¥Ό λ‹¤μ‹ ν¬λ§·ν…ν•κ³  μΈ΅μ •μ½”λ“λ„ λ³€κ²½ν•΄μ•Ό ν•λ‹¤.
- μ΄λ° λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ λ“±μ¥ν• κ²ƒμ΄ **λ§μ΄ν¬λ΅λ―Έν„°(Micrometer)** μ΄λ‹¤. (JDBCκ°€ λ“±μ¥ν• λ°°κ²½κ³Ό λΉ„μ·ν• κ²ƒ κ°™λ‹¤.)

# π’΅ λ§μ΄ν¬λ΅λ―Έν„° μ¶”μƒν™”
![image](https://github.com/shin-je-woo/TIL/assets/39439576/a1e6b271-ef53-4efd-8881-b7ea1026c6dd)
- λ§μ΄ν¬λ΅λ―Έν„°λ” CPU, JVM λ“±λ“± μ—¬λ¬κ°€μ§€ λ©”νΈλ¦­(μΈ΅μ • μ§€ν‘)μ— λ€ν• ν‘μ¤€ μΈ΅μ • λ°©μ‹μ„ μ κ³µν•λ‹¤.
- μ¦‰, λ§μ΄ν¬λ΅λ―Έν„°κ°€ μ κ³µν•λ” ν‘μ¤€λ°©μ‹μΌλ΅ λ©”νΈλ¦­μ„ μΈ΅μ •ν•λ©΄ λ§μ΄ν¬λ΅λ―Έν„° κµ¬ν„μ²΄λ¥Ό μ‰½κ² κ°μ•„λΌμΈ μ μλ‹¤.
- μ΄λ° μ΄μ λ΅ λ§μ΄ν¬λ΅λ―Έν„°λ” μ• ν”λ¦¬μΌ€μ΄μ… λ©”νΈλ¦­ νμ‚¬λ“λΌκ³  λ¶λ¦°λ‹¤.
- μ¤ν”„λ§λ¶€νΈ μ•΅μ¶”μ—μ΄ν„°λ” λ§μ΄ν¬λ΅λ―Έν„°λ¥Ό κΈ°λ³ΈμΌλ΅ λ‚΄μ¥ν•λ‹¤.
  - λ”°λΌμ„, μ¤ν”„λ§λ¶€νΈ μ•΅μ¶”μ—μ΄ν„°λ΅ λ©”νΈλ¦­μ„ μΈ΅μ •ν•λ©΄ λ§μ΄ν¬λ΅λ―Έν„° λ°©μ‹μΌλ΅ λ©”νΈλ¦­μ΄ μΈ΅μ •λλ‹¤.
- [λ§μ΄ν¬λ΅λ―Έν„°κ°€ μ§€μ›ν•λ” λ¨λ‹ν„°λ§ ν΄](https://micrometer.io/docs)

# π’΅ λ©”νΈλ¦­ μμ§‘, ν™•μΈν•κΈ°
- λ§μ΄ν¬λ΅λ―Έν„°λ” λ‹¤μ–‘ν• μ§€ν‘ μμ§‘ κΈ°λ¥μ„ μ΄λ―Έ λ§λ“¤μ–΄μ„ μ κ³µν•λ‹¤.
- κ·Έλ¦¬κ³  μ¤ν”„λ§ λ¶€νΈ μ•΅μ¶”μ—μ΄ν„°λ” λ§μ΄ν¬λ΅λ―Έν„°κ°€ μ κ³µν•λ” μ§€ν‘ μμ§‘μ„ `@AutoConfiguration` μ„ ν†µν•΄ μλ™μΌλ΅ λ“±λ΅ν•΄μ¤€λ‹¤.
- λ”°λΌμ„, μ¤ν”„λ§ λ¶€νΈ μ•΅μ¶”μ—μ΄ν„°λ¥Ό μ‚¬μ©ν•λ‹¤λ©΄, μ λ§μ€ λ©”νΈλ¦­(μ§€ν‘)λ“¤μ„ νΈλ¦¬ν•κ² μ‚¬μ©ν•  μ μλ‹¤.
- μ•΅μ¶”μ—μ΄ν„°μ `metrics` μ—”λ“ν¬μΈνΈλ¥Ό μ‚¬μ©ν•λ©΄ λ©”νΈλ¦­λ“¤μ„ ν™•μΈν•  μ μλ‹¤.
  - `http://localhost:8080/actuator/metrics`
 
## λ©”νΈλ¦­ μμ„Έν λ³΄κΈ°
- μ—”λ“ν¬μΈνΈμ—μ„ μ κ³µν•λ” λ§μ΄ν¬λ΅λ―Έν„°λ¥Ό μμ„Έν λ³΄λ ¤λ©΄ μ•„λ μ£Όμ†λ΅ μ ‘κ·Όν•λ‹¤.
  - http://localhost:8080/actuator/metrics/{name}
  - μλ¥Ό λ“¤μ–΄, jvmμ λ©”λ¨λ¦¬ μ‚¬μ©λ‰ λ©”νΈλ¦­μ„ μμ„Έν λ³΄κ³  μ‹¶λ‹¤λ©΄ μ•„λ μ£Όμ†λ¥Ό μ…λ ¥ν•λ‹¤.
  - `http://localhost:8080/actuator/metrics/jvm.memory.used`
- μ•„λ μ‚¬μ§„κ³Ό κ°™μ΄ JSON ν•μ‹μΌλ΅ λ©”νΈλ¦­ μ •λ³΄λ¥Ό ν™•μΈν•  μ μλ‹¤.

![image](https://github.com/shin-je-woo/TIL/assets/39439576/79a7ad49-8dbf-4b19-a110-4013cfd311a8)

### Tag ν•„ν„°
- μ„ μ‚¬μ§„μ availableTags λ¥Ό λ³΄λ©΄ λ‹¤μκ³Ό κ°™μ€ ν•­λ©μ„ ν™•μΈν•  μ μλ‹¤.
```
tag:area,
- values [heap, nonheap]

tag:id,
- values [G1 Survivor Space, ...]
```
- ν•΄λ‹Ή Tagλ¥Ό κΈ°λ°μΌλ΅ μ •λ³΄λ¥Ό ν•„ν„°λ§ν•΄μ„ ν™•μΈν•  μ μλ‹¤.
- μ΄λ• ν•μ‹μ€ `tag=KEY:VALUE` μ΄λ‹¤.
  - μλ¥Ό λ“¤λ©΄ λ‹¤μκ³Ό κ°™μ΄ μ…λ ¥ν•λ©΄ μ›ν•λ” μ •λ³΄κ°€ ν•„ν„°λ§ λλ‹¤.
  - http://localhost:8080/actuator/metrics/jvm.memory.used?tag=area:heap
  - http://localhost:8080/actuator/metrics/jvm.memory.used?tag=area:nonheap

# π’΅ λ‹¤μ–‘ν• λ©”νΈλ¦­
- μ¤ν”„λ§ λ¶€νΈλ” λ‹¤μκ³Ό κ°™μ€ μλ§μ€ λ©”νΈλ¦­ μ •λ³΄λ¥Ό μ κ³µν•λ‹¤.
  - [μ¤ν”„λ§λ¶€νΈκ°€ μ κ³µν•λ” λ©”νΈλ¦­](https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#actuator.metrics.supported)
 
## JVM λ©”νΈλ¦­
JVM κ΄€λ ¨ λ©”νΈλ¦­μ„ μ κ³µν•λ‹¤. jvm. μΌλ΅ μ‹μ‘ν•λ‹¤.
- λ©”λ¨λ¦¬ λ° λ²„νΌ ν’€ μ„Έλ¶€ μ •λ³΄
- κ°€λΉ„μ§€ μμ§‘ κ΄€λ ¨ ν†µκ³„
- μ¤λ λ“ ν™μ©
- λ΅λ“ λ° μ–Έλ΅λ“λ ν΄λμ¤ μ
- JVM λ²„μ „ μ •λ³΄
- JIT μ»΄νμΌ μ‹κ°„

## μ‹μ¤ν… λ©”νΈλ¦­
μ‹μ¤ν… λ©”νΈλ¦­μ„ μ κ³µν•λ‹¤. system. , process. , disk. μΌλ΅ μ‹μ‘ν•λ‹¤.
- CPU μ§€ν‘
- νμΌ λ””μ¤ν¬λ¦½ν„° λ©”νΈλ¦­
- κ°€λ™ μ‹κ°„ λ©”νΈλ¦­
- μ‚¬μ© κ°€λ¥ν• λ””μ¤ν¬ κ³µκ°„

## μ• ν”λ¦¬μΌ€μ΄μ… μ‹μ‘ λ©”νΈλ¦­
μ• ν”λ¦¬μΌ€μ΄μ… μ‹μ‘ μ‹κ°„ λ©”νΈλ¦­μ„ μ κ³µν•λ‹¤.
- application.started.time : μ• ν”λ¦¬μΌ€μ΄μ…μ„ μ‹μ‘ν•λ”λ° κ±Έλ¦¬λ” μ‹κ°„ ( ApplicationStartedEvent λ΅ μΈ΅μ •)
- application.ready.time : μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μ”μ²­μ„ μ²λ¦¬ν•  μ¤€λΉ„κ°€ λλ”λ° κ±Έλ¦¬λ” μ‹κ°„ ( ApplicationReadyEvent λ΅ μΈ΅μ •)
- μ¤ν”„λ§μ€ λ‚΄λ¶€μ— μ—¬λ¬ μ΄κΈ°ν™” λ‹¨κ³„κ°€ μκ³  κ° λ‹¨κ³„λ³„λ΅ λ‚΄λ¶€μ—μ„ μ• ν”λ¦¬μΌ€μ΄μ… μ΄λ²¤νΈλ¥Ό λ°ν–‰ν•λ‹¤.
- ApplicationStartedEvent : μ¤ν”„λ§ μ»¨ν…μ΄λ„κ°€ μ™„μ „ν μ‹¤ν–‰λ μƒνƒμ΄λ‹¤. μ΄ν›„μ— μ»¤λ§¨λ“ λΌμΈ λ¬λ„κ°€ νΈμ¶λλ‹¤.
- ApplicationReadyEvent : μ»¤λ§¨λ“ λΌμΈ λ¬λ„κ°€ μ‹¤ν–‰λ μ΄ν›„μ— νΈμ¶λλ‹¤.

## μ¤ν”„λ§ MVC λ©”νΈλ¦­
μ¤ν”„λ§ MVC μ»¨νΈλ΅¤λ¬κ°€ μ²λ¦¬ν•λ” λ¨λ“  μ”μ²­μ„ λ‹¤λ£¬λ‹¤. λ©”νΈλ¦­ μ΄λ¦„: http.server.requests   
TAG λ¥Ό μ‚¬μ©ν•΄μ„ λ‹¤μ μ •λ³΄λ¥Ό λ¶„λ¥ν•΄μ„ ν™•μΈν•  μ μλ‹¤.   
- uri : μ”μ²­ URI
- method : GET , POST κ°™μ€ HTTP λ©”μ„λ“
- status : 200 , 400 , 500 κ°™μ€ HTTP Status μ½”λ“
- exception : μμ™Έ
- outcome : μƒνƒμ½”λ“λ¥Ό κ·Έλ£ΉμΌλ΅ λ¨μ•„μ„ ν™•μΈ 1xx:INFORMATIONAL , 2xx:SUCCESS , 3xx:REDIRECTION , 4xx:CLIENT_ERROR , 5xx:SERVER_ERROR

## λ°μ΄ν„°μ†μ¤ λ©”νΈλ¦­
DataSource , μ»¤λ„¥μ… ν’€μ— κ΄€ν• λ©”νΈλ¦­μ„ ν™•μΈν•  μ μλ‹¤. jdbc.connections. μΌλ΅ μ‹μ‘ν•λ‹¤.   
μµλ€ μ»¤λ„¥μ…, μµμ† μ»¤λ„¥μ…, ν™μ„± μ»¤λ„¥μ…, λ€κΈ° μ»¤λ„¥μ… μ λ“±μ„ ν™•μΈν•  μ μλ‹¤.   
νμΉ΄λ¦¬ μ»¤λ„¥μ… ν’€μ„ μ‚¬μ©ν•λ©΄ hikaricp. λ¥Ό ν†µν•΄ νμΉ΄λ¦¬ μ»¤λ„¥μ… ν’€μ μμ„Έν• λ©”νΈλ¦­μ„ ν™•μΈν•  μ μλ‹¤.

## λ΅κ·Έ λ©”νΈλ¦­
logback.events : logback λ΅κ·Έμ— λ€ν• λ©”νΈλ¦­μ„ ν™•μΈν•  μ μλ‹¤.   
trace , debug , info , warn , error κ°κ°μ λ΅κ·Έ λ λ²¨μ— λ”°λ¥Έ λ΅κ·Έ μλ¥Ό ν™•μΈν•  μ μλ‹¤.   
μλ¥Ό λ“¤μ–΄μ„ error λ΅κ·Έ μκ°€ κΈ‰κ²©ν λ†’μ•„μ§„λ‹¤λ©΄ μ„ν—ν• μ‹ νΈμΈ κ²ƒμ„ μ• μ μλ‹¤.

## ν†°μΊ£ λ©”νΈλ¦­
ν†°μΊ£ λ©”νΈλ¦­μ€ tomcat. μΌλ΅ μ‹μ‘ν•λ‹¤.   
ν†°μΊ£μ μµλ€ μ“°λ λ“, μ‚¬μ© μ“°λ λ“ μλ¥Ό ν¬ν•¨ν• λ‹¤μ–‘ν• λ©”νΈλ¦­μ„ ν™•μΈν•  μ μλ‹¤.   
ν†°μΊ£ λ©”νΈλ¦­μ„ λ¨λ‘ μ‚¬μ©ν•λ ¤λ©΄ λ‹¤μ μµμ…μ„ μΌμ•Όν•λ‹¤. (μµμ…μ„ μΌμ§€ μ•μΌλ©΄ tomcat.session. κ΄€λ ¨ μ •λ³΄λ§ λ…Έμ¶λλ‹¤.)   
```yml
server:
  tomcat:
    mbeanregistry:
      enabled: true
```

## μ‚¬μ©μ μ •μ λ©”νΈλ¦­
μ‚¬μ©μκ°€ μ§μ ‘ λ©”νΈλ¦­μ„ μ •μν•  μλ„ μλ‹¤.   
μλ¥Ό λ“¤μ–΄μ„ μ£Όλ¬Έμ, μ·¨μ†μλ¥Ό λ©”νΈλ¦­μΌλ΅ λ§λ“¤ μ μλ‹¤.   
