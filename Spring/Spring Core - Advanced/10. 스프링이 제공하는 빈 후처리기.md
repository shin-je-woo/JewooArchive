# π’΅ μ¤ν”„λ§ μ κ³µ λΉ ν›„μ²λ¦¬κΈ°
## μμ΅΄μ„± μ¶”κ°€
```
implementation 'org.springframework.boot:spring-boot-starter-aop'
```
-  λΌμ΄λΈλ¬λ¦¬λ¥Ό μ¶”κ°€ν•λ©΄ `aspectjweaver` λΌλ” `aspectJ` κ΄€λ ¨ λΌμ΄λΈλ¬λ¦¬λ¥Ό λ“±λ΅ν•λ‹¤.
-  μ¤ν”„λ§ λ¶€νΈκ°€ AOP κ΄€λ ¨ ν΄λμ¤λ¥Ό μλ™μΌλ΅ μ¤ν”„λ§ λΉμ— λ“±λ΅ν•λ‹¤.

## μλ™ ν”„λ΅μ‹ μƒμ„±κΈ° - AutoProxyCreator
- μ„μ μ„¤μ •μ„ μ¶”κ°€ν•λ©΄ `AnnotationAwareAspectJAutoProxyCreator` λΌλ” λΉ ν›„μ²λ¦¬κΈ°κ°€ μ¤ν”„λ§ λΉμ— μλ™μΌλ΅ λ“±λ΅λλ‹¤.
- μ΄λ¦„ κ·Έλ€λ΅ μλ™μΌλ΅ ν”„λ΅μ‹λ¥Ό μƒμ„±ν•΄μ£Όλ” λΉ ν›„μ²λ¦¬κΈ°μ΄λ‹¤.
- ν•΄λ‹Ή λΉ ν›„μ²λ¦¬κΈ°λ” μ¤ν”„λ§ λΉμΌλ΅ λ“±λ΅λ `Advisor` λ“¤μ„ μ°Ύμ•„μ„ ν•„μ”ν• κ³³μ— ν”„λ΅μ‹λ¥Ό μ μ©ν•΄μ¤€λ‹¤.
- `Advisor` λ§ μ•κ³  μμΌλ©΄ `Pointcut` μΌλ΅ μ–΄λ–¤ μ¤ν”„λ§ λΉμ— ν”„λ΅μ‹λ¥Ό μ μ©ν•΄μ•Ό ν• μ§€ μ• μ μλ‹¤. κ·Έλ¦¬κ³  `Advice` λ΅ λ¶€κ°€ κΈ°λ¥μ„ μ μ©ν•λ©΄ λλ‹¤.
- λ”°λΌμ„, κ°λ°μλ” `Advisor` λ§ μ¤ν”„λ§ λΉμΌλ΅ λ“±λ΅ν•λ©΄ `AnnotationAwareAspectJAutoProxyCreator` κ°€ μλ™μΌλ΅ ν”„λ΅μ‹λ¥Ό λ“±λ΅ν•΄μ¤€λ‹¤.

```java
@Configuration
@Import({AppV1Config.class, AppV2Config.class})
public class AutoProxyConfig {

    @Bean
    public Advisor advisor1(LogTrace logTrace) {
        // pointcut
        NameMatchMethodPointcut pointcut = new NameMatchMethodPointcut();
        pointcut.setMappedNames("request*", "order*", "save*");
        // advice
        LogTraceAdvice advice = new LogTraceAdvice(logTrace);
        return new DefaultPointcutAdvisor(pointcut, advice);
    }
}
```
- μ„ μ½”λ“μ™€ κ°™μ΄ `Advisor` λ§ μ¤ν”„λ§ λΉμΌλ΅ λ“±λ΅ν•΄μ£Όλ©΄ ν¬μΈνΈμ»· λ€μƒμ— ν”„λ΅μ‹κ°€ μ μ©λλ‹¤.

> π“ μ°Έκ³    
> `AnnotationAwareAspectJAutoProxyCreator` λ” `@AspectJ` μ™€ κ΄€λ ¨λ AOP κΈ°λ¥λ„ μλ™μΌλ΅ μ°Ύμ•„μ„ μ²λ¦¬ν•΄μ¤€λ‹¤.   
> `Advisor` λ” λ¬Όλ΅ μ΄κ³ , `@Aspect` λ„ μλ™μΌλ΅ μΈμ‹ν•΄μ„ ν”„λ΅μ‹λ¥Ό λ§λ“¤κ³  AOPλ¥Ό μ μ©ν•΄μ¤€λ‹¤.

## μλ™ ν”„λ΅μ‹ μƒμ„±κΈ° μ‘λ™ κ³Όμ •
![image](https://github.com/shin-je-woo/TIL/assets/39439576/2602757e-dfdd-4f91-9604-d99bfdbf50a8)
1. μƒμ„± : μ¤ν”„λ§μ΄ μ¤ν”„λ§ λΉ κ°μ²΄λ¥Ό μƒμ„±ν•λ‹¤. ( @Bean , μ»΄ν¬λ„νΈ μ¤μΊ” λ¨λ‘ ν¬ν•¨ )
2. μ „λ‹¬ : μƒμ„±λ κ°μ²΄λ¥Ό λΉ μ €μ¥μ†μ— λ“±λ΅ν•κΈ° μ „μ— λΉ ν›„μ²λ¦¬κΈ°μ— μ „λ‹¬ν•λ‹¤.
3. λ¨λ“  Advisor λΉ μ΅°ν : μλ™ ν”„λ΅μ‹ μƒμ„±κΈ°(λΉ ν›„μ²λ¦¬κΈ°)λ” μ¤ν”„λ§ μ»¨ν…μ΄λ„μ—μ„ λ¨λ“  `Advisor` λ¥Ό μ΅°νν•λ‹¤.
4. ν”„λ΅μ‹ μ μ© λ€μƒ μ²΄ν¬ : `Advisor` μ— ν¬ν•¨λμ–΄ μλ” ν¬μΈνΈμ»·μΌλ΅ ν•΄λ‹Ή κ°μ²΄κ°€ ν”„λ΅μ‹ μ μ©λ€μƒμΈμ§€ ν™•μΈν•λ‹¤. κ°μ²΄μ ν΄λμ¤ μ •λ³΄, λ¨λ“  λ©”μ„λ“λ¥Ό ν¬μΈνΈμ»·μ— ν•λ‚ν•λ‚ λ¨λ‘ λ§¤μΉ­ν•΄λ³Έλ‹¤. ν¬μΈνΈμ»· μ΅°κ±΄μ„ ν•λ‚λΌλ„ λ§μ΅±ν•λ©΄ ν”„λ΅μ‹ μ μ© λ€μƒμ΄
λλ‹¤. μλ¥Ό λ“¤μ–΄μ„ 10κ°μ λ©”μ„λ“ μ¤‘μ— ν•λ‚λ§ ν¬μΈνΈμ»· μ΅°κ±΄μ— λ§μ΅±ν•΄λ„ ν”„λ΅μ‹ μ μ© λ€μƒμ΄ λλ‹¤.
5. ν”„λ΅μ‹ μƒμ„± : ν”„λ΅μ‹ μ μ© λ€μƒμ΄λ©΄ ν”„λ΅μ‹ν©ν† λ¦¬λ΅ ν”„λ΅μ‹λ¥Ό μƒμ„±ν•κ³  λ°ν™ν•λ‹¤. μ•„λ‹λΌλ©΄ μ›λ³Έ λΉμ„ λ°ν™ν•λ‹¤.
6. λΉ λ“±λ΅ : λ°ν™λ κ°μ²΄λ” μ¤ν”„λ§ λΉμΌλ΅ λ“±λ΅λλ‹¤.

![image](https://github.com/shin-je-woo/TIL/assets/39439576/5ed06dfc-94d0-40cf-b474-9d94baaa9155)
- ν”„λ΅μ‹λ” λ‚΄λ¶€μ— μ–΄λ“λ°”μ΄μ €μ™€ μ‹¤μ  νΈμ¶ν•΄μ•Όν•  λ€μƒ κ°μ²΄( target )λ¥Ό μ•κ³  μλ‹¤.

## μ¤‘μ”: ν¬μΈνΈμ»·μ΄ μ‚¬μ©λλ” λ¶€λ¶„
**1. ν”„λ΅μ‹ μ μ© μ—¬λ¶€ νλ‹¨ - μƒμ„± λ‹¨κ³„**
- μλ™ ν”„λ΅μ‹ μƒμ„±κΈ°λ” ν¬μΈνΈμ»·μ„ μ‚¬μ©ν•΄μ„ ν•΄λ‹Ή λΉμ΄ ν”„λ΅μ‹λ¥Ό μƒμ„±ν•΄μ•Ό ν•λ”μ§€ μ²΄ν¬ν•λ‹¤.
- ν΄λμ¤ + λ©”μ„λ“ μ΅°κ±΄μ„ λ¨λ‘ λΉ„κµν•λ‹¤. λ§μ•½ ν•λ‚λΌλ„ μ΅°κ±΄μ— λ§μΌλ©΄ ν”„λ΅μ‹λ¥Ό μƒμ„±ν•λ‹¤.

**2. μ–΄λ“λ°”μ΄μ¤ μ μ© μ—¬λ¶€ νλ‹¨ - μ‚¬μ© λ‹¨κ³„**
- ν”„λ΅μ‹κ°€ νΈμ¶λμ—μ„ λ• ν¬μΈνΈμ»·μ„ ν™•μΈν•΄μ„ μ–΄λ“λ°”μ΄μ¤λ¥Ό μ μ©ν•΄μ•Ό ν•λ”μ§€ νλ‹¨ν•λ‹¤.
- μλ¥Ό λ“¤μ–΄, 1λ‹¨κ³„ μ΅°κ±΄μ— λ¶€ν•©ν•΄μ„ ν”„λ΅μ‹ κ°μ²΄λ΅ μƒμ„±λμ—λ”λΌλ„ λ©”μ„λ“ νΈμ¶μ‹ ν¬μΈνΈμ»· μ΅°κ±΄μ— λ§μ§€ μ•μΌλ©΄ μ›λ³Έμ λ©”μ„λ“λ¥Ό λ°”λ΅ νΈμ¶ν•κ³ , ν¬μΈνΈμ»·μ— λ¶€ν•©ν•λ” λ©”μ„λ“λΌλ©΄ μ–΄λ“λ°”μ΄μ¤λ¥Ό μ μ©ν•λ‹¤.

## AspectJExpressionPointcut
- ν¬μΈνΈμ»·μ„ ν†µν•΄ ν”„λ΅μ‹ μ μ©μ—¬λ¶€, μ–΄λ“λ°”μ΄μ¤ μ μ©μ—¬λ¶€λ¥Ό νλ‹¨ν•λ‹¤κ³  ν–λ‹¤.
- μ—‰λ±ν• λΉμ΄ ν”„λ΅μ‹λ΅ λ“±λ΅λλ” κ²ƒμ„ λ°©μ§€ν•λ ¤λ©΄ λ” μ •κµν• ν¬μΈνΈμ»· μ μ©λ°©λ²•μ΄ ν•„μ”ν•λ‹¤.
- `AspectJExpressionPointcut` μ„ μ‚¬μ©ν•λ©΄ AspectJ λΌλ” AOPμ— νΉν™”λ ν¬μΈνΈμ»· ν‘ν„μ‹μ„ μ μ©ν•  μ μλ‹¤.

```java
@Bean
public Advisor advisor3(LogTrace logTrace) {
    // pointcut
    AspectJExpressionPointcut pointcut = new AspectJExpressionPointcut();
    pointcut.setExpression("execution(* com.study.advanced.proxy.app..*(..)) && !execution(* com.study.advanced.proxy.app..noLog(..))");
    // advice
    LogTraceAdvice advice = new LogTraceAdvice(logTrace);
    return new DefaultPointcutAdvisor(pointcut, advice);
}
```

# π’΅ ν•λ‚μ ν”„λ΅μ‹, μ—¬λ¬ Advisor μ μ©
- ν•λ‚μ μ¤ν”„λ§ λΉμ΄ μ—¬λ¬ κ°μ Advisorκ°€ μ κ³µν•λ” ν¬μΈνΈμ»·μ„ λ¨λ‘ λ§μ΅±ν•λ©΄ ν”„λ΅μ‹κ°€ μ—¬λ¬κ° μƒμ„±λ κΉ?
- No! ν”„λ΅μ‹ μλ™ μƒμ„±κΈ°λ” ν”„λ΅μ‹λ¥Ό ν•λ‚λ§ μƒμ„±ν•λ‹¤.
- μ™λƒν•λ©΄ ν”„λ΅μ‹ ν©ν† λ¦¬κ°€ μƒμ„±ν•λ” ν”„λ΅μ‹λ” λ‚΄λ¶€μ— μ—¬λ¬ Advisorλ“¤μ„ ν¬ν•¨ν•  μ μκΈ° λ•λ¬Έμ΄λ‹¤.
- μ¦‰, ν”„λ΅μ‹κ°μ²΄λ” 1κ°, Advisorλ” μ—¬λ¬κ° λ“±λ΅λλ” μ μ— μ μν•μ.
- μ΄ν›„μ— μ„¤λ…ν•  μ¤ν”„λ§ AOPλ„ λ™μΌν• λ°©μ‹μΌλ΅ λ™μ‘ν•λ‹¤.

![image](https://github.com/shin-je-woo/TIL/assets/39439576/48581daa-7983-431d-a7a8-3a7acb34beb2)

