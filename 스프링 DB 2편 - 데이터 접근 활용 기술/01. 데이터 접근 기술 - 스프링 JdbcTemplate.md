# ğŸ’¡ JdbcTemplate ì†Œê°œ
* SQLì„ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì— ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” `JdbcTemplate` ì€ ì•„ì£¼ ì¢‹ì€ ì„ íƒì§€ë‹¤. 
* `JdbcTemplate` ì€ JDBCë¥¼ ë§¤ìš° í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë„ì™€ì¤€ë‹¤.

### ì¥ì 
âœ… ì„¤ì •ì˜ í¸ë¦¬í•¨
* JdbcTemplateì€ `spring-jdbc` ë¼ì´ë¸ŒëŸ¬ë¦¬ì— í¬í•¨ë˜ì–´ ìˆë‹¤. (ìŠ¤í”„ë§ìœ¼ë¡œ JDBCë¥¼ ì‚¬ìš©í•  ë•Œ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬)
* ë³„ë„ì˜ ë³µì¡í•œ ì„¤ì • ì—†ì´ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.

âœ… ë°˜ë³µ ë¬¸ì œ í•´ê²°
* JdbcTemplateì€ í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ì„ ì‚¬ìš©í•´ì„œ JDBCë¥¼ ì§ì ‘ ì‚¬ìš©í•  ë•Œ ë°œìƒí•˜ëŠ” ëŒ€ë¶€ë¶„ì˜ ë°˜ë³µ ì‘ì—…ì„ ëŒ€ì‹  ì²˜ë¦¬í•´ì¤€ë‹¤.
* ê°œë°œìëŠ” SQL ì‘ì„±, ì „ë‹¬í•  íŒŒë¦¬ë¯¸í„° ì •ì˜, ì‘ë‹µ ê°’ ë§¤í•‘ë§Œ í•˜ë©´ ëœë‹¤.
* ë‹¤ìŒê³¼ ê°™ì€ ëŒ€ë¶€ë¶„ì˜ ë°˜ë³µ ì‘ì—…ì„ ëŒ€ì‹  ì²˜ë¦¬í•´ì¤€ë‹¤.
  * `Connection` íšë“
  * `Statement` ë¥¼ ì¤€ë¹„í•˜ê³  ì‹¤í–‰
  * ê²°ê³¼(`ResultSet`)ë¥¼ ë°˜ë³µí•˜ë„ë¡ ë£¨í”„ë¥¼ ì‹¤í–‰
  * `Connection` , `Statement` , `Resultset` ì¢…ë£Œ
  * íŠ¸ëœì­ì…˜ì„ ë‹¤ë£¨ê¸° ìœ„í•œ ì»¤ë„¥ì…˜ ë™ê¸°í™”
  * ì˜ˆì™¸ ë°œìƒì‹œ ìŠ¤í”„ë§ ì˜ˆì™¸ ë³€í™˜ê¸° ì‹¤í–‰

### ë‹¨ì 
* ë™ì  SQLì„ í•´ê²°í•˜ê¸° ì–´ë µë‹¤.

# ğŸ’¡ JdbcTemplate ì ìš©
```java
@Slf4j
public class JdbcTemplateItemRepositoryV1 implements ItemRepository {

    private final JdbcTemplate template;

    // ìƒì„±ì - JdbcTemplateì€ DataSourceê°€ í•„ìš”í•˜ë‹¤.
    public JdbcTemplateItemRepositoryV1(DataSource dataSource) {
        this.template = new JdbcTemplate(dataSource);
    }
    
    @Override
    public Item save(Item item) {
        String sql = "insert into item (item_name, price, quantity) values (?,?,?)";
        KeyHolder keyHolder = new GeneratedKeyHolder();
        // ë°ì´í„°ë¥¼ ë³€ê²½í•  ë•ŒëŠ” update() ë¥¼ ì‚¬ìš©
        template.update(connection -> {
            // ìë™ ì¦ê°€ í‚¤ - ë°ì´í„°ë² ì´ìŠ¤ê°€ PKì¸ IDë¥¼ ëŒ€ì‹  ìƒì„±
            PreparedStatement ps = connection.prepareStatement(sql, new String[]{"id"});
            ps.setString(1, item.getItemName());
            ps.setInt(2, item.getPrice());
            ps.setInt(3, item.getQuantity());
            return ps;
        }, keyHolder);

        long key = Objects.requireNonNull(keyHolder.getKey()).longValue();
        item.setId(key);

        return item;
    }
    ...
    private RowMapper<Item> itemRowMapper() {
        return ((rs, rowNum) -> {
            Item item = new Item();
            item.setId(rs.getLong("id"));
            item.setItemName(rs.getString("item_name"));
            item.setPrice(rs.getInt("price"));
            item.setQuantity(rs.getInt("quantity"));
            return item;
        });
    }
}
```
### template.update()
* ë°ì´í„°ë¥¼ ë³€ê²½í•  ë•Œ ì‚¬ìš©í•œë‹¤.
* INSERT, UPDATE, DELETE SQLì— ì‚¬ìš©í•œë‹¤.
* template.update() ì˜ ë°˜í™˜ ê°’ì€ int ì¸ë°, ì˜í–¥ ë°›ì€ ë¡œìš° ìˆ˜ë¥¼ ë°˜í™˜í•œë‹¤.

### template.queryForObject()
* ê²°ê³¼ê°€ í•˜ë‚˜ì¼ ë•Œ ì‚¬ìš©í•œë‹¤.
* `RowMapper` ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°˜í™˜ ê²°ê³¼ì¸ `ResultSet` ì„ ê°ì²´ë¡œ ë³€í™˜í•œë‹¤.

### template.query()
* ê²°ê³¼ê°€ í•˜ë‚˜ ì´ìƒì¼ ë•Œ ì‚¬ìš©í•œë‹¤.
* ë§ˆì°¬ê°€ì§€ë¡œ `RowMapper` ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°˜í™˜ ê²°ê³¼ì¸ `ResultSet` ì„ ê°ì²´ë¡œ ë³€í™˜í•œë‹¤.

### RowMapper
* ë°ì´í„°ë² ì´ìŠ¤ì˜ ì¡°íšŒ ê²°ê³¼ë¥¼ ê°ì²´ë¡œ ë³€í™˜í•  ë•Œ ì‚¬ìš©í•œë‹¤.
* JDBCë¥¼ ì§ì ‘ ì‚¬ìš©í•  ë•Œ `ResultSet`  ì‚¬ìš©í–ˆë˜ ë¶€ë¶„ì„ ë– ì˜¬ë¦¬ë©´ ëœë‹¤.
* ì°¨ì´ê°€ ìˆë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ JdbcTemplateì´ ë£¨í”„ë¥¼ ëŒë ¤ì£¼ê³ , ê°œë°œìëŠ” `RowMapper` ë¥¼ êµ¬í˜„í•´ì„œ ê·¸ ë‚´ë¶€ ì½”ë“œë§Œ ì±„ìš´ë‹¤ê³  ì´í•´í•˜ë©´ ëœë‹¤.

## ë™ì  ì¿¼ë¦¬ ë¬¸ì œ
* ê²°ê³¼ë¥¼ ê²€ìƒ‰í•˜ëŠ” `findAll()` ì—ì„œ ì–´ë ¤ìš´ ë¶€ë¶„ì€ ì‚¬ìš©ìê°€ ê²€ìƒ‰í•˜ëŠ” ê°’ì— ë”°ë¼ì„œ ì‹¤í–‰í•˜ëŠ” SQLì´ ë™ì ìœ¼ë¡œ ë‹¬ë ¤ì ¸ì•¼ í•œë‹¤ëŠ” ì ì´ë‹¤.
* ìƒí’ˆëª…(itemName)ê³¼ ìµœëŒ€ ê°€ê²©(maxPrice) ì„ ê³ ë ¤í•´ ê²€ìƒ‰í•  ê²½ìš°, ì‚¬ìš© ì—¬ë¶€ì— ë”°ë¼ 4ê°€ì§€ ê²½ìš°ê°€ ìƒê¸´ë‹¤.
```sql
select id, item_name, price, quantity from item
	where item_name like concat('%',?,'%')
	and price <= ?
```
* ì‹¤ë¬´ì—ì„œëŠ” ì´ë³´ë‹¤ í›¨ì”¬ ë” ë³µì¡í•œ ë™ì  ì¿¼ë¦¬ë“¤ì´ ì‚¬ìš©ëœë‹¤.
* ì°¸ê³ ë¡œ ì´í›„ì— ì„¤ëª…í•  MyBatisì˜ ê°€ì¥ í° ì¥ì ì€ SQLì„ ì§ì ‘ ì‚¬ìš©í•  ë•Œ ë™ì  ì¿¼ë¦¬ë¥¼ ì‰½ê²Œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤.

# ğŸ’¡ JdbcTemplate - ì´ë¦„ ì§€ì • íŒŒë¼ë¯¸í„°
* ìœ„ì—ì„œ ë³¸ ê¸°ë³¸ ì½”ë“œëŠ” íŒŒë¼ë¯¸í„°ë¥¼ ìˆœì„œëŒ€ë¡œ ì‘ì„±í•´ì•¼ í•œë‹¤.
* í•„ë“œìˆœì„œë§Œ ë°”ê¾¸ê³  ë§¤í•‘ ìˆœì„œëŠ” ì•ˆë°”ê¿€ ê²½ìš° ì‹¬ê°í•œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤. 
* ì´ëŸ° ë¬¸ì œë¥¼ ë³´ì™„í•˜ê¸° ìœ„í•´ `NamedParameterJdbcTemplate` ë¼ëŠ” ì´ë¦„ì„ ì§€ì •í•´ì„œ íŒŒë¼ë¯¸í„°ë¥¼ ë°”ì¸ë”© í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
```java
@Slf4j
public class JdbcTemplateItemRepositoryV2 implements ItemRepository {

    private final NamedParameterJdbcTemplate template;

    public JdbcTemplateItemRepositoryV2(DataSource dataSource) {
        this.template = new NamedParameterJdbcTemplate(dataSource);
    }

    @Override
    public Item save(Item item) {
        String sql = "insert into item (item_name, price, quantity) " +
                "values (:itemName, :price, :quantity)"; // ? ëŒ€ì‹  :íŒŒë¼ë¯¸í„°ì´ë¦„

        SqlParameterSource param = new BeanPropertySqlParameterSource(item);

        KeyHolder keyHolder = new GeneratedKeyHolder();
        template.update(sql, param, keyHolder);

        long key = Objects.requireNonNull(keyHolder.getKey()).longValue();
        item.setId(key);
        return item;
    }
    ...
    private RowMapper<Item> itemRowMapper() {
        return BeanPropertyRowMapper.newInstance(Item.class); // camel ë³€í™˜ ì§€ì›
    }
}
```
* íŒŒë¼ë¯¸í„°ë¥¼ ì „ë‹¬í•˜ë ¤ë©´ `Map` ì²˜ëŸ¼ `key` , `value` ë°ì´í„° êµ¬ì¡°ë¥¼ ë§Œë“¤ì–´ì„œ ì „ë‹¬í•´ì•¼ í•œë‹¤.
* ì—¬ê¸°ì„œ `key` ëŠ” :íŒŒë¼ë¯¸í„°ì´ë¦„ì´ê³  , `value` ëŠ” í•´ë‹¹ íŒŒë¼ë¯¸í„°ì˜ ê°’ì´ ëœë‹¤.

##  ëŒ€í‘œì ì¸ ì´ë¦„ ì§€ì • íŒŒë¼ë¯¸í„° 3ê°€ì§€
* ë‹¨ìˆœ Map
* SqlParameterSource (ì¸í„°í˜ì´ìŠ¤)
	* MapSqlParameterSource
	* BeanPropertySqlParameterSource

```java
// ë‹¨ìˆœ Map
Map<String, Object> param = Map.of("id", id);

// MapSqlParameterSource - Map ê³¼ ìœ ì‚¬í•œë°, SQL íƒ€ì…ì„ ì§€ì •í•  ìˆ˜ ìˆëŠ” ë“± SQLì— ì¢€ ë” íŠ¹í™”ëœ ê¸°ëŠ¥ì„ ì œê³µ
SqlParameterSource param = new MapSqlParameterSource()
 	.addValue("itemName", updateParam.getItemName())
	.addValue("price", updateParam.getPrice());
 
// BeanPropertySqlParameterSource - ìë°” ë¹ˆ í”„ë¡œí¼í‹° ê·œì•½ì„ í†µí•´ì„œ ìë™ìœ¼ë¡œ íŒŒë¼ë¯¸í„° ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
//ì˜ˆ) (`getXxx()` -> xxx, `getItemName()` -> itemName)
SqlParameterSource param = new BeanPropertySqlParameterSource(item);
```

## BeanPropertyRowMapper
* `BeanPropertyRowMapper` ëŠ” `ResultSet` ì˜ ê²°ê³¼ë¥¼ ë°›ì•„ì„œ ìë°”ë¹ˆ ê·œì•½ì— ë§ì¶”ì–´ ë°ì´í„°ë¥¼ ë³€í™˜í•œë‹¤.
* ì˜ˆë¥¼ ë“¤ì–´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•œ ê²°ê³¼ê°€ `select id, price` ë¼ê³  í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¥¼ ì‘ì„±í•´ì¤€ë‹¤. (ì‹¤ì œë¡œëŠ” ë¦¬í”Œë ‰ì…˜ ê°™ì€ ê¸°ëŠ¥ì„ ì‚¬ìš©í•œë‹¤.)
```java
Item item = new Item();
item.setId(rs.getLong("id"));
item.setPrice(rs.getInt("price"));
```
* ë˜í•œ, ì–¸ë”ìŠ¤ì½”ì–´ í‘œê¸°ë²•(item_name)ì„ ì¹´ë©œ(itemName)ë¡œ ìë™ ë³€í™˜í•´ì¤€ë‹¤.

# ğŸ’¡ JdbcTemplate - SimpleJdbcInsert
* JdbcTemplateì€ INSERT SQLë¥¼ ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” `SimpleJdbcInsert` ë¼ëŠ” í¸ë¦¬í•œ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
```java
@Slf4j
public class JdbcTemplateItemRepositoryV3 implements ItemRepository {

    private final NamedParameterJdbcTemplate template;
    private final SimpleJdbcInsert jdbcInsert;

    public JdbcTemplateItemRepositoryV3(DataSource dataSource) {
        this.template = new NamedParameterJdbcTemplate(dataSource);
        this.jdbcInsert = new SimpleJdbcInsert(dataSource)
                .withTableName("item")
                .usingGeneratedKeyColumns("id");
//                .usingColumns("item_name", "price", "quantity") // INSERT SQLì— ì‚¬ìš©í•  ì»¬ëŸ¼ì„ ì§€ì • - ìƒëµ ê°€ëŠ¥
    }

    @Override
    public Item save(Item item) {
        SqlParameterSource param = new BeanPropertySqlParameterSource(item);
        // INSERT SQLì„ ì‹¤í–‰í•˜ê³ , ìƒì„±ëœ í‚¤ ê°’ë„ í¸ë¦¬í•˜ê²Œ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤
        Number key = jdbcInsert.executeAndReturnKey(param);
        item.setId(key.longValue());
        return item;
    }
    ...
}
```
* `withTableName` : ë°ì´í„°ë¥¼ ì €ì¥í•  í…Œì´ë¸” ëª…ì„ ì§€ì •í•œë‹¤.
* `usingGeneratedKeyColumns` : key ë¥¼ ìƒì„±í•˜ëŠ” PK ì»¬ëŸ¼ ëª…ì„ ì§€ì •í•œë‹¤.
* `usingColumns` : INSERT SQLì— ì‚¬ìš©í•  ì»¬ëŸ¼ì„ ì§€ì •í•œë‹¤. íŠ¹ì • ê°’ë§Œ ì €ì¥í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•œë‹¤. ìƒëµí•  ìˆ˜ ìˆë‹¤.
* `SimpleJdbcInsert` ëŠ” ìƒì„± ì‹œì ì— ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì˜ ë©”íƒ€ ë°ì´í„°ë¥¼ ì¡°íšŒí•œë‹¤. 
* ë”°ë¼ì„œ ì–´ë–¤ ì»¬ëŸ¼ì´ ìˆëŠ”ì§€ í™•ì¸ í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ `usingColumns` ì„ ìƒëµí•  ìˆ˜ ìˆë‹¤. 
* ë§Œì•½ íŠ¹ì • ì»¬ëŸ¼ë§Œ ì§€ì •í•´ì„œ ì €ì¥í•˜ê³  ì‹¶ë‹¤ë©´ `usingColumns` ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

# ğŸ’¡ JdbcTemplate ê¸°ëŠ¥ ì •ë¦¬
* `JdbcTemplate` : ìˆœì„œ ê¸°ë°˜ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ì„ ì§€ì›í•œë‹¤.
* `NamedParameterJdbcTemplate` : ì´ë¦„ ê¸°ë°˜ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ì„ ì§€ì›í•œë‹¤. (ê¶Œì¥)
* `SimpleJdbcInsert` : INSERT SQLì„ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
* `SimpleJdbcCall` : ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €ë¥¼ í¸ë¦¬í•˜ê²Œ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤.

## ì¡°íšŒ
* ë‹¨ê±´ ì¡°íšŒ : `queryForObject()`
* ëª©ë¡ ì¡°íšŒ : `query()` - 
* ê²°ê³¼ ë§¤í•‘ : `RowMapper`

### ë³€ê²½(INSERT, UPDATE, DELETE)
* ë°ì´í„° ë³€ê²½ : `update()`
* í¸ë¦¬í•œ INSERT : `SimpleJdbcInsert`

## ì •ë¦¬
* ê°€ì¥ ê°„ë‹¨í•˜ê³  ì‹¤ìš©ì ì¸ ë°©ë²•ìœ¼ë¡œ SQLì„ ì‚¬ìš©í•˜ë ¤ë©´ JdbcTemplateì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
* JPAì™€ ê°™ì€ ORM ê¸°ìˆ ì„ ì‚¬ìš©í•˜ë©´ì„œ ë™ì‹œì— SQLì„ ì§ì ‘ ì‘ì„±í•´ì•¼ í•  ë•Œê°€ ìˆëŠ”ë°, ê·¸ë•Œë„ JdbcTemplateì„ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
* ê·¸ëŸ°ë°, JdbcTemplateì€ ë™ì  ì¿¼ë¦¬ ë¬¸ì œë¥¼ í•´ê²°í•˜ì§€ ëª»í•œë‹¤.(ìµœëŒ€ ë‹¨ì )
* SQLì„ ìë°” ì½”ë“œë¡œ ì‘ì„±í•˜ê¸° ë•Œë¬¸ì— SQL ë¼ì¸ì´ ì½”ë“œë¥¼ ë„˜ì–´ê°ˆ ë•Œ ë§ˆë‹¤ ë¬¸ì ë”í•˜ê¸°ë¥¼ í•´ì£¼ì–´ì•¼ í•˜ëŠ” ë‹¨ì ë„ ìˆë‹¤.
* ë™ì  ì¿¼ë¦¬ ë¬¸ì œë¥¼ í•´ê²°í•˜ë©´ì„œ ë™ì‹œì— SQLë„ í¸ë¦¬í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” ê¸°ìˆ ì´ ë°”ë¡œ MyBatis ì´ë‹¤.
