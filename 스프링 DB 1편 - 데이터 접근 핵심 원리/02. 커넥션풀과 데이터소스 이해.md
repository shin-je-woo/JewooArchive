# ğŸ’¡ ì»¤ë„¥ì…˜ í’€ ì´í•´
## ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ íšë“ ê³¼ì •
![image](https://github.com/shin-je-woo/TIL/assets/39439576/e974b404-78ab-4cfc-8297-5390fce23e1f)
1. ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì€ DB ë“œë¼ì´ë²„ë¥¼ í†µí•´ ì»¤ë„¥ì…˜ì„ ì¡°íšŒí•œë‹¤.
2. DB ë“œë¼ì´ë²„ëŠ” DBì™€ `TCP/IP` ì»¤ë„¥ì…˜ì„ ì—°ê²°í•œë‹¤. ì´ ê³¼ì •ì—ì„œ 3 way handshake ê°™ì€ TCP/IP ì—°ê²°ì„ ìœ„í•œ ë„¤íŠ¸ì›Œí¬ ë™ì‘ì´ ë°œìƒí•œë‹¤.
3. DB ë“œë¼ì´ë²„ëŠ” TCP/IP ì»¤ë„¥ì…˜ì´ ì—°ê²°ë˜ë©´ ID, PWì™€ ê¸°íƒ€ ë¶€ê°€ì •ë³´ë¥¼ DBì— ì „ë‹¬í•œë‹¤.
4. DBëŠ” ID, PWë¥¼ í†µí•´ ë‚´ë¶€ ì¸ì¦ì„ ì™„ë£Œí•˜ê³ , ë‚´ë¶€ì— `DB ì„¸ì…˜`ì„ ìƒì„±í•œë‹¤.
5. DBëŠ” ì»¤ë„¥ì…˜ ìƒì„±ì´ ì™„ë£Œë˜ì—ˆë‹¤ëŠ” ì‘ë‹µì„ ë³´ë‚¸ë‹¤.
6. DB ë“œë¼ì´ë²„ëŠ” ì»¤ë„¥ì…˜ ê°ì²´ë¥¼ ìƒì„±í•´ì„œ í´ë¼ì´ì–¸íŠ¸ì— ë°˜í™˜í•œë‹¤.

## ì»¤ë„¥ì…˜ í’€ ì´ˆê¸°í™”
![image](https://github.com/shin-je-woo/TIL/assets/39439576/9553ea0c-b553-4bee-9115-b263193a6d9f)
* ì»¤ë„¥ì…˜ì„ íšë“í•˜ëŠ” ë¹„ìš©ì´ ë¹„ì‹¸ê¸° ë•Œë¬¸ì— ë³´í†µ `ì»¤ë„¥ì…˜ í’€` ì„ ì‚¬ìš©í•œë‹¤.
* ì»¤ë„¥ì…˜ í’€ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹œì‘í•˜ëŠ” ì‹œì ì— í•„ìš”í•œ ë§Œí¼ ì»¤ë„¥ì…˜ì„ ë¯¸ë¦¬ í™•ë³´í•´ì„œ í’€ì— ë³´ê´€í•œë‹¤.
* ì»¤ë„¥ì…˜ í’€ì— ë“¤ì–´ ìˆëŠ” ì»¤ë„¥ì…˜ì€ TCP/IPë¡œ DBì™€ ì»¤ë„¥ì…˜ì´ ì—°ê²°ë˜ì–´ ìˆëŠ” ìƒíƒœì´ê¸° ë•Œë¬¸ì— ì–¸ì œë“ ì§€ ì¦‰ì‹œ SQLì„ DBì— ì „ë‹¬í•  ìˆ˜ ìˆë‹¤.

## ì»¤ë„¥ì…˜ í’€ ì´ìš©
![image](https://github.com/shin-je-woo/TIL/assets/39439576/2e824ca3-cc95-4afa-867d-3688f8c0e299)
* ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì—ì„œ ì´ì œëŠ” DB ë“œë¼ì´ë²„ë¥¼ í†µí•´ì„œ ìƒˆë¡œìš´ ì»¤ë„¥ì…˜ì„ íšë“í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë‹¤.
* ì´ì œëŠ” ì»¤ë„¥ì…˜ í’€ì„ í†µí•´ ì´ë¯¸ ìƒì„±ë˜ì–´ ìˆëŠ” ì»¤ë„¥ì…˜ì„ ê°ì²´ ì°¸ì¡°ë¡œ ê·¸ëƒ¥ ê°€ì ¸ë‹¤ ì“°ê¸°ë§Œ í•˜ë©´ ëœë‹¤.
* ì»¤ë„¥ì…˜ í’€ì— ì»¤ë„¥ì…˜ì„ ìš”ì²­í•˜ë©´ ì»¤ë„¥ì…˜ í’€ì€ ìì‹ ì´ ê°€ì§€ê³  ìˆëŠ” ì»¤ë„¥ì…˜ ì¤‘ì— í•˜ë‚˜ë¥¼ ë°˜í™˜í•œë‹¤.

## ì»¤ë„¥ì…˜ í’€ ë°˜í™˜
![image](https://github.com/shin-je-woo/TIL/assets/39439576/745fe7d7-c563-4e91-a8db-b7f5455dcc45)
* ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì€ ì»¤ë„¥ì…˜ í’€ì—ì„œ ë°›ì€ ì»¤ë„¥ì…˜ì„ ì‚¬ìš©í•´ì„œ SQLì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì „ë‹¬í•˜ê³  ê·¸ ê²°ê³¼ë¥¼ ë°›ì•„ì„œ ì²˜ë¦¬í•œë‹¤.
* ì»¤ë„¥ì…˜ì„ ëª¨ë‘ ì‚¬ìš©í•˜ê³  ë‚˜ë©´ ì´ì œëŠ” ì»¤ë„¥ì…˜ì„ ì¢…ë£Œí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ë‹¤ìŒì— ë‹¤ì‹œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•´ë‹¹ ì»¤ë„¥ì…˜ì„ ê·¸ëŒ€ë¡œ ì»¤ë„¥ì…˜ í’€ì— ë°˜í™˜í•˜ë©´ ëœë‹¤. 
* ì—¬ê¸°ì„œ ì£¼ì˜í•  ì ì€ ì»¤ë„¥ì…˜ì„ ì¢…ë£Œí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì»¤ë„¥ì…˜ì´ ì‚´ì•„ìˆëŠ” ìƒíƒœë¡œ ì»¤ë„¥ì…˜ í’€ì— ë°˜í™˜í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤.

## ì •ë¦¬
* ì ì ˆí•œ ì»¤ë„¥ì…˜ í’€ ìˆ«ìëŠ” ì„œë¹„ìŠ¤ì˜ íŠ¹ì§•ê³¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ ìŠ¤í™, DB ì„œë²„ ìŠ¤í™ì— ë”°ë¼ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ì„œ ì •í•´ì•¼ í•œë‹¤.
* ì»¤ë„¥ì…˜ í’€ì€ ì„œë²„ë‹¹ ìµœëŒ€ ì»¤ë„¥ì…˜ ìˆ˜ë¥¼ ì œí•œí•  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ DBì— ë¬´í•œì • ì—°ê²°ì´ ìƒì„±ë˜ëŠ” ê²ƒì„ ë§‰ì•„ì£¼ì–´ì„œ DBë¥¼ ë³´í˜¸í•˜ëŠ” íš¨ê³¼ë„ ìˆë‹¤.
* ì»¤ë„¥ì…˜ í’€ë¡œ ì–»ëŠ” ì´ì ì´ ë§¤ìš° í¬ê¸° ë•Œë¬¸ì— ì‹¤ë¬´ì—ì„œëŠ” í•­ìƒ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.
* ì»¤ë„¥ì…˜ í’€ì€ ê°œë…ì ìœ¼ë¡œ ë‹¨ìˆœí•´ì„œ ì§ì ‘ êµ¬í˜„í•  ìˆ˜ë„ ìˆì§€ë§Œ, ì‚¬ìš©ë„ í¸ë¦¬í•˜ê³  ì„±ëŠ¥ë„ ë›°ì–´ë‚œ ì˜¤í”ˆì†ŒìŠ¤ ì»¤ë„¥ì…˜ í’€ì´ ë§ê¸° ë•Œë¬¸ì— ì˜¤í”ˆì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
* ëŒ€í‘œì ì¸ ì»¤ë„¥ì…˜ í’€ ì˜¤í”ˆì†ŒìŠ¤ëŠ” `commons-dbcp2` , `tomcat-jdbc pool` , `HikariCP` ë“±ì´ ìˆë‹¤.
* ì„±ëŠ¥ê³¼ ì‚¬ìš©ì˜ í¸ë¦¬í•¨ ì¸¡ë©´ì—ì„œ ìµœê·¼ì—ëŠ” `hikariCP` ë¥¼ ì£¼ë¡œ ì‚¬ìš©í•œë‹¤. ìŠ¤í”„ë§ ë¶€íŠ¸ 2.0 ë¶€í„°ëŠ” ê¸°ë³¸ ì»¤ë„¥ì…˜ í’€ë¡œ hikariCP ë¥¼ ì œê³µí•œë‹¤. 

# ğŸ’¡ DataSource ì´í•´
* ì»¤ë„¥ì…˜ì„ ì–»ëŠ” ë°©ë²•ì€ ì•ì„œ í•™ìŠµí•œ JDBC `DriverManager` ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ê±°ë‚˜, `ì»¤ë„¥ì…˜ í’€`ì„ ì‚¬ìš©í•˜ëŠ” ë“± ë‹¤ì–‘í•œ ë°©ë²•ì´ ì¡´ì¬í•œë‹¤.
* DriverManager ë¥¼ í†µí•´ì„œ ì»¤ë„¥ì…˜ì„ íšë“í•˜ë‹¤ê°€, ì»¤ë„¥ì…˜ í’€ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ë³€ê²½í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?
* ë‘˜ì˜ ì»¤ë„¥ì…˜ íšë“ ë°©ë²•, ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©ë²•ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œë¥¼ ëŒ€ëŸ‰ìœ¼ë¡œ ë³€ê²½í•´ì•¼í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤.

![image](https://github.com/shin-je-woo/TIL/assets/39439576/918130c7-f2fa-4ef0-8c59-6f8055c62a91)
* ìë°”ì—ì„œëŠ” ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ `javax.sql.DataSource` ë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•œë‹¤.
* DataSource ëŠ” **ì»¤ë„¥ì…˜ì„ íšë“í•˜ëŠ” ë°©ë²•ì„ ì¶”ìƒí™”** í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ì´ë‹¤.
* ì´ ì¸í„°í˜ì´ìŠ¤ì˜ í•µì‹¬ ê¸°ëŠ¥ì€ ì»¤ë„¥ì…˜ ì¡°íšŒë‹¤. (ë‹¤ë¥¸ ì¼ë¶€ ê¸°ëŠ¥ë„ ìˆì§€ë§Œ í¬ê²Œ ì¤‘ìš”í•˜ì§€ ì•Šë‹¤.)
```java
public interface DataSource {
    Connection getConnection() throws SQLException;
}
```
* ëŒ€ë¶€ë¶„ì˜ `ì»¤ë„¥ì…˜ í’€` ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ê³¼ `DrvierManager` ëŠ” `DataSource` ë¥¼ êµ¬í˜„í•´ë‘ì—ˆë‹¤.
* ì´ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì€ `DataSource` ì¸í„°í˜ì´ìŠ¤ì—ë§Œ ì˜ì¡´í•˜ë©´ ëœë‹¤. 
* ë•ë¶„ì— `DriverManagerDataSource` ë¥¼ í†µí•´ì„œ `DriverManager` ë¥¼ ì‚¬ìš©í•˜ë‹¤ê°€ `ì»¤ë„¥ì…˜ í’€`ì„ ì‚¬ìš©í•˜ë„ë¡ ì½”ë“œë¥¼ ë³€ê²½í•´ë„ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì€ ë³€ê²½í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

# ğŸ’¡ DataSource ì˜ˆì œ
â–¶ï¸ Repository
```java
@Slf4j
@RequiredArgsConstructor
public class MemberRepositoryV1 {

    private final DataSource dataSource;
    
    //save()...
    //findById()...
    //update()....
    //delete()....
}
```

â–¶ï¸ TestCode
```java
@Slf4j
class MemberRepositoryV1Test {

    MemberRepositoryV1 repository;

    @BeforeEach
    public void beforeEach() {
        //ê¸°ë³¸ DriverManager - í•­ìƒ ìƒˆë¡œìš´ ì»¤ë„¥ì…˜ íšë“
        //DriverManagerDataSource dataSource = new DriverManagerDataSource(URL, USERNAME, PASSWORD);
        
        //ì»¤ë„¥ì…˜ í’€ë§: HikariProxyConnection -> JdbcConnection
        HikariDataSource dataSource = new HikariDataSource();
        dataSource.setJdbcUrl(URL);
        dataSource.setUsername(USERNAME);
        dataSource.setPassword(PASSWORD);
        dataSource.setMaximumPoolSize(20);

        //ì˜ì¡´ê´€ê³„ ì£¼ì…
        repository = new MemberRepositoryV1(dataSource);
    }
    
    @Test
    void crud() {
        ...
    }
```
* `DriverManagerDataSource` ë¥¼ ì‚¬ìš©í•˜ë©´ conn0~5 ë²ˆí˜¸ë¥¼ í†µí•´ì„œ í•­ìƒ ìƒˆë¡œìš´ ì»¤ë„¥ì…˜ì´ ìƒì„±ë˜ì–´ì„œ ì‚¬ìš©ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
* `ì»¤ë„¥ì…˜ í’€` ì‚¬ìš©ì‹œ conn0 ì»¤ë„¥ì…˜ì´ ì¬ì‚¬ìš© ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
* `DriverManagerDataSource` â†’ `HikariDataSource` ë¡œ ë³€ê²½í•´ë„ MemberRepositoryV1 ì˜ ì½”ë“œëŠ” ì „í˜€ ë³€ê²½í•˜ì§€ ì•Šì•„ë„ ëœë‹¤. 
* MemberRepositoryV1 ëŠ” `DataSource` ì¸í„°í˜ì´ìŠ¤ì—ë§Œ ì˜ì¡´í•˜ê¸° ë•Œë¬¸ì´ë‹¤.
* ì´ê²ƒì´ `DataSource` ì˜ ì¥ì ì´ë‹¤. (DI + OCP)
